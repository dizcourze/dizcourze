function setCookie(e,t,n){const a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3);let o="expires="+a.toUTCString();document.cookie=e+"="+t+";"+o+";path=/"}function getCookie(e){let t=e+"=",n=decodeURIComponent(document.cookie).split(";");for(let e=0;e<n.length;e++){let a=n[e];for(;" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return""}function run(){chkLangandGo(),chkTheme()}function chkTheme(){"0"==getCookie("theme")?(setCookie("theme","0",365),document.getElementsByTagName("link")[1].href="https://cdnjs.cloudflare.com/ajax/libs/mini.css/3.0.1/mini-dark.min.css",document.getElementsByTagName("link")[2].href="/asset/style-dark.min.css"):setCookie("theme","1",365)}function chkLangandGo(){""==getCookie("lang")?fetch("https://www.cloudflare.com/cdn-cgi/trace").then((e=>e.text())).then((e=>go(e))):"TW"==getCookie("lang")?(y="TW",go(y)):"JP"==getCookie("lang")?(y="JP",go(y)):(y="EN",go(y))}function go(e){-1!=e.indexOf("TW")?(setCookie("lang","TW",365),lang={srh:"搜尋",err:"糟糕，出錯啦！請重新載入頁面再試一次。",about:"簡介",theme:"外觀",lang:"語言",donate:"捐贈",github:"GitHub",email:"電子郵件地址",light:"淺色",dark:"深色",en:"English",tw:"繁體中文",jp:"日本語","e-address":"以太坊地址","b-address":"比特幣地址",acc:"已將地址複製到剪貼簿",year:"年",mon:"月",date:"日",s:"秒",m:"分",h:"小時",flag:"成功檢舉",lcc:"已將連結複製到剪貼簿",w:"萬",ava:"大頭貼連結",name:"使用者名稱",sap:"傳送貼文",sam:"傳送訊息"},chkPath()):-1!=e.indexOf("JP")?(setCookie("lang","JP",365),lang={srh:"検索",err:"エラーが発生しました。ページを更新して再度お試しください。",about:"概要",theme:"デザイン",lang:"言語",donate:"寄付",github:"GitHub",email:"メールアドレス",light:"ライト",dark:"ダーク",en:"English",tw:"繁體中文",jp:"日本語","e-address":"イーサリアムアドレス","b-address":"ビットコインアドレス",acc:"アドレスをクリップボードにコピーしました",year:"年",mon:"月",date:"日",s:"秒",m:"分",h:"時間",flag:"正常に報告されました",lcc:"リンクをクリップボードにコピーしました",w:"万",ava:"プロフィール画像リンク",name:"ユーザー名",sap:"ポストを送信",sam:"メッセージを送信"},chkPath()):(setCookie("lang","EN",365),lang={srh:"Search",err:"Oops! Something went wrong. Please reload the page and try again.",about:"About",theme:"Appearance",lang:"Language",donate:"Donate",github:"GitHub",email:"Email Address",light:"Light",dark:"Dark",en:"English",tw:"繁體中文",jp:"日本語","e-address":"Ethereum Address","b-address":"Bitcoin Address",acc:"Address copied to clipboard",s:"s",m:"m",h:"h",flag:"Successfully flagged",lcc:"Link copied to clipboard",k:"K",ava:"Profile picture link",name:"Username",sap:"Send a post",sam:"Send a message"},chkPath())}function chkPath(){""==location.href.split("/")[3]&&null==location.href.split("/")[4]?indexPage():"more"==location.href.split("/")[3]&&null==location.href.split("/")[4]?morePage():location.href.split("/")[3].startsWith("search?q=")&&null==location.href.split("/")[4]?searchPage():"post"==location.href.split("/")[3]&&null!=location.href.split("/")[4]?postPage():errPage()}function errPage(){document.getElementsByTagName("title")[0].innerHTML="Error - Dizcourze",document.getElementById("main").innerHTML="<div id='app'><header><a class='s-btn' href='/' target='_blank'><span class='icon-logo'></span></a><input id='srh' type='text' autocomplete='off' placeholder='"+lang.srh+"'><a class='s-btn' onclick='srh()'><span class='icon-search'></span></a><a class='s-btn' href='/more' target='_blank'><span class='icon-more'></span></a></header><div id='content'><div class='err'>"+lang.err+"</div></div><div id='top' onclick='toTop()'><span class='icon-top'></span></div></div>",document.getElementById("content").addEventListener("scroll",chkTop),document.getElementById("srh").addEventListener("keypress",chkSrh)}function searchPage(){document.getElementsByTagName("title")[0].innerHTML="#"+decodeURI(location.href.split("/")[3].substring(9))+" - Dizcourze",document.getElementById("main").innerHTML="<div id='app'><header><a class='s-btn' href='/' target='_blank'><span class='icon-logo'></span></a><input id='srh' type='text' autocomplete='off' placeholder='"+lang.srh+"'><a class='s-btn' onclick='srh()'><span class='icon-search'></span></a><a class='s-btn' href='/more' target='_blank'><span class='icon-more'></span></a></header><div id='content'><div id='load'><a class='spinner'></a></div></div><div id='top' onclick='toTop()'><span class='icon-top'></span></div></div><div id='bg'></div>",document.getElementById("content").addEventListener("scroll",chkTopandSearch),document.getElementById("srh").addEventListener("keypress",chkSrh),db.collection("post").where("tag","array-contains",decodeURI(location.href.split("/")[3].substring(9))).orderBy("created","desc").startAfter(new Date).limit(20).onSnapshot((e=>{e.docChanges().forEach((e=>{"added"===e.type&&(tmp_ava=document.createElement("div"),tmp_ava.innerHTML=e.doc.data().ava,tmp_name=document.createElement("div"),tmp_name.innerHTML=e.doc.data().name,tmp_text=document.createElement("div"),tmp_text.innerHTML=e.doc.data().text,tmp_text=format(tmp_text.innerText),tmp=document.createElement("div"),tmp.innerHTML="<div id='post-"+e.doc.id+"' class='post' onclick='toPost(this)'><img class='ava' src='"+tmp_ava.innerText+"' onerror='reAva(this)'><div class='name'>"+tmp_name.innerText+"</div><div class='sep'>·</div><div id='create-"+e.doc.id+"' class='create'></div><div id='inv-"+e.doc.id+"' class='inv'>"+e.doc.data().created.toDate()+"</div><a id='flag-"+e.doc.id+"' class='s-btn right' onclick='flagPost(this, event)' onmouseover='over(this)' onmouseout='out(this)'><span class='icon-flag'></span></a><div class='text'>"+tmp_text+"</div><div id='msg-"+e.doc.id+"' class='m-btn' onmouseover='over(this)' onmouseout='out(this)' data-num='"+e.doc.data().msg+"'><span class='icon-msg'></span>"+count(e.doc.data().msg)+"</div><div id='love-"+e.doc.id+"' class='m-btn' onclick='love(this, event)' onmouseover='over(this)' onmouseout='out(this)' data-num='"+e.doc.data().love+"'><span class='icon-love'></span>"+count(e.doc.data().love)+"</div><div id='share-"+e.doc.id+"' class='m-btn' onclick='share(this, event)' onmouseover='over(this)' onmouseout='out(this)'><span class='icon-share'></span></div></div>",document.getElementById("content").append(tmp),null!=document.getElementById("load")&&document.getElementById("load").remove(),cursor=e.doc.data().created.toDate()),"modified"===e.type&&(document.getElementById("msg-"+e.doc.id).dataset.num=e.doc.data().msg,document.getElementById("msg-"+e.doc.id).innerHTML="<span class='icon-msg'></span>"+count(e.doc.data().msg),document.getElementById("love-"+e.doc.id).dataset.num=e.doc.data().love,document.getElementById("love-"+e.doc.id).innerHTML="<span class='icon-love'></span>"+count(e.doc.data().love)),"removed"===e.type&&document.getElementById("post-"+e.doc.id).parentNode.remove()})),null!=document.getElementById("load")&&document.getElementById("load").remove()})),db.collection("post").where("tag","array-contains",decodeURI(location.href.split("/")[3].substring(9))).orderBy("created").startAfter(new Date).onSnapshot((e=>{e.docChanges().forEach((e=>{"added"===e.type&&(tmp_ava=document.createElement("div"),tmp_ava.innerHTML=e.doc.data().ava,tmp_name=document.createElement("div"),tmp_name.innerHTML=e.doc.data().name,tmp_text=document.createElement("div"),tmp_text.innerHTML=e.doc.data().text,tmp_text=format(tmp_text.innerText),tmp=document.createElement("div"),tmp.innerHTML="<div id='post-"+e.doc.id+"' class='post' onclick='toPost(this)'><img class='ava' src='"+tmp_ava.innerText+"' onerror='reAva(this)'><div class='name'>"+tmp_name.innerText+"</div><div class='sep'>·</div><div id='create-"+e.doc.id+"' class='create'></div><div id='inv-"+e.doc.id+"' class='inv'>"+new Date+"</div><a id='flag-"+e.doc.id+"' class='s-btn right' onclick='flagPost(this, event)' onmouseover='over(this)' onmouseout='out(this)'><span class='icon-flag'></span></a><div class='text'>"+tmp_text+"</div><div id='msg-"+e.doc.id+"' class='m-btn' onmouseover='over(this)' onmouseout='out(this)' data-num='"+e.doc.data().msg+"'><span class='icon-msg'></span>"+count(e.doc.data().msg)+"</div><div id='love-"+e.doc.id+"' class='m-btn' onclick='love(this, event)' onmouseover='over(this)' onmouseout='out(this)' data-num='"+e.doc.data().love+"'><span class='icon-love'></span>"+count(e.doc.data().love)+"</div><div id='share-"+e.doc.id+"' class='m-btn' onclick='share(this, event)' onmouseover='over(this)' onmouseout='out(this)'><span class='icon-share'></span></div></div>",document.getElementById("content").prepend(tmp)),"modified"===e.type&&(document.getElementById("msg-"+e.doc.id).dataset.num=e.doc.data().msg,document.getElementById("msg-"+e.doc.id).innerHTML="<span class='icon-msg'></span>"+count(e.doc.data().msg),document.getElementById("love-"+e.doc.id).dataset.num=e.doc.data().love,document.getElementById("love-"+e.doc.id).innerHTML="<span class='icon-love'></span>"+count(e.doc.data().love)),"removed"===e.type&&document.getElementById("post-"+e.doc.id).parentNode.remove()}))}))}function indexPage(){document.getElementById("main").innerHTML="<div id='app'><header><a class='s-btn' href='/' target='_blank'><span class='icon-logo'></span></a><input id='srh' type='text' autocomplete='off' placeholder='"+lang.srh+"'><a class='s-btn' onclick='srh()'><span class='icon-search'></span></a><a class='s-btn' href='/more' target='_blank'><span class='icon-more'></span></a></header><div id='content'><div id='load'><a class='spinner'></a></div></div><header class='bot'><input id='ava' type='text' autocomplete='off' placeholder='"+lang.ava+"' maxlength='40'><input id='name' type='text' autocomplete='off' placeholder='"+lang.name+"' maxlength='20'><input id='text' type='text' autocomplete='off' placeholder='"+lang.sap+"' maxlength='80'><a class='s-btn' onclick='sendPost()'><span class='icon-send'></span></a></header><div id='top' onclick='toTop()'><span class='icon-top'></span></div></div><div id='bg'></div>",document.getElementById("content").style.height="calc(100% - 10rem)",document.getElementById("top").style.bottom="6.3125rem",document.getElementById("content").addEventListener("scroll",chkTopandIndex),document.getElementById("srh").addEventListener("keypress",chkSrh),document.getElementById("text").addEventListener("keypress",chkSap),db.collection("post").orderBy("created","desc").startAfter(new Date).limit(20).onSnapshot((e=>{e.docChanges().forEach((e=>{"added"===e.type&&(tmp_ava=document.createElement("div"),tmp_ava.innerHTML=e.doc.data().ava,tmp_name=document.createElement("div"),tmp_name.innerHTML=e.doc.data().name,tmp_text=document.createElement("div"),tmp_text.innerHTML=e.doc.data().text,tmp_text=format(tmp_text.innerText),tmp=document.createElement("div"),tmp.innerHTML="<div id='post-"+e.doc.id+"' class='post' onclick='toPost(this)'><img class='ava' src='"+tmp_ava.innerText+"' onerror='reAva(this)'><div class='name'>"+tmp_name.innerText+"</div><div class='sep'>·</div><div id='create-"+e.doc.id+"' class='create'></div><div id='inv-"+e.doc.id+"' class='inv'>"+e.doc.data().created.toDate()+"</div><a id='flag-"+e.doc.id+"' class='s-btn right' onclick='flagPost(this, event)' onmouseover='over(this)' onmouseout='out(this)'><span class='icon-flag'></span></a><div class='text'>"+tmp_text+"</div><div id='msg-"+e.doc.id+"' class='m-btn' onmouseover='over(this)' onmouseout='out(this)' data-num='"+e.doc.data().msg+"'><span class='icon-msg'></span>"+count(e.doc.data().msg)+"</div><div id='love-"+e.doc.id+"' class='m-btn' onclick='love(this, event)' onmouseover='over(this)' onmouseout='out(this)' data-num='"+e.doc.data().love+"'><span class='icon-love'></span>"+count(e.doc.data().love)+"</div><div id='share-"+e.doc.id+"' class='m-btn' onclick='share(this, event)' onmouseover='over(this)' onmouseout='out(this)'><span class='icon-share'></span></div></div>",document.getElementById("content").append(tmp),null!=document.getElementById("load")&&document.getElementById("load").remove(),cursor=e.doc.data().created.toDate()),"modified"===e.type&&(document.getElementById("msg-"+e.doc.id).dataset.num=e.doc.data().msg,document.getElementById("msg-"+e.doc.id).innerHTML="<span class='icon-msg'></span>"+count(e.doc.data().msg),document.getElementById("love-"+e.doc.id).dataset.num=e.doc.data().love,document.getElementById("love-"+e.doc.id).innerHTML="<span class='icon-love'></span>"+count(e.doc.data().love)),"removed"===e.type&&document.getElementById("post-"+e.doc.id).parentNode.remove()})),null!=document.getElementById("load")&&document.getElementById("load").remove()})),db.collection("post").orderBy("created").startAfter(new Date).onSnapshot((e=>{e.docChanges().forEach((e=>{"added"===e.type&&(tmp_ava=document.createElement("div"),tmp_ava.innerHTML=e.doc.data().ava,tmp_name=document.createElement("div"),tmp_name.innerHTML=e.doc.data().name,tmp_text=document.createElement("div"),tmp_text.innerHTML=e.doc.data().text,tmp_text=format(tmp_text.innerText),tmp=document.createElement("div"),tmp.innerHTML="<div id='post-"+e.doc.id+"' class='post' onclick='toPost(this)'><img class='ava' src='"+tmp_ava.innerText+"' onerror='reAva(this)'><div class='name'>"+tmp_name.innerText+"</div><div class='sep'>·</div><div id='create-"+e.doc.id+"' class='create'></div><div id='inv-"+e.doc.id+"' class='inv'>"+new Date+"</div><a id='flag-"+e.doc.id+"' class='s-btn right' onclick='flagPost(this, event)' onmouseover='over(this)' onmouseout='out(this)'><span class='icon-flag'></span></a><div class='text'>"+tmp_text+"</div><div id='msg-"+e.doc.id+"' class='m-btn' onmouseover='over(this)' onmouseout='out(this)' data-num='"+e.doc.data().msg+"'><span class='icon-msg'></span>"+count(e.doc.data().msg)+"</div><div id='love-"+e.doc.id+"' class='m-btn' onclick='love(this, event)' onmouseover='over(this)' onmouseout='out(this)' data-num='"+e.doc.data().love+"'><span class='icon-love'></span>"+count(e.doc.data().love)+"</div><div id='share-"+e.doc.id+"' class='m-btn' onclick='share(this, event)' onmouseover='over(this)' onmouseout='out(this)'><span class='icon-share'></span></div></div>",document.getElementById("content").prepend(tmp)),"modified"===e.type&&(document.getElementById("msg-"+e.doc.id).dataset.num=e.doc.data().msg,document.getElementById("msg-"+e.doc.id).innerHTML="<span class='icon-msg'></span>"+count(e.doc.data().msg),document.getElementById("love-"+e.doc.id).dataset.num=e.doc.data().love,document.getElementById("love-"+e.doc.id).innerHTML="<span class='icon-love'></span>"+count(e.doc.data().love)),"removed"===e.type&&document.getElementById("post-"+e.doc.id).parentNode.remove()}))}))}function postPage(){document.getElementsByTagName("title")[0].innerHTML="Post - Dizcourze",document.getElementById("main").innerHTML="<div id='app'><header><a class='s-btn' href='/' target='_blank'><span class='icon-logo'></span></a><input id='srh' type='text' autocomplete='off' placeholder='"+lang.srh+"'><a class='s-btn' onclick='srh()'><span class='icon-search'></span></a><a class='s-btn' href='/more' target='_blank'><span class='icon-more'></span></a></header><div id='content'><div id='major'><div id='load'><a class='spinner'></a></div></div><div id='minor'></div></div><header class='bot'><input id='ava' type='text' autocomplete='off' placeholder='"+lang.ava+"' maxlength='40'><input id='name' type='text' autocomplete='off' placeholder='"+lang.name+"' maxlength='20'><input id='text' type='text' autocomplete='off' placeholder='"+lang.sam+"' maxlength='40'><a class='s-btn' onclick='sendMsg()'><span class='icon-send'></span></a></header><div id='top' onclick='toTop()'><span class='icon-top'></span></div></div><div id='bg'></div>",document.getElementById("content").style.height="calc(100% - 10rem)",document.getElementById("top").style.bottom="6.3125rem",document.getElementById("content").addEventListener("scroll",chkTop),document.getElementById("srh").addEventListener("keypress",chkSrh),document.getElementById("text").addEventListener("keypress",chkSam),db.collection("post").where(firebase.firestore.FieldPath.documentId(),"==",location.pathname.substring(location.pathname.length-20)).onSnapshot((e=>{e.docChanges().forEach((e=>{"added"===e.type&&(tmp_ava=document.createElement("div"),tmp_ava.innerHTML=e.doc.data().ava,tmp_name=document.createElement("div"),tmp_name.innerHTML=e.doc.data().name,tmp_text=document.createElement("div"),tmp_text.innerHTML=e.doc.data().text,document.getElementsByTagName("title")[0].innerHTML=tmp_text.innerText.slice(0,10)+"... - Dizcourze",tmp_text=format(tmp_text.innerText),tmp=document.createElement("div"),tmp.innerHTML="<div id='post-"+e.doc.id+"' class='in-post'><img class='ava' src='"+tmp_ava.innerText+"' onerror='reAva(this)'><div class='name'>"+tmp_name.innerText+"</div><div class='sep'>·</div><div id='create-"+e.doc.id+"' class='create'></div><div id='inv-"+e.doc.id+"' class='inv'>"+e.doc.data().created.toDate()+"</div><a id='flag-"+e.doc.id+"' class='s-btn right' onclick='flagPost(this, event)' onmouseover='over(this)' onmouseout='out(this)'><span class='icon-flag'></span></a><div class='text'>"+tmp_text+"</div><div id='msg-"+e.doc.id+"' class='m-btn' onclick='toPostagain(this)' onmouseover='over(this)' onmouseout='out(this)' data-num='"+e.doc.data().msg+"'><span class='icon-msg'></span>"+count(e.doc.data().msg)+"</div><div id='love-"+e.doc.id+"' class='m-btn' onclick='love(this, event)' onmouseover='over(this)' onmouseout='out(this)' data-num='"+e.doc.data().love+"'><span class='icon-love'></span>"+count(e.doc.data().love)+"</div><div id='share-"+e.doc.id+"' class='m-btn' onclick='share(this, event)' onmouseover='over(this)' onmouseout='out(this)'><span class='icon-share'></span></div></div>",document.getElementById("major").append(tmp),null!=document.getElementById("load")&&document.getElementById("load").remove()),"modified"===e.type&&(document.getElementById("msg-"+e.doc.id).dataset.num=e.doc.data().msg,document.getElementById("msg-"+e.doc.id).innerHTML="<span class='icon-msg'></span>"+count(e.doc.data().msg),document.getElementById("love-"+e.doc.id).dataset.num=e.doc.data().love,document.getElementById("love-"+e.doc.id).innerHTML="<span class='icon-love'></span>"+count(e.doc.data().love)),"removed"===e.type&&document.getElementById("post-"+e.doc.id).parentNode.remove()})),null!=document.getElementById("load")&&document.getElementById("load").remove()})),db.collection("msg").where("post","==",location.pathname.substring(location.pathname.length-20)).orderBy("created").onSnapshot((e=>{e.docChanges().forEach((e=>{"added"===e.type&&(tmp_ava=document.createElement("div"),tmp_ava.innerHTML=e.doc.data().ava,tmp_name=document.createElement("div"),tmp_name.innerHTML=e.doc.data().name,tmp_text=document.createElement("div"),tmp_text.innerHTML=e.doc.data().text,tmp_text=format(tmp_text.innerText),tmp=document.createElement("div"),null==e.doc.data().created?tmp.innerHTML="<div id='inpost-"+e.doc.id+"' class='in-post'><img class='ava' src='"+tmp_ava.innerText+"' onerror='reAva(this)'><div class='name'>"+tmp_name.innerText+"</div><div class='sep'>·</div><div id='create-"+e.doc.id+"' class='create'></div><div id='inv-"+e.doc.id+"' class='inv'>"+new Date+"</div><a id='flag-"+e.doc.id+"' class='s-btn right' onclick='flagMsg(this)' onmouseover='over(this)' onmouseout='out(this)'><span class='icon-flag'></span></a><div class='text'>"+tmp_text+"</div></div>":tmp.innerHTML="<div id='inpost-"+e.doc.id+"' class='in-post'><img class='ava' src='"+tmp_ava.innerText+"' onerror='reAva(this)'><div class='name'>"+tmp_name.innerText+"</div><div class='sep'>·</div><div id='increate-"+e.doc.id+"' class='create'></div><div id='ininv-"+e.doc.id+"' class='ininv'>"+e.doc.data().created.toDate()+"</div><a id='flag-"+e.doc.id+"' class='s-btn right' onclick='flagMsg(this)' onmouseover='over(this)' onmouseout='out(this)'><span class='icon-flag'></span></a><div class='text'>"+tmp_text+"</div></div>",document.getElementById("minor").append(tmp)),"removed"===e.type&&document.getElementById("inpost-"+e.doc.id).parentNode.remove()}))}))}function format(e){for(e=e.split(" "),i=0;i<e.length;i+=1)e[i].startsWith("@")?e[i]="<a class='mention'>"+e[i]+"</a>":e[i].startsWith("#")?e[i]="<a href='/search?q="+e[i].substring(1)+"' target='_blank' onclick='stop(event)'>"+e[i]+"</a>":(e[i].startsWith("http://")||e[i].startsWith("https://"))&&(e[i].endsWith(".png")||e[i].endsWith(".jpg")||e[i].endsWith(".gif")||e[i].endsWith(".svg")||e[i].endsWith(".webp")?e[i]="<img class='in' src='"+e[i]+"' onerror='chgImg(this)'>":e[i].endsWith(".mp4")||e[i].endsWith(".webm")?e[i]="<video class='in' src='"+e[i]+"' onerror='chgVid(this)' controls playsinline></video>":e[i].endsWith(".mp3")||e[i].endsWith(".wav")?e[i]="<audio class='aud' src='"+e[i]+"' onerror='chgAud(this)' controls></audio>":e[i]="<a href='"+e[i]+"' target='_blank' onclick='stop(event)'>"+e[i]+"</a>");return e=e.join(" ")}function chgAud(e){e.src=""}function chgImg(e){e.src="https://i.imgur.com/3XnNIXY.jpg"}function chgVid(e){e.src="https://i.imgur.com/OMhDLGN.mp4"}function stop(e){e.stopPropagation()}function sendMsg(){""!=document.getElementById("text").value&&(""==document.getElementById("name").value?name="Anonymous":name=document.getElementById("name").value,data={ava:document.getElementById("ava").value,name:name,text:document.getElementById("text").value,created:firebase.firestore.FieldValue.serverTimestamp(),post:location.pathname.substring(location.pathname.length-20)},db.collection("msg").add(data),data={msg:Number(document.getElementById("msg-"+location.pathname.substring(location.pathname.length-20)).dataset.num)+1},db.collection("post").doc(location.pathname.substring(location.pathname.length-20)).update(data),document.getElementById("ava").value="",document.getElementById("name").value="",document.getElementById("text").value="")}function sendPost(){""!=document.getElementById("text").value&&(""==document.getElementById("name").value?name="Anonymous":name=document.getElementById("name").value,data={ava:document.getElementById("ava").value,name:name,text:document.getElementById("text").value,created:firebase.firestore.FieldValue.serverTimestamp(),tag:chkTag(),love:0,msg:0},db.collection("post").add(data),document.getElementById("ava").value="",document.getElementById("name").value="",document.getElementById("text").value="")}function chkTag(){for(tagList=[],txtList=document.getElementById("text").value.split(" "),i=0;i<txtList.length;i+=1)txtList[i].startsWith("#")&&tagList.push(txtList[i].substring(1));return tagList}function share(e,t){t.stopPropagation(),navigator.clipboard.writeText("https://dizcourze.com/post/"+e.id.substring(6)),document.getElementById("bg").innerHTML="<div class='box'><a class='s-btn right' onclick='x()'><span class='icon-x'></span></a><div class='txt'>"+lang.lcc+"</div></div>",document.getElementById("bg").style.display="block"}function love(e,t){t.stopPropagation(),data={love:Number(e.dataset.num)+1},db.collection("post").doc(e.id.substring(5)).update(data)}function over(e){e.parentNode.style.background="var(--back-color)"}function out(e){e.parentNode.style.background=""}function flagPost(e,t){t.stopPropagation(),data={created:firebase.firestore.FieldValue.serverTimestamp(),id:e.id.substring(5),type:"post"},db.collection("flag").add(data),document.getElementById("bg").innerHTML="<div class='box'><a class='s-btn right' onclick='x()'><span class='icon-x'></span></a><div class='txt'>"+lang.flag+"</div></div>",document.getElementById("bg").style.display="block"}function flagMsg(e){data={created:firebase.firestore.FieldValue.serverTimestamp(),id:e.id.substring(5),type:"msg"},db.collection("flag").add(data),document.getElementById("bg").innerHTML="<div class='box'><a class='s-btn right' onclick='x()'><span class='icon-x'></span></a><div class='txt'>"+lang.flag+"</div></div>",document.getElementById("bg").style.display="block"}function setTime(){if(l1=document.getElementsByClassName("inv"),null!=l1[0])for(i=0;i<l1.length;i+=1)d1=new Date,d2=new Date(l1[i].innerHTML),d1-d2<6e4?document.getElementById("create-"+l1[i].id.substring(4)).innerHTML=Math.floor((d1-d2)/1e3)+lang.s:d1-d2<36e5?document.getElementById("create-"+l1[i].id.substring(4)).innerHTML=Math.floor((d1-d2)/6e4)+lang.m:d1-d2<864e5?document.getElementById("create-"+l1[i].id.substring(4)).innerHTML=Math.floor((d1-d2)/36e5)+lang.h:d1.getFullYear()==d2.getFullYear()?"TW"==getCookie("lang")||"JP"==getCookie("lang")?document.getElementById("create-"+l1[i].id.substring(4)).innerHTML=d2.getMonth()+1+lang.mon+d2.getDate()+lang.date:(mon=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],document.getElementById("create-"+l1[i].id.substring(4)).innerHTML=mon[d2.getMonth()]+" "+d2.getDate()):"TW"==getCookie("lang")||"JP"==getCookie("lang")?document.getElementById("create-"+l1[i].id.substring(4)).innerHTML=d2.getFullYear()+lang.year+(d2.getMonth()+1)+lang.mon+d2.getDate()+lang.date:(mon=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],document.getElementById("create-"+l1[i].id.substring(4)).innerHTML=mon[d2.getMonth()]+" "+d2.getDate()+", "+d2.getFullYear());if(l2=document.getElementsByClassName("ininv"),null!=l2[0])for(i=0;i<l2.length;i+=1)d1=new Date,d2=new Date(l2[i].innerHTML),d1-d2<6e4?document.getElementById("increate-"+l2[i].id.substring(6)).innerHTML=Math.floor((d1-d2)/1e3)+lang.s:d1-d2<36e5?document.getElementById("increate-"+l2[i].id.substring(6)).innerHTML=Math.floor((d1-d2)/6e4)+lang.m:d1-d2<864e5?document.getElementById("increate-"+l2[i].id.substring(6)).innerHTML=Math.floor((d1-d2)/36e5)+lang.h:d1.getFullYear()==d2.getFullYear()?"TW"==getCookie("lang")||"JP"==getCookie("lang")?document.getElementById("increate-"+l2[i].id.substring(6)).innerHTML=d2.getMonth()+1+lang.mon+d2.getDate()+lang.date:(mon=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],document.getElementById("increate-"+l2[i].id.substring(6)).innerHTML=mon[d2.getMonth()]+" "+d2.getDate()):"TW"==getCookie("lang")||"JP"==getCookie("lang")?document.getElementById("increate-"+l2[i].id.substring(6)).innerHTML=d2.getFullYear()+lang.year+(d2.getMonth()+1)+lang.mon+d2.getDate()+lang.date:(mon=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],document.getElementById("increate-"+l2[i].id.substring(6)).innerHTML=mon[d2.getMonth()]+" "+d2.getDate()+", "+d2.getFullYear())}function reAva(e){ava=document.createElement("a"),ava.classList.add("ava"),ava.innerHTML="<span class='icon-user'></span>",e.parentNode.replaceChild(ava,e)}function toPost(e){window.open("/post/"+e.id.substring(5))}function toPostagain(e){window.open("/post/"+e.id.substring(4))}function chkTop(){document.getElementById("content").scrollTop>=100?document.getElementById("top").style.display="block":document.getElementById("top").style.display="none"}function chkTopandSearch(){document.getElementById("content").scrollTop>=100?document.getElementById("top").style.display="block":document.getElementById("top").style.display="none",Math.ceil(document.getElementById("content").scrollTop)+document.getElementById("content").clientHeight>=document.getElementById("content").scrollHeight&&null==document.getElementById("load")&&(div=document.createElement("div"),div.id="load",div.innerHTML="<a class='spinner'></a>",document.getElementById("content").append(div),db.collection("post").where("tag","array-contains",decodeURI(location.href.split("/")[3].substring(9))).orderBy("created","desc").startAfter(cursor).limit(20).onSnapshot((e=>{e.docChanges().forEach((e=>{"added"===e.type&&(tmp_ava=document.createElement("div"),tmp_ava.innerHTML=e.doc.data().ava,tmp_name=document.createElement("div"),tmp_name.innerHTML=e.doc.data().name,tmp_text=document.createElement("div"),tmp_text.innerHTML=e.doc.data().text,tmp_text=format(tmp_text.innerText),tmp=document.createElement("div"),tmp.innerHTML="<div id='post-"+e.doc.id+"' class='post' onclick='toPost(this)'><img class='ava' src='"+tmp_ava.innerText+"' onerror='reAva(this)'><div class='name'>"+tmp_name.innerText+"</div><div class='sep'>·</div><div id='create-"+e.doc.id+"' class='create'></div><div id='inv-"+e.doc.id+"' class='inv'>"+e.doc.data().created.toDate()+"</div><a id='flag-"+e.doc.id+"' class='s-btn right' onclick='flagPost(this, event)' onmouseover='over(this)' onmouseout='out(this)'><span class='icon-flag'></span></a><div class='text'>"+tmp_text+"</div><div id='msg-"+e.doc.id+"' class='m-btn' onmouseover='over(this)' onmouseout='out(this)' data-num='"+e.doc.data().msg+"'><span class='icon-msg'></span>"+count(e.doc.data().msg)+"</div><div id='love-"+e.doc.id+"' class='m-btn' onclick='love(this, event)' onmouseover='over(this)' onmouseout='out(this)' data-num='"+e.doc.data().love+"'><span class='icon-love'></span>"+count(e.doc.data().love)+"</div><div id='share-"+e.doc.id+"' class='m-btn' onclick='share(this, event)' onmouseover='over(this)' onmouseout='out(this)'><span class='icon-share'></span></div></div>",document.getElementById("content").append(tmp),null!=document.getElementById("load")&&document.getElementById("load").remove(),cursor=e.doc.data().created.toDate()),"modified"===e.type&&(document.getElementById("msg-"+e.doc.id).dataset.num=e.doc.data().msg,document.getElementById("msg-"+e.doc.id).innerHTML="<span class='icon-msg'></span>"+count(e.doc.data().msg),document.getElementById("love-"+e.doc.id).dataset.num=e.doc.data().love,document.getElementById("love-"+e.doc.id).innerHTML="<span class='icon-love'></span>"+count(e.doc.data().love)),"removed"===e.type&&document.getElementById("post-"+e.doc.id).parentNode.remove()})),null!=document.getElementById("load")&&document.getElementById("load").remove()})))}function chkTopandIndex(){document.getElementById("content").scrollTop>=100?document.getElementById("top").style.display="block":document.getElementById("top").style.display="none",Math.ceil(document.getElementById("content").scrollTop)+document.getElementById("content").clientHeight>=document.getElementById("content").scrollHeight&&null==document.getElementById("load")&&(div=document.createElement("div"),div.id="load",div.innerHTML="<a class='spinner'></a>",document.getElementById("content").append(div),db.collection("post").orderBy("created","desc").startAfter(cursor).limit(20).onSnapshot((e=>{e.docChanges().forEach((e=>{"added"===e.type&&(tmp_ava=document.createElement("div"),tmp_ava.innerHTML=e.doc.data().ava,tmp_name=document.createElement("div"),tmp_name.innerHTML=e.doc.data().name,tmp_text=document.createElement("div"),tmp_text.innerHTML=e.doc.data().text,tmp_text=format(tmp_text.innerText),tmp=document.createElement("div"),tmp.innerHTML="<div id='post-"+e.doc.id+"' class='post' onclick='toPost(this)'><img class='ava' src='"+tmp_ava.innerText+"' onerror='reAva(this)'><div class='name'>"+tmp_name.innerText+"</div><div class='sep'>·</div><div id='create-"+e.doc.id+"' class='create'></div><div id='inv-"+e.doc.id+"' class='inv'>"+e.doc.data().created.toDate()+"</div><a id='flag-"+e.doc.id+"' class='s-btn right' onclick='flagPost(this, event)' onmouseover='over(this)' onmouseout='out(this)'><span class='icon-flag'></span></a><div class='text'>"+tmp_text+"</div><div id='msg-"+e.doc.id+"' class='m-btn' onmouseover='over(this)' onmouseout='out(this)' data-num='"+e.doc.data().msg+"'><span class='icon-msg'></span>"+count(e.doc.data().msg)+"</div><div id='love-"+e.doc.id+"' class='m-btn' onclick='love(this, event)' onmouseover='over(this)' onmouseout='out(this)' data-num='"+e.doc.data().love+"'><span class='icon-love'></span>"+count(e.doc.data().love)+"</div><div id='share-"+e.doc.id+"' class='m-btn' onclick='share(this, event)' onmouseover='over(this)' onmouseout='out(this)'><span class='icon-share'></span></div></div>",document.getElementById("content").append(tmp),null!=document.getElementById("load")&&document.getElementById("load").remove(),cursor=e.doc.data().created.toDate()),"modified"===e.type&&(document.getElementById("msg-"+e.doc.id).dataset.num=e.doc.data().msg,document.getElementById("msg-"+e.doc.id).innerHTML="<span class='icon-msg'></span>"+count(e.doc.data().msg),document.getElementById("love-"+e.doc.id).dataset.num=e.doc.data().love,document.getElementById("love-"+e.doc.id).innerHTML="<span class='icon-love'></span>"+count(e.doc.data().love)),"removed"===e.type&&document.getElementById("post-"+e.doc.id).parentNode.remove()})),null!=document.getElementById("load")&&document.getElementById("load").remove()})))}function count(e){return"TW"==getCookie("lang")||"JP"==getCookie("lang")?e>=1e4?(e=Math.round(e/1e3)/10)+lang.w:e:e>=1e3?(e=Math.round(e/100)/10)+lang.k:e}function toTop(){document.getElementById("content").scrollTop=0}function morePage(){document.getElementsByTagName("title")[0].innerHTML="More - Dizcourze",document.getElementById("main").innerHTML="<div id='app'><header><a class='s-btn' href='/' target='_blank'><span class='icon-logo'></span></a><input id='srh' type='text' autocomplete='off' placeholder='"+lang.srh+"'><a class='s-btn' onclick='srh()'><span class='icon-search'></span></a><a class='s-btn' href='/more' target='_blank'><span class='icon-more'></span></a></header><div id='content'><div class='more'><div class='l-btn' onclick='chkAbout()'>"+lang.about+"</div><div class='l-btn' onclick='chgTheme()'>"+lang.theme+"</div><div class='l-btn' onclick='chgLang()'>"+lang.lang+"</div><div class='l-btn' onclick='chkDonate()'>"+lang.donate+"</div></div></div><div id='top' onclick='toTop()'><span class='icon-top'></span></div></div><div id='bg'></div>",document.getElementById("content").addEventListener("scroll",chkTop),document.getElementById("srh").addEventListener("keypress",chkSrh)}function chkDonate(){document.getElementById("bg").innerHTML="<div class='box'><a class='s-btn right' onclick='x()'><span class='icon-x'></span></a><div class='space'></div><div class='l-btn' onclick='copyEaddress()'>"+lang["e-address"]+"</div><div class='l-btn' onclick='copyBaddress()'>"+lang["b-address"]+"</div></div>",document.getElementById("bg").style.display="block"}function copyEaddress(){navigator.clipboard.writeText("0x812ad17ea76bEb251CbE70492B503C6Ce2aD0DA7"),document.getElementById("bg").innerHTML="<div class='box'><a class='s-btn right' onclick='x()'><span class='icon-x'></span></a><div class='txt'>"+lang.acc+"</div></div>"}function copyBaddress(){navigator.clipboard.writeText("bc1qndmat9wfqhag4jdpppjq46dyhxxsdv507gglce"),document.getElementById("bg").innerHTML="<div class='box'><a class='s-btn right' onclick='x()'><span class='icon-x'></span></a><div class='txt'>"+lang.acc+"</div></div>"}function chgLang(){document.getElementById("bg").innerHTML="<div class='box'><a class='s-btn right' onclick='x()'><span class='icon-x'></span></a><div class='space'></div><div class='l-btn' onclick='toEn()'>"+lang.en+"</div><div class='l-btn' onclick='toTw()'>"+lang.tw+"</div><div class='l-btn' onclick='toJp()'>"+lang.jp+"</div></div>",document.getElementById("bg").style.display="block"}function toEn(){setCookie("lang","EN",365),location.reload()}function toTw(){setCookie("lang","TW",365),location.reload()}function toJp(){setCookie("lang","JP",365),location.reload()}function chgTheme(){document.getElementById("bg").innerHTML="<div class='box'><a class='s-btn right' onclick='x()'><span class='icon-x'></span></a><div class='space'></div><div class='l-btn' onclick='toLight()'>"+lang.light+"</div><div class='l-btn' onclick='toDark()'>"+lang.dark+"</div></div>",document.getElementById("bg").style.display="block"}function toLight(){setCookie("theme","1",365),location.reload()}function toDark(){setCookie("theme","0",365),location.reload()}function chkAbout(){document.getElementById("bg").innerHTML="<div class='box'><a class='s-btn right' onclick='x()'><span class='icon-x'></span></a><div class='space'></div><div class='l-btn' onclick='toGithub()'>"+lang.github+"</div><div class='l-btn' onclick='copyEmail()'>"+lang.email+"</div></div>",document.getElementById("bg").style.display="block"}function toGithub(){window.open("https://github.com/dizcourze/dizcourze")}function copyEmail(){navigator.clipboard.writeText("contact@dizcourze.com"),document.getElementById("bg").innerHTML="<div class='box'><a class='s-btn right' onclick='x()'><span class='icon-x'></span></a><div class='txt'>"+lang.acc+"</div></div>"}function x(){document.getElementById("bg").style.display="none"}function srh(){""!=document.getElementById("srh").value&&(window.open("/search?q="+document.getElementById("srh").value),document.getElementById("srh").value="")}function chkSrh(){"Enter"===event.key&&srh()}function chkSap(){"Enter"===event.key&&sendPost()}function chkSam(){"Enter"===event.key&&sendMsg()}firebase.initializeApp({projectId:"wxj0u6"});var lang,cursor,db=firebase.firestore();setInterval(setTime,1e3),run();
