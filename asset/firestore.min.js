!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,function(zg){"use strict";try{!function(){var t,e=(t=zg)&&"object"==typeof t&&"default"in t?t:{default:t},r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var a=function(){return(a=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function y(t,s,a,u){return new(a=a||Promise)(function(n,e){function r(t){try{o(u.next(t))}catch(t){e(t)}}function i(t){try{o(u.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(r,i)}o((u=u.apply(t,s||[])).next())})}function g(n,r){var i,o,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(n,a)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function s(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t}function i(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}function u(t){return t=i(t),o.encodeByteArray(t,!0).replace(/\./g,"")}var o={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],s=i+1<t.length,a=s?t[i+1]:0,u=i+2<t.length,c=(15&a)<<2|(h=u?t[i+2]:0)>>6,h=63&h;u||(h=64,s||(c=64)),r.push(n[o>>2],n[(3&o)<<4|a>>4],n[c],n[h])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(i(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i,o,s,a=t[n++];a<128?e[r++]=String.fromCharCode(a):191<a&&a<224?(o=t[n++],e[r++]=String.fromCharCode((31&a)<<6|63&o)):239<a&&a<365?(i=((7&a)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536,e[r++]=String.fromCharCode(55296+(i>>10)),e[r++]=String.fromCharCode(56320+(1023&i))):(o=t[n++],s=t[n++],e[r++]=String.fromCharCode((15&a)<<12|(63&o)<<6|63&s))}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],s=i<t.length?n[t.charAt(i)]:0,a=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==s||null==a||null==u)throw Error();r.push(o<<2|s>>4),64!==a&&(r.push(s<<4&240|a>>2),64!==u&&r.push(a<<6&192|u))}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};function h(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var c,l=(n(f,c=Error),f);function f(t,e,n){return(e=c.call(this,e)||this).code=t,e.customData=n,e.name="FirebaseError",Object.setPrototypeOf(e,f.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,d.prototype.create),e}var d=(p.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r,i=e[0]||{},o=this.service+"/"+t,t=this.errors[t],t=t?(r=i,t.replace(v,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",t=this.serviceName+": "+t+" ("+o+").";return new l(o,t,i)},p);function p(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var m,v=/\{\$([^}]+)}/g;function w(t){return t&&t._delegate?t._delegate:t}function b(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=I[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}(N=m=m||{})[N.DEBUG=0]="DEBUG",N[N.VERBOSE=1]="VERBOSE",N[N.INFO=2]="INFO",N[N.WARN=3]="WARN",N[N.ERROR=4]="ERROR",N[N.SILENT=5]="SILENT";var T={debug:m.DEBUG,verbose:m.VERBOSE,info:m.INFO,warn:m.WARN,error:m.ERROR,silent:m.SILENT},E=m.INFO,I=((ye={})[m.DEBUG]="log",ye[m.VERBOSE]="log",ye[m.INFO]="info",ye[m.WARN]="warn",ye[m.ERROR]="error",ye),_=(Object.defineProperty(S.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in m))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),S.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?T[t]:t},Object.defineProperty(S.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),S.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,m.DEBUG],t)),this._logHandler.apply(this,s([this,m.DEBUG],t))},S.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,m.VERBOSE],t)),this._logHandler.apply(this,s([this,m.VERBOSE],t))},S.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,m.INFO],t)),this._logHandler.apply(this,s([this,m.INFO],t))},S.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,m.WARN],t)),this._logHandler.apply(this,s([this,m.WARN],t))},S.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,m.ERROR],t)),this._logHandler.apply(this,s([this,m.ERROR],t))},S);function S(t){this.name=t,this._logLevel=E,this._logHandler=b,this._userLogHandler=null}var A=function(t,e){return(A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function D(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&r>=t.length?void 0:t)&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var N,C="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},k=C||self;function R(){}function x(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function O(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var L="closure_uid_"+(1e9*Math.random()>>>0),P=0;function M(t,e,n){return t.call.apply(t.bind,arguments)}function F(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function V(t,e,n){return(V=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?M:F).apply(null,arguments)}function U(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function q(t,o){function e(){}e.prototype=o.prototype,t.Z=o.prototype,t.prototype=new e,(t.prototype.constructor=t).Vb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function B(){this.s=this.s,this.o=this.o}var j={};B.prototype.s=!1,B.prototype.na=function(){var t;!this.s&&(this.s=!0,this.M(),0)&&(t=this,t=Object.prototype.hasOwnProperty.call(t,L)&&t[L]||(t[L]=++P),delete j[t])},B.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var K=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},G=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function Q(){return Array.prototype.concat.apply([],arguments)}function H(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function z(t){return/^[\s\xa0]*$/.test(t)}var W=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Y(t,e){return-1!=t.indexOf(e)}function X(t,e){return t<e?-1:e<t?1:0}var $=k.navigator;function J(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Z(t){var e,n={};for(e in t)n[e]=t[e];return n}lt=($=$&&$.userAgent)?$:"";var tt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function et(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<tt.length;i++)e=tt[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function nt(t){return nt[" "](t),t}nt[" "]=R;var rt,it=Y(lt,"Opera"),ot=Y(lt,"Trident")||Y(lt,"MSIE"),st=Y(lt,"Edge"),at=st||ot,ut=Y(lt,"Gecko")&&!(Y(lt.toLowerCase(),"webkit")&&!Y(lt,"Edge"))&&!(Y(lt,"Trident")||Y(lt,"MSIE"))&&!Y(lt,"Edge"),ct=Y(lt.toLowerCase(),"webkit")&&!Y(lt,"Edge");function ht(){var t=k.document;return t?t.documentMode:void 0}var $="",lt=(lt=lt,ut?/rv:([^\);]+)(\)|;)/.exec(lt):st?/Edge\/([\d\.]+)/.exec(lt):ot?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(lt):ct?/WebKit\/(\S+)/.exec(lt):it?/(?:Version)[ \/]?(\S+)/.exec(lt):void 0);lt&&($=lt?lt[1]:""),rt=ot&&null!=(lt=ht())&&lt>parseFloat($)?String(lt):$;var ft={};var dt=k.document&&ot&&(ht()||parseInt(rt,10))||void 0,pt=function(){if(!k.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{k.addEventListener("test",R,e),k.removeEventListener("test",R,e)}catch(t){}return t}();function yt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function gt(t,e){if(yt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(ut){t:{try{nt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:mt[t.pointerType]||"",this.state=t.state,(this.i=t).defaultPrevented&&gt.Z.h.call(this)}}yt.prototype.h=function(){this.defaultPrevented=!0},q(gt,yt);var mt={2:"touch",3:"pen",4:"mouse"};gt.prototype.h=function(){gt.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var vt="closure_listenable_"+(1e6*Math.random()|0),wt=0;function bt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++wt,this.ca=this.fa=!1}function Tt(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function Et(t){this.src=t,this.g={},this.h=0}function It(t,e){var n,r,i,o=e.type;o in t.g&&(n=t.g[o],(i=0<=(r=K(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(Tt(e),0==t.g[o].length&&(delete t.g[o],t.h--)))}function _t(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}Et.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=_t(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new bt(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var St="closure_lm_"+(1e6*Math.random()|0),At={};function Dt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s,a=O(i)?!!i.capture:!!i,u=Rt(t);if(u||(t[St]=u=new Et(t)),(n=u.add(e,n,r,a,o)).proxy)return n;if(s=kt,(n.proxy=r=function t(e){return s.call(t.src,t.listener,e)}).src=t,r.listener=n,t.addEventListener)void 0===(i=pt?i:a)&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ct(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Nt(t){var e,n,r;"number"!=typeof t&&t&&!t.ca&&((e=t.src)&&e[vt]?It(e.i,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ct(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Rt(e))?(It(n,t),0==n.h&&(n.src=null,e[St]=null)):Tt(t)))}function Ct(t){return t in At?At[t]:At[t]="on"+t}function kt(t,e){var n,r;return!!t.ca||(e=new gt(e,this),n=t.listener,r=t.ia||t.src,t.fa&&Nt(t),n.call(r,e))}function Rt(t){return(t=t[St])instanceof Et?t:null}var xt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ot(e){return"function"==typeof e?e:(e[xt]||(e[xt]=function(t){return e.handleEvent(t)}),e[xt])}function Lt(){B.call(this),this.i=new Et(this),(this.P=this).I=null}function Pt(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e?e=new yt(e,t):e instanceof yt?e.target=e.target||t:(s=e,et(e=new yt(r,t),s)),s=!0,n)for(var i=n.length-1;0<=i;i--)var o=e.g=n[i],s=Mt(o,r,!0,e)&&s;if(s=Mt(o=e.g=t,r,!0,e)&&s,s=Mt(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=Mt(o=e.g=n[i],r,!1,e)&&s}function Mt(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,a,u=e[o];u&&!u.ca&&u.capture==n&&(s=u.listener,a=u.ia||u.src,u.fa&&It(t.i,u),i=!1!==s.call(a,r)&&i)}return i&&!r.defaultPrevented}q(Lt,B),Lt.prototype[vt]=!0,Lt.prototype.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=O(i)?!!i.capture:!!i,r=Ot(r),e&&e[vt]?(e=e.i,(n=String(n).toString())in e.g&&-1<(r=_t(s=e.g[n],r,i,o))&&(Tt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.g[n],e.h--))):(e=e&&Rt(e))&&(n=e.g[n.toString()],(r=(e=-1)<(e=n?_t(n,r,i,o):e)?n[e]:null)&&Nt(r))}(this,t,e,n,r)},Lt.prototype.M=function(){if(Lt.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)Tt(n[r]);delete e.g[t],e.h--}}this.I=null},Lt.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Lt.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var Ft=k.JSON.stringify,$=(Vt.prototype.add=function(t,e){var n=Ut.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},Vt);function Vt(){this.h=this.g=null}var Ut=(qt.prototype.get=function(){var t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t},new qt(function(){return new jt},function(t){return t.reset()}));function qt(t,e){this.i=t,this.j=e,this.h=0,this.g=null}var Bt,jt=(Kt.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},Kt.prototype.reset=function(){this.next=this.g=this.h=null},Kt);function Kt(){this.next=this.g=this.h=null}function Gt(t,e){var n;Bt||(n=k.Promise.resolve(void 0),Bt=function(){n.then(zt)}),Qt||(Bt(),Qt=!0),Ht.add(t,e)}var Qt=!1,Ht=new $;function zt(){for(var t;t=void 0,e=null,(t=Ht).g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(t){!function(t){k.setTimeout(function(){throw t},0)}(t)}var e=Ut;e.j(t),e.h<100&&(e.h++,t.next=e.g,e.g=t)}Qt=!1}function Wt(t,e){Lt.call(this),this.h=t||1,this.g=e||k,this.j=V(this.kb,this),this.l=Date.now()}function Yt(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function Xt(t,e,n){if("function"==typeof t)n&&(t=V(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=V(t.handleEvent,t)}return 2147483647<Number(e)?-1:k.setTimeout(t,e||0)}q(Wt,Lt),(N=Wt.prototype).da=!1,N.S=null,N.kb=function(){var t;this.da&&(0<(t=Date.now()-this.l)&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Pt(this,"tick"),this.da&&(Yt(this),this.start())))},N.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},N.M=function(){Wt.Z.M.call(this),Yt(this),delete this.g};var $t,Jt=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}A(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(Zt,$t=B),Zt.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:function t(e){e.g=Xt(function(){e.g=null,e.i&&(e.i=!1,t(e))},e.j);var n=e.h;e.h=null,e.m.apply(null,n)}(this)},Zt.prototype.M=function(){$t.prototype.M.call(this),this.g&&(k.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},Zt);function Zt(t,e){var n=$t.call(this)||this;return n.m=t,n.j=e,n.h=null,n.i=!1,n.g=null,n}function te(t){B.call(this),this.h=t,this.g={}}q(te,B);var ee=[];function ne(t,e,n,r){Array.isArray(n)||(n&&(ee[0]=n.toString()),n=ee);for(var i=0;i<n.length;i++){var o=function t(e,n,r,i,o){if(i&&i.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=Ot(r),e&&e[vt]?e.O(n,r,O(i)?!!i.capture:!!i,o):Dt(e,n,r,!0,i,o)}(e,n,r,i,o);if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=Ot(r),e&&e[vt]?e.N(n,r,O(i)?!!i.capture:!!i,o):Dt(e,n,r,!1,i,o)}(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function re(t){J(t.g,function(t,e){this.g.hasOwnProperty(e)&&Nt(t)},t),t.g={}}function ie(){this.g=!0}function oe(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Ft(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}te.prototype.M=function(){te.Z.M.call(this),re(this)},te.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ie.prototype.Aa=function(){this.g=!1},ie.prototype.info=function(){};var se={},ae=null;function ue(){return ae=ae||new Lt}function ce(t){yt.call(this,se.Ma,t)}function he(){var t=ue();Pt(t,new ce(t))}function le(t,e){yt.call(this,se.STAT_EVENT,t),this.stat=e}function fe(t){var e=ue();Pt(e,new le(e,t))}function de(t,e){yt.call(this,se.Na,t),this.size=e}function pe(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return k.setTimeout(function(){t()},e)}se.Ma="serverreachability",q(ce,yt),se.STAT_EVENT="statevent",q(le,yt),se.Na="timingevent",q(de,yt);var ye={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},C={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function ge(){}function me(t){return t.h||(t.h=t.i())}function ve(){}function we(){yt.call(this,"d")}function be(){yt.call(this,"c")}function Te(){}function Ee(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new te(this),this.P=Se,this.W=new Wt(t=at?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Ie}function Ie(){this.i=null,this.g="",this.h=!1}ge.prototype.h=null,$={OPEN:"a",pb:"b",Ka:"c",Bb:"d"},q(we,yt),q(be,yt),q(Te,ge),Te.prototype.g=function(){return new XMLHttpRequest},Te.prototype.i=function(){return{}};var _e=new Te,Se=45e3,Ae={},De={};function Ne(t,e,n){t.K=1,t.v=Xe(Ge(e)),t.s=n,t.U=!0,Ce(t,null)}function Ce(t,e){t.F=Date.now(),xe(t),t.A=Ge(t.v);var s,a,u,c,h,l,n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),hn(n.h,"t",r),t.C=0,n=t.l.H,t.h=new Ie,t.g=hr(t.l,n?e:null,!t.s),0<t.O&&(t.L=new Jt(V(t.Ia,t,t.g),t.O)),ne(t.V,t.g,"readystatechange",t.gb),e=t.H?Z(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),he(),s=t.j,a=t.u,u=t.A,c=t.m,h=t.X,l=t.s,s.info(function(){if(s.g)if(l)for(var t="",e=l.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=l;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+a+"\n"+u+"\n"+t})}function ke(t){return t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function Re(t,e,n){for(var r,i,o,s,a,u=!0;!t.I&&t.C<n.length;){if(a=void 0,s=(i=t).C,(r=-1==(a=(o=n).indexOf("\n",s))?De:(s=Number(o.substring(s,a)),isNaN(s)?Ae:(a+=1)+s>o.length?De:(o=o.substr(a,s),i.C=a+s,o)))==De){4==e&&(t.o=4,fe(14),u=!1),oe(t.j,t.m,null,"[Incomplete Response]");break}if(r==Ae){t.o=4,fe(15),oe(t.j,t.m,n,"[Invalid Chunk]"),u=!1;break}oe(t.j,t.m,r,null),Fe(t,r)}ke(t)&&r!=De&&r!=Ae&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,fe(16),u=!1),t.i=t.i&&u,u?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),nr(e),e.L=!0,fe(11))):(oe(t.j,t.m,n,"[Invalid Chunked Response]"),Me(t),Pe(t))}function xe(t){t.Y=Date.now()+t.P,Oe(t,t.P)}function Oe(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=pe(V(t.eb,t),e)}function Le(t){t.B&&(k.clearTimeout(t.B),t.B=null)}function Pe(t){0==t.l.G||t.I||or(t.l,t)}function Me(t){Le(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,Yt(t.W),re(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Fe(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||mn(n.i,t)))if(n.I=t.N,!t.J&&mn(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(y){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;ir(n),zn(n)}er(n),fe(18)}}else n.ta=i[1],0<n.ta-n.U&&i[2]<37500&&n.N&&0==n.A&&!n.v&&(n.v=pe(V(n.ab,n),6e3));if(gn(n.i)<=1&&n.ka){try{n.ka()}catch(y){}n.ka=void 0}}else ar(n,11)}else if(!t.J&&n.g!=t||ir(n),!z(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o,s,a,u,c,h,l,f,d,p,y=i[e];n.U=y[0],y=y[1],2==n.G?"c"==y[0]?(n.J=y[1],n.la=y[2],null!=(o=y[3])&&(n.ma=o,n.h.info("VER="+n.ma)),null!=(s=y[4])&&(n.za=s,n.h.info("SVER="+n.za)),null!=(a=y[5])&&"number"==typeof a&&0<a&&(r=1.5*a,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n,(u=t.g)&&(!(c=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null)||!(h=r.i).g&&(Y(c,"spdy")||Y(c,"quic")||Y(c,"h2"))&&(h.j=h.l,h.g=new Set,h.h&&(vn(h,h.h),h.h=null)),!r.D||(l=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.sa=l,Ye(r.F,r.D,l))),n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms")),f=t,(r=n).oa=cr(r,r.H?r.la:null,r.W),f.J?(wn(r.i,f),d=f,(p=r.K)&&d.setTimeout(p),d.B&&(Le(d),xe(d)),r.g=f):tr(r),0<n.l.length&&Xn(n)):"stop"!=y[0]&&"close"!=y[0]||ar(n,7):3==n.G&&("stop"==y[0]||"close"==y[0]?"stop"==y[0]?ar(n,7):Hn(n):"noop"!=y[0]&&n.j&&n.j.wa(y),n.A=0)}he()}catch(y){}}function Ve(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(x(t)||"string"==typeof t)G(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(x(t)||"string"==typeof t)for(var n=[],r=t.length,i=0;i<r;i++)n.push(i);else for(i in n=[],r=0,t)n[r++]=i;for(var i=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(x(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ue(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ue)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function qe(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];Be(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){for(var i={},n=e=0;e<t.g.length;)Be(i,r=t.g[e])||(i[t.g[n++]=r]=1),e++;t.g.length=n}}function Be(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(N=Ee.prototype).setTimeout=function(t){this.P=t},N.gb=function(t){t=t.target;var e=this.L;e&&3==Bn(t)?e.l():this.Ia(t)},N.Ia=function(t){try{if(t==this.g)t:{var e=Bn(this.g),n=this.g.Da();if(this.g.ba(),!(e<3)&&(3!=e||at||this.g&&(this.h.h||this.g.ga()||jn(this.g)))){this.I||4!=e||7==n||he(),Le(this);var r=this.g.ba();this.N=r;e:if(ke(this)){var i=jn(this.g);t="";var o=i.length,s=4==Bn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Me(this),Pe(this);var a="";break e}this.h.i=new k.TextDecoder}for(n=0;n<o;n++)this.h.h=!0,t+=this.h.i.decode(i[n],{stream:s&&n==o-1});i.splice(0,o),this.h.g+=t,this.C=0,a=this.h.g}else a=this.g.ga();if(this.i=200==r,l=this.j,f=this.u,d=this.A,p=this.m,y=this.X,g=e,m=r,l.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+y+"]: "+f+"\n"+d+"\n"+g+" "+m}),this.i){if(this.$&&!this.J){e:{if(this.g){var u,c=this.g;if((u=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!z(u)){var h=u;break e}}h=null}if(!(r=h)){this.i=!1,this.o=3,fe(12),Me(this),Pe(this);break t}oe(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Fe(this,r)}this.U?(Re(this,e,a),at&&this.i&&3==e&&(ne(this.V,this.W,"tick",this.fb),this.W.start())):(oe(this.j,this.m,a,null),Fe(this,a)),4==e&&Me(this),this.i&&!this.I&&(4==e?or(this.l,this):(this.i=!1,xe(this)))}else 400==r&&0<a.indexOf("Unknown SID")?(this.o=3,fe(12)):(this.o=0,fe(13)),Me(this),Pe(this)}}}catch(e){}var l,f,d,p,y,g,m},N.fb=function(){var t,e;this.g&&(t=Bn(this.g),e=this.g.ga(),this.C<e.length&&(Le(this),Re(this,t,e),this.i&&4!=t&&xe(this)))},N.cancel=function(){this.I=!0,Me(this)},N.eb=function(){this.B=null;var t,e,n=Date.now();0<=n-this.Y?(t=this.j,e=this.A,t.info(function(){return"TIMEOUT: "+e}),2!=this.K&&(he(),fe(17)),Me(this),this.o=2,Pe(this)):Oe(this,this.Y-n)},(N=Ue.prototype).R=function(){qe(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},N.T=function(){return qe(this),this.g.concat()},N.get=function(t,e){return Be(this.h,t)?this.h[t]:e},N.set=function(t,e){Be(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},N.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var je=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ke(t,e){var n;this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof Ke?(this.g=void 0!==e?e:t.g,Qe(this,t.j),this.s=t.s,He(this,t.i),ze(this,t.m),this.l=t.l,e=t.h,(n=new sn).i=e.i,e.g&&(n.g=new Ue(e.g),n.h=e.h),We(this,n),this.o=t.o):t&&(n=String(t).match(je))?(this.g=!!e,Qe(this,n[1]||"",!0),this.s=$e(n[2]||""),He(this,n[3]||"",!0),ze(this,n[4]),this.l=$e(n[5]||"",!0),We(this,n[6]||"",!0),this.o=$e(n[7]||"")):(this.g=!!e,this.h=new sn(null,this.g))}function Ge(t){return new Ke(t)}function Qe(t,e,n){t.j=n?$e(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function He(t,e,n){t.i=n?$e(e,!0):e}function ze(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.m=e}else t.m=null}function We(t,e,n){var r,i;e instanceof sn?(t.h=e,r=t.h,(i=t.g)&&!r.j&&(an(r),r.i=null,r.g.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(un(this,e),hn(this,n,t))},r)),r.j=i):(n||(e=Je(e,rn)),t.h=new sn(e,t.g))}function Ye(t,e,n){t.h.set(e,n)}function Xe(t){return Ye(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function $e(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Je(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Ze),n?t.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):t):null}function Ze(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ke.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Je(e,tn,!0),":");var n=this.i;return!n&&"file"!=e||(t.push("//"),(e=this.s)&&t.push(Je(e,tn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(Je(n,"/"==n.charAt(0)?nn:en,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Je(n,on)),t.join("")};var tn=/[#\/\?@]/g,en=/[#\?:]/g,nn=/[#\?]/g,rn=/[#\?@]/g,on=/#/g;function sn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function an(o){o.g||(o.g=new Ue,o.h=0,o.i&&function(t){if(t){t=t.split("&");for(var e=0;e<t.length;e++){var n,r=t[e].indexOf("="),i=null;0<=r?(n=t[e].substring(0,r),i=t[e].substring(r+1)):n=t[e],r=n,i=i?decodeURIComponent(i.replace(/\+/g," ")):"",o.add(decodeURIComponent(r.replace(/\+/g," ")),i)}}}(o.i))}function un(t,e){an(t),e=ln(t,e),Be(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Be((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&qe(t)))}function cn(t,e){return an(t),e=ln(t,e),Be(t.g.h,e)}function hn(t,e,n){un(t,e),0<n.length&&(t.i=null,t.g.set(ln(t,e),H(n)),t.h+=n.length)}function ln(t,e){return e=String(e),t.j?e.toLowerCase():e}(N=sn.prototype).add=function(t,e){an(this),this.i=null,t=ln(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},N.forEach=function(n,r){an(this),this.g.forEach(function(t,e){G(t,function(t){n.call(r,t,e,this)},this)},this)},N.T=function(){an(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},N.R=function(t){an(this);var e=[];if("string"==typeof t)cn(this,t)&&(e=Q(e,this.g.get(ln(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=Q(e,t[n])}return e},N.set=function(t,e){return an(this),this.i=null,cn(this,t=ln(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},N.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},N.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.R(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.i=t.join("&")};function fn(t,e){this.h=t,this.g=e}function dn(t){this.l=t||10,t=k.PerformanceNavigationTiming?0<(t=k.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(k.g&&k.g.Ea&&k.g.Ea()&&k.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var pn;function yn(t){return t.h||t.g&&t.g.size>=t.j}function gn(t){return t.h?1:t.g?t.g.size:0}function mn(t,e){return t.h?t.h==e:t.g&&t.g.has(e)}function vn(t,e){t.g?t.g.add(e):t.h=e}function wn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function bn(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null==t.g||0===t.g.size)return H(t.i);var r=t.i;try{for(var i=D(t.g.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.D)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function Tn(){}function En(){this.g=new Tn}function In(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}function _n(t){this.l=t.$b||null,this.j=t.ib||!1}function Sn(t,e){Lt.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=An,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}dn.prototype.cancel=function(){var t,e;if(this.i=bn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=D(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},Tn.prototype.stringify=function(t){return k.JSON.stringify(t,void 0)},Tn.prototype.parse=function(t){return k.JSON.parse(t,void 0)},q(_n,ge),_n.prototype.g=function(){return new Sn(this.l,this.j)},_n.prototype.i=(pn={},function(){return pn}),q(Sn,Lt);var An=0;function Dn(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function Nn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Cn(t)}function Cn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(N=Sn.prototype).open=function(t,e){if(this.readyState!=An)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Cn(this)},N.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||k).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},N.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Nn(this)),this.readyState=An},N.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Cn(this)),this.g&&(this.readyState=3,Cn(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==k.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Dn(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},N.Sa=function(t){var e;this.g&&(this.u&&t.value?this.response.push(t.value):this.u||(e=t.value||new Uint8Array(0),(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)),(t.done?Nn:Cn)(this),3==this.readyState&&Dn(this))},N.Ua=function(t){this.g&&(this.response=this.responseText=t,Nn(this))},N.Ta=function(t){this.g&&(this.response=t,Nn(this))},N.ha=function(){this.g&&Nn(this)},N.setRequestHeader=function(t,e){this.v.append(t,e)},N.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},N.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Sn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var kn=k.JSON.parse;function Rn(t){Lt.call(this),this.headers=new Ue,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=xn,this.K=this.L=!1}q(Rn,Lt);var xn="",On=/^https?$/i,Ln=["POST","PUT"];function Pn(t){return"content-type"==t.toLowerCase()}function Mn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Fn(t),Un(t)}function Fn(t){t.D||(t.D=!0,Pt(t,"complete"),Pt(t,"error"))}function Vn(t){if(t.h&&(!t.C[1]||4!=Bn(t)||2!=t.ba()))if(t.v&&4==Bn(t))Xt(t.Fa,0,t);else if(Pt(t,"readystatechange"),4==Bn(t)){t.h=!1;try{var e,n,r,i,o=t.ba();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.H).match(je)[1]||null)&&k.self&&k.self.location&&(i=(r=k.self.location.protocol).substr(0,r.length-1)),n=!On.test(i?i.toLowerCase():"")),e=n),e)Pt(t,"complete"),Pt(t,"success");else{t.m=6;try{var a=2<Bn(t)?t.g.statusText:""}catch(t){a=""}t.j=a+" ["+t.ba()+"]",Fn(t)}}finally{Un(t)}}}function Un(t,e){if(t.g){qn(t);var n=t.g,r=t.C[0]?R:null;t.g=null,t.C=null,e||Pt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function qn(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(k.clearTimeout(t.A),t.A=null)}function Bn(t){return t.g?t.g.readyState:0}function jn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case xn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Kn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",J(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Ye(t,e,n))}function Gn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Qn(t){this.za=0,this.l=[],this.h=new ie,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Gn("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Gn("baseRetryDelayMs",5e3,t),this.$a=Gn("retryDelaySeedMs",1e4,t),this.Ya=Gn("forwardChannelMaxRetries",2,t),this.ra=Gn("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new dn(t&&t.concurrentRequestLimit),this.Ca=new En,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function Hn(t){var e,n;Wn(t),3==t.G&&(e=t.V++,Ye(n=Ge(t.F),"SID",t.J),Ye(n,"RID",e),Ye(n,"TYPE","terminate"),Jn(t,n),(e=new Ee(t,t.h,e,void 0)).K=2,e.v=Xe(Ge(n)),n=!1,!(n=k.navigator&&k.navigator.sendBeacon?k.navigator.sendBeacon(e.v.toString(),""):n)&&k.Image&&((new Image).src=e.v,n=!0),n||(e.g=hr(e.l,null),e.g.ea(e.v)),e.F=Date.now(),xe(e)),ur(t)}function zn(t){t.g&&(nr(t),t.g.cancel(),t.g=null)}function Wn(t){zn(t),t.u&&(k.clearTimeout(t.u),t.u=null),ir(t),t.i.cancel(),t.m&&("number"==typeof t.m&&k.clearTimeout(t.m),t.m=null)}function Yn(t,e){t.l.push(new fn(t.Za++,e)),3==t.G&&Xn(t)}function Xn(t){yn(t.i)||t.m||(t.m=!0,Gt(t.Ha,t),t.C=0)}function $n(t,e){var n=e?e.m:t.V++,r=Ge(t.F);Ye(r,"SID",t.J),Ye(r,"RID",n),Ye(r,"AID",t.U),Jn(t,r),t.o&&t.s&&Kn(r,t.o,t.s),n=new Ee(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=Zn(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),vn(t.i,n),Ne(n,r,e)}function Jn(t,n){t.j&&Ve({},function(t,e){Ye(n,e,t)})}function Zn(t,e,n){n=Math.min(t.l.length,n);var r=t.j?V(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].h,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if((c-=o)<0)o=Math.max(0,i[u].h-100),a=!1;else try{!function(t,r){var i="req"+c+"_"||"";try{Ve(t,function(t,e){var n=t;O(t)&&(n=Ft(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}(h,s)}catch(t){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function tr(t){t.g||t.u||(t.Y=1,Gt(t.Ga,t),t.A=0)}function er(t){return!(t.g||t.u||3<=t.A)&&(t.Y++,t.u=pe(V(t.Ga,t),sr(t,t.A)),t.A++,1)}function nr(t){null!=t.B&&(k.clearTimeout(t.B),t.B=null)}function rr(t){t.g=new Ee(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Ge(t.oa);Ye(e,"RID","rpc"),Ye(e,"SID",t.J),Ye(e,"CI",t.N?"0":"1"),Ye(e,"AID",t.U),Jn(t,e),Ye(e,"TYPE","xmlhttp"),t.o&&t.s&&Kn(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=Xe(Ge(e)),n.s=null,n.U=!0,Ce(n,t)}function ir(t){null!=t.v&&(k.clearTimeout(t.v),t.v=null)}function or(t,e){var n,r,i,o=null;if(t.g==e){ir(t),nr(t),t.g=null;var s=2}else{if(!mn(t.i,e))return;o=e.D,wn(t.i,e),s=1}if(t.I=e.N,0!=t.G)if(e.i)1==s?(o=e.s?e.s.length:0,e=Date.now()-e.F,n=t.C,Pt(s=ue(),new de(s,o)),Xn(t)):tr(t);else if(3==(n=e.o)||0==n&&0<t.I||(1!=s||(i=e,gn((r=t).i)>=r.i.j-(r.m?1:0)||(r.m?(r.l=i.D.concat(r.l),0):1==r.G||2==r.G||r.C>=(r.Xa?0:r.Ya)||(r.m=pe(V(r.Ha,r,i),sr(r,r.C)),r.C++,0))))&&(2!=s||!er(t)))switch(o&&0<o.length&&(e=t.i,e.i=e.i.concat(o)),n){case 1:ar(t,5);break;case 4:ar(t,10);break;case 3:ar(t,6);break;default:ar(t,2)}}function sr(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function ar(t,e){var n,r,i,o;t.h.info("Error code "+e),2==e?(r=null,t.j&&(r=null),o=V(t.jb,t),r||(r=new Ke("//www.google.com/images/cleardot.gif"),k.location&&"http"==k.location.protocol||Qe(r,"https"),Xe(r)),n=r.toString(),r=o,o=new ie,k.Image?((i=new Image).onload=U(In,o,i,"TestLoadImage: loaded",!0,r),i.onerror=U(In,o,i,"TestLoadImage: error",!1,r),i.onabort=U(In,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=U(In,o,i,"TestLoadImage: timeout",!1,r),k.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):fe(2),t.G=0,t.j&&t.j.va(e),ur(t),Wn(t)}function ur(t){t.G=0,t.I=-1,t.j&&(0==bn(t.i).length&&0==t.l.length||(t.i.i.length=0,H(t.l),t.l.length=0),t.j.ua())}function cr(t,e,n){var r,i,o,s,a,u=(s=n)instanceof Ke?Ge(s):new Ke(s,void 0);return""!=u.i?(e&&He(u,e+"."+u.i),ze(u,u.m)):(r=(a=k.location).protocol,i=e?e+"."+a.hostname:a.hostname,o=+a.port,s=n,a=new Ke(null,void 0),r&&Qe(a,r),i&&He(a,i),o&&ze(a,o),s&&(a.l=s),u=a),t.aa&&J(t.aa,function(t,e){Ye(u,e,t)}),e=t.D,n=t.sa,e&&n&&Ye(u,e,n),Ye(u,"VER",t.ma),Jn(t,u),u}function hr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ba&&!t.qa?new Rn(new _n({ib:!0})):new Rn(t.qa)).L=t.H,e}function lr(){}function fr(){if(ot&&!(10<=Number(dt)))throw Error("Environmental error: no available transport.")}function dr(t,e){Lt.call(this),this.g=new Qn(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!z(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!z(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new gr(this)}function pr(t){we.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function yr(){be.call(this),this.status=1}function gr(t){this.g=t}(N=Rn.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||_e).g(),this.C=this.u?me(this.u):me(_e),this.g.onreadystatechange=V(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void Mn(this,t)}t=n||"";var i,o,s,a=new Ue(this.headers);r&&Ve(r,function(t,e){a.set(e,t)}),r=function(t){t:{for(var e=Pn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(a.T()),n=k.FormData&&t instanceof k.FormData,0<=K(Ln,e)&&!r&&!n&&a.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),a.forEach(function(t,e){this.g.setRequestHeader(e,t)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{qn(this),0<this.B&&((this.K=(i=this.g,ot&&(o=function(){for(var t=0,e=W(String(rt)).split("."),n=W("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++)for(var o=e[i]||"",s=n[i]||"";o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],(0!=o[0].length||0!=s[0].length)&&(t=X(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||X(0==o[2].length,0==s[2].length)||X(o[2],s[2]),o=o[3],s=s[3],0==t););return 0<=t},s=ft,Object.prototype.hasOwnProperty.call(s,9)?s[9]:s[9]=o())&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=V(this.pa,this)):this.A=Xt(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Mn(this,t)}},N.pa=function(){this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Pt(this,"timeout"),this.abort(8))},N.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Pt(this,"complete"),Pt(this,"abort"),Un(this))},N.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Un(this,!0)),Rn.Z.M.call(this)},N.Fa=function(){this.s||(this.F||this.v||this.l?Vn(this):this.cb())},N.cb=function(){Vn(this)},N.ba=function(){try{return 2<Bn(this)?this.g.status:-1}catch(t){return-1}},N.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},N.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),kn(e)}},N.Da=function(){return this.m},N.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(N=Qn.prototype).ma=8,N.G=1,N.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(t){}},N.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new Ee(this,this.h,t,void 0),n=this.s;if(this.P&&(n?et(n=Z(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=Zn(this,e,r),Ye(i=Ge(this.F),"RID",t),Ye(i,"CVER",22),this.D&&Ye(i,"X-HTTP-Session-Id",this.D),Jn(this,i),this.o&&n&&Kn(i,this.o,n),vn(this.i,e),this.Ra&&Ye(i,"TYPE","init"),this.ja?(Ye(i,"$req",r),Ye(i,"SID","null"),e.$=!0,Ne(e,i,null)):Ne(e,i,r),this.G=2}}else 3==this.G&&(t?$n(this,t):0==this.l.length||yn(this.i)||$n(this))},N.Ga=function(){var t;this.u=null,rr(this),this.$&&!(this.L||null==this.g||this.O<=0)&&(t=2*this.O,this.h.info("BP detection timer enabled: "+t),this.B=pe(V(this.bb,this),t))},N.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,fe(10),zn(this),rr(this))},N.ab=function(){null!=this.v&&(this.v=null,zn(this),er(this),fe(19))},N.jb=function(t){t?(this.h.info("Successfully pinged google.com"),fe(2)):(this.h.info("Failed to ping google.com"),fe(1))},(N=lr.prototype).xa=function(){},N.wa=function(){},N.va=function(){},N.ua=function(){},N.Oa=function(){},fr.prototype.g=function(t,e){return new dr(t,e)},q(dr,Lt),dr.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Gt(V(t.hb,t,e))),fe(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=cr(t,null,t.W),Xn(t)},dr.prototype.close=function(){Hn(this.g)},dr.prototype.u=function(t){var e;"string"==typeof t?((e={}).__data__=t,Yn(this.g,e)):this.v?((e={}).__data__=Ft(t),Yn(this.g,e)):Yn(this.g,t)},dr.prototype.M=function(){this.g.j=null,delete this.j,Hn(this.g),delete this.g,dr.Z.M.call(this)},q(pr,we),q(yr,be),q(gr,lr),gr.prototype.xa=function(){Pt(this.g,"a")},gr.prototype.wa=function(t){Pt(this.g,new pr(t))},gr.prototype.va=function(t){Pt(this.g,new yr)},gr.prototype.ua=function(){Pt(this.g,"b")},fr.prototype.createWebChannel=fr.prototype.g,dr.prototype.send=dr.prototype.u,dr.prototype.open=dr.prototype.m,ye.NO_ERROR=0,ye.TIMEOUT=8,ye.HTTP_ERROR=6,C.COMPLETE="complete",(ve.EventType=$).OPEN="a",$.CLOSE="b",$.ERROR="c",$.MESSAGE="d",Lt.prototype.listen=Lt.prototype.N,Rn.prototype.listenOnce=Rn.prototype.O,Rn.prototype.getLastError=Rn.prototype.La,Rn.prototype.getLastErrorCode=Rn.prototype.Da,Rn.prototype.getStatus=Rn.prototype.ba,Rn.prototype.getResponseJson=Rn.prototype.Qa,Rn.prototype.getResponseText=Rn.prototype.ga,Rn.prototype.send=Rn.prototype.ea;var mr=ue,vr=ye,wr=C,br=se,Tr=_n,Er=ve,Ir=Rn,_r=(Sr.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Sr.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},Sr);function Sr(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}_r.o=-1;var Ar,Dr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Nr=(n(kr,Ar=Error),kr),Cr=new _("@firebase/firestore");function kr(t,e){var n=this;return(n=Ar.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Rr(){return Cr.logLevel}function xr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Cr.logLevel<=m.DEBUG&&(e=n.map(Pr),Cr.debug.apply(Cr,s(["Firestore (8.10.1): "+t],e)))}function Or(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Cr.logLevel<=m.ERROR&&(e=n.map(Pr),Cr.error.apply(Cr,s(["Firestore (8.10.1): "+t],e)))}function Lr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Cr.logLevel<=m.WARN&&(e=n.map(Pr),Cr.warn.apply(Cr,s(["Firestore (8.10.1): "+t],e)))}function Pr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function Mr(t){throw Or(t="FIRESTORE (8.10.1) INTERNAL ASSERTION FAILED: "+(void 0===t?"Unexpected state":t)),new Error(t)}function Fr(t){t||Mr()}var Vr=(Ur.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),e=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(e);else for(var n=0;n<40;n++)e[n]=Math.floor(256*Math.random());return e}(),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Ur);function Ur(){}function qr(t,e){return t<e?-1:e<t?1:0}function Br(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function jr(t){return t+"\0"}var Kr=(Hr.now=function(){return Hr.fromMillis(Date.now())},Hr.fromDate=function(t){return Hr.fromMillis(t.getTime())},Hr.fromMillis=function(t){var e=Math.floor(t/1e3);return new Hr(e,Math.floor(1e6*(t-1e3*e)))},Hr.prototype.toDate=function(){return new Date(this.toMillis())},Hr.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Hr.prototype._compareTo=function(t){return this.seconds===t.seconds?qr(this.nanoseconds,t.nanoseconds):qr(this.seconds,t.seconds)},Hr.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},Hr.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Hr.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},Hr.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},Hr),Gr=(Qr.fromTimestamp=function(t){return new Qr(t)},Qr.min=function(){return new Qr(new Kr(0,0))},Qr.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},Qr.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Qr.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Qr.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Qr.prototype.toTimestamp=function(){return this.timestamp},Qr);function Qr(t){this.timestamp=t}function Hr(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Nr(Dr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Nr(Dr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Nr(Dr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Nr(Dr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function zr(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function Wr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Yr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Xr,$r,C=(Object.defineProperty(ai.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),ai.prototype.isEqual=function(t){return 0===ai.comparator(this,t)},ai.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof ai?t.forEach(function(t){e.push(t)}):e.push(t),this.construct(e)},ai.prototype.limit=function(){return this.offset+this.length},ai.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},ai.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},ai.prototype.firstSegment=function(){return this.segments[this.offset]},ai.prototype.lastSegment=function(){return this.get(this.length-1)},ai.prototype.get=function(t){return this.segments[this.offset+t]},ai.prototype.isEmpty=function(){return 0===this.length},ai.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ai.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ai.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},ai.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},ai.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},ai),Jr=(n(si,$r=C),si.prototype.construct=function(t,e,n){return new si(t,e,n)},si.prototype.canonicalString=function(){return this.toArray().join("/")},si.prototype.toString=function(){return this.canonicalString()},si.fromString=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new Nr(Dr.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter(function(t){return 0<t.length}))}return new si(n)},si.emptyPath=function(){return new si([])},si),Zr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ti=(n(oi,Xr=C),oi.prototype.construct=function(t,e,n){return new oi(t,e,n)},oi.isValidIdentifier=function(t){return Zr.test(t)},oi.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),oi.isValidIdentifier(t)?t:"`"+t+"`"}).join(".")},oi.prototype.toString=function(){return this.canonicalString()},oi.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},oi.keyField=function(){return new oi(["__name__"])},oi.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Nr(Dr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Nr(Dr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[r+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new Nr(Dr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=a,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Nr(Dr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new oi(e)},oi.emptyPath=function(){return new oi([])},oi),ei=(ii.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},ii.prototype.isEqual=function(t){return Br(this.fields,t.fields,function(t,e){return t.isEqual(e)})},ii),ni=(ri.fromBase64String=function(t){return new ri(atob(t))},ri.fromUint8Array=function(t){return new ri(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},ri.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},ri.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},ri.prototype.approximateByteSize=function(){return 2*this.binaryString.length},ri.prototype.compareTo=function(t){return qr(this.binaryString,t.binaryString)},ri.prototype.isEqual=function(t){return this.binaryString===t.binaryString},ri);function ri(t){this.binaryString=t}function ii(t){(this.fields=t).sort(ti.comparator)}function oi(){return null!==Xr&&Xr.apply(this,arguments)||this}function si(){return null!==$r&&$r.apply(this,arguments)||this}function ai(t,e,n){void 0===e?e=0:e>t.length&&Mr(),void 0===n?n=t.length-e:n>t.length-e&&Mr(),this.segments=t,this.offset=e,this.len=n}ni.EMPTY_BYTE_STRING=new ni("");var ui=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ci(t){if(Fr(!!t),"string"!=typeof t)return{seconds:hi(t.seconds),nanos:hi(t.nanos)};var e=0,n=ui.exec(t);return Fr(!!n),n[1]&&(n=(n[1]+"000000000").substr(0,9),e=Number(n)),t=new Date(t),{seconds:Math.floor(t.getTime()/1e3),nanos:e}}function hi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function li(t){return"string"==typeof t?ni.fromBase64String(t):ni.fromUint8Array(t)}function fi(t){return"server_timestamp"===(null===(t=((null===(t=null==t?void 0:t.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function di(t){return t=ci(t.mapValue.fields.__local_write_time__.timestampValue),new Kr(t.seconds,t.nanos)}function pi(t){return null==t}function yi(t){return 0===t&&1/t==-1/0}function gi(t){return"number"==typeof t&&Number.isInteger(t)&&!yi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var mi=(vi.fromPath=function(t){return new vi(Jr.fromString(t))},vi.fromName=function(t){return new vi(Jr.fromString(t).popFirst(5))},vi.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},vi.prototype.isEqual=function(t){return null!==t&&0===Jr.comparator(this.path,t.path)},vi.prototype.toString=function(){return this.path.toString()},vi.comparator=function(t,e){return Jr.comparator(t.path,e.path)},vi.isDocumentKey=function(t){return t.length%2==0},vi.fromSegments=function(t){return new vi(new Jr(t.slice()))},vi);function vi(t){this.path=t}function wi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?fi(t)?4:10:Mr()}function bi(r,i){var t,e,n=wi(r);if(n!==wi(i))return!1;switch(n){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return di(r).isEqual(di(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=ci(r.timestampValue),t=ci(t.timestampValue);return e.seconds===t.seconds&&e.nanos===t.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return e=i,li(r.bytesValue).isEqual(li(e.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return t=i,hi((e=r).geoPointValue.latitude)===hi(t.geoPointValue.latitude)&&hi(e.geoPointValue.longitude)===hi(t.geoPointValue.longitude);case 2:return e=i,"integerValue"in(t=r)&&"integerValue"in e?hi(t.integerValue)===hi(e.integerValue):"doubleValue"in t&&"doubleValue"in e&&((t=hi(t.doubleValue))===(e=hi(e.doubleValue))?yi(t)===yi(e):isNaN(t)&&isNaN(e));case 9:return Br(r.arrayValue.values||[],i.arrayValue.values||[],bi);case 10:return function(){var t,e=r.mapValue.fields||{},n=i.mapValue.fields||{};if(zr(e)!==zr(n))return!1;for(t in e)if(e.hasOwnProperty(t)&&(void 0===n[t]||!bi(e[t],n[t])))return!1;return!0}();default:return Mr()}}function Ti(t,e){return void 0!==(t.values||[]).find(function(t){return bi(t,e)})}function Ei(t,e){var n,r,i,o,s=wi(t),a=wi(e);if(s!==a)return qr(s,a);switch(s){case 0:return 0;case 1:return qr(t.booleanValue,e.booleanValue);case 2:return n=e,(r=hi(t.integerValue||t.doubleValue))<(n=hi(n.integerValue||n.doubleValue))?-1:n<r?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1;case 3:return Ii(t.timestampValue,e.timestampValue);case 4:return Ii(di(t),di(e));case 5:return qr(t.stringValue,e.stringValue);case 6:return i=t.bytesValue,o=e.bytesValue,i=li(i),o=li(o),i.compareTo(o);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=qr(n[i],r[i]);if(0!==o)return o}return qr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return o=t.geoPointValue,r=e.geoPointValue,0!==(n=qr(hi(o.latitude),hi(r.latitude)))?n:qr(hi(o.longitude),hi(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Ei(n[i],r[i]);if(o)return o}return qr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=qr(r[s],o[s]);if(0!==a)return a;if(0!==(a=Ei(n[r[s]],i[o[s]])))return a}return qr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Mr()}}function Ii(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return qr(t,e);var n=ci(t),t=ci(e);return 0!==(e=qr(n.seconds,t.seconds))?e:qr(n.nanos,t.nanos)}function _i(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?(t=0,"time("+(t=ci(t=i.timestampValue)).seconds+","+t.nanos+")"):"stringValue"in i?i.stringValue:"bytesValue"in i?li(i.bytesValue).toBase64():"referenceValue"in i?(e=i.referenceValue,mi.fromName(e).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++)e?e=!1:t+=",",t+=s(r[n]);return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):Mr();var t,e}(t)}function Si(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Ai(t){return t&&"integerValue"in t}function Di(t){return!!t&&"arrayValue"in t}function Ni(t){return t&&"nullValue"in t}function Ci(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function ki(t){return t&&"mapValue"in t}function Ri(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){var n={mapValue:{fields:{}}};return Wr(t.mapValue.fields,function(t,e){return n.mapValue.fields[t]=Ri(e)}),n}if(t.arrayValue){for(var e={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)e.arrayValue.values[r]=Ri(t.arrayValue.values[r]);return e}return Object.assign({},t)}var xi=(Oi.empty=function(){return new Oi({mapValue:{}})},Oi.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!ki(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e.mapValue.fields||{})[t.lastSegment()]||null},Oi.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Ri(e)},Oi.prototype.setAll=function(t){var r=this,i=ti.emptyPath(),o={},s=[];t.forEach(function(t,e){var n;i.isImmediateParentOf(e)||(n=r.getFieldsMap(i),r.applyChanges(n,o,s),o={},s=[],i=e.popLast()),t?o[e.lastSegment()]=Ri(t):s.push(e.lastSegment())}),t=this.getFieldsMap(i),this.applyChanges(t,o,s)},Oi.prototype.delete=function(t){var e=this.field(t.popLast());ki(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},Oi.prototype.isEqual=function(t){return bi(this.value,t.value)},Oi.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];ki(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},Oi.prototype.applyChanges=function(n,t,e){Wr(t,function(t,e){return n[t]=e});for(var r=0,i=e;r<i.length;r++){var o=i[r];delete n[o]}},Oi.prototype.clone=function(){return new Oi(Ri(this.value))},Oi);function Oi(t){this.value=t}function Li(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null}var Pi=(Mi.newInvalidDocument=function(t){return new Mi(t,0,Gr.min(),xi.empty(),0)},Mi.newFoundDocument=function(t,e,n){return new Mi(t,1,e,n,0)},Mi.newNoDocument=function(t,e){return new Mi(t,2,e,xi.empty(),0)},Mi.newUnknownDocument=function(t,e){return new Mi(t,3,e,xi.empty(),2)},Mi.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},Mi.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=xi.empty(),this.documentState=0,this},Mi.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=xi.empty(),this.documentState=2,this},Mi.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},Mi.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(Mi.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(Mi.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(Mi.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),Mi.prototype.isValidDocument=function(){return 0!==this.documentType},Mi.prototype.isFoundDocument=function(){return 1===this.documentType},Mi.prototype.isNoDocument=function(){return 2===this.documentType},Mi.prototype.isUnknownDocument=function(){return 3===this.documentType},Mi.prototype.isEqual=function(t){return t instanceof Mi&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)},Mi.prototype.clone=function(){return new Mi(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},Mi.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},Mi);function Mi(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}function Fi(t,e,n,r,i,o,s){return new Li(t,e=void 0===e?null:e,n=void 0===n?[]:n,r=void 0===r?[]:r,i=void 0===i?null:i,o=void 0===o?null:o,s=void 0===s?null:s)}function Vi(t){var e=t;return null===e.h&&(t=e.path.canonicalString(),null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(function(t){return t.field.canonicalString()+t.op.toString()+_i(t.value)}).join(","),t+="|ob:",t+=e.orderBy.map(function(t){return t.field.canonicalString()+t.dir}).join(","),pi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=po(e.startAt)),e.endAt&&(t+="|ub:",t+=po(e.endAt)),e.h=t),e.h}function Ui(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,a=0;a<t.filters.length;a++)if(o=t.filters[a],s=e.filters[a],o.op!==s.op||!o.field.isEqual(s.field)||!bi(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!mo(t.startAt,e.startAt)&&mo(t.endAt,e.endAt)}function qi(t){return mi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Bi,ji=(n(Ki,Bi=function(){}),Ki.create=function(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.l(t,e,n):new zi(t,e,n):"array-contains"===e?new io(t,n):"in"===e?new oo(t,n):"not-in"===e?new so(t,n):"array-contains-any"===e?new ao(t,n):new Ki(t,e,n)},Ki.l=function(t,e,n){return new("in"===e?Wi:Yi)(t,n)},Ki.prototype.matches=function(t){return t=t.data.field(this.field),"!="===this.op?null!==t&&this.m(Ei(t,this.value)):null!==t&&wi(this.value)===wi(t)&&this.m(Ei(t,this.value))},Ki.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return Mr()}},Ki.prototype.g=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},Ki);function Ki(t,e,n){var r=this;return(r=Bi.call(this)||this).field=t,r.op=e,r.value=n,r}var Gi,Qi,Hi,zi=(n(Ji,Hi=ji),Ji.prototype.matches=function(t){return t=mi.comparator(t.key,this.key),this.m(t)},Ji),Wi=(n($i,Qi=ji),$i.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},$i),Yi=(n(Xi,Gi=ji),Xi.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},Xi);function Xi(t,e){var n=this;return(n=Gi.call(this,t,"not-in",e)||this).keys=Zi(0,e),n}function $i(t,e){var n=this;return(n=Qi.call(this,t,"in",e)||this).keys=Zi(0,e),n}function Ji(t,e,n){var r=this;return(r=Hi.call(this,t,e,n)||this).key=mi.fromName(n.referenceValue),r}function Zi(t,e){return((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map(function(t){return mi.fromName(t.referenceValue)})}var to,eo,no,ro,io=(n(fo,ro=ji),fo.prototype.matches=function(t){return Di(t=t.data.field(this.field))&&Ti(t.arrayValue,this.value)},fo),oo=(n(lo,no=ji),lo.prototype.matches=function(t){return null!==(t=t.data.field(this.field))&&Ti(this.value.arrayValue,t)},lo),so=(n(ho,eo=ji),ho.prototype.matches=function(t){return!Ti(this.value.arrayValue,{nullValue:"NULL_VALUE"})&&(null!==(t=t.data.field(this.field))&&!Ti(this.value.arrayValue,t))},ho),ao=(n(co,to=ji),co.prototype.matches=function(t){var e=this;return!(!Di(t=t.data.field(this.field))||!t.arrayValue.values)&&t.arrayValue.values.some(function(t){return Ti(e.value.arrayValue,t)})},co),uo=function(t,e){this.position=t,this.before=e};function co(t,e){return to.call(this,t,"array-contains-any",e)||this}function ho(t,e){return eo.call(this,t,"not-in",e)||this}function lo(t,e){return no.call(this,t,"in",e)||this}function fo(t,e){return ro.call(this,t,"array-contains",e)||this}function po(t){return(t.before?"b":"a")+":"+t.position.map(_i).join(",")}var yo=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function go(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.isKeyField()?mi.comparator(mi.fromName(s.referenceValue),n.key):Ei(s,n.data.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function mo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!bi(t.position[n],e.position[n]))return!1;return!0}var vo=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function wo(t,e,n,r,i,o,s,a){return new vo(t,e,n,r,i,o,s,a)}function bo(t){return new vo(t)}function To(t){return!pi(t.limit)&&"F"===t.limitType}function Eo(t){return!pi(t.limit)&&"L"===t.limitType}function Io(t){return 0<t.explicitOrderBy.length?t.explicitOrderBy[0].field:null}function _o(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function So(t){return null!==t.collectionGroup}function Ao(t){var e=t;if(null===e.p){e.p=[];var n=_o(e),t=Io(e);if(null!==n&&null===t)n.isKeyField()||e.p.push(new yo(n)),e.p.push(new yo(ti.keyField(),"asc"));else{for(var r=!1,i=0,o=e.explicitOrderBy;i<o.length;i++){var s=o[i];e.p.push(s),s.field.isKeyField()&&(r=!0)}r||(n=0<e.explicitOrderBy.length?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",e.p.push(new yo(ti.keyField(),n)))}}return e.p}function Do(t){var e=t;if(!e.T)if("F"===e.limitType)e.T=Fi(e.path,e.collectionGroup,Ao(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Ao(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new yo(o.field,s))}var a=e.endAt?new uo(e.endAt.position,!e.endAt.before):null,t=e.startAt?new uo(e.startAt.position,!e.startAt.before):null;e.T=Fi(e.path,e.collectionGroup,n,e.filters,e.limit,a,t)}return e.T}function No(t,e,n){return new vo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Co(t,e){return Ui(Do(t),Do(e))&&t.limitType===e.limitType}function ko(t){return Vi(Do(t))+"|lt:"+t.limitType}function Ro(t){return"Query(target="+(n=(e=Do(t)).path.canonicalString(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return t.field.canonicalString()+" "+t.op+" "+_i(t.value)}).join(", ")+"]"),pi(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return t.field.canonicalString()+" ("+t.dir+")"}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+po(e.startAt)),e.endAt&&(n+=", endAt: "+po(e.endAt)),"Target("+n+")")+"; limitType="+t.limitType+")";var e,n}function xo(i,t){return t.isFoundDocument()&&(n=t.key.path,null!==(e=i).collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):mi.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n))&&function(t){for(var e=0,n=i.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.data.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(t=i).startAt||go(t.startAt,Ao(t),n))&&(!t.endAt||!go(t.endAt,Ao(t),n)));var e,n}function Oo(a){return function(t,e){for(var n=!1,r=0,i=Ao(a);r<i.length;r++){var o=i[r],s=function(t,e,n){var r,i=t.field.isKeyField()?mi.comparator(e.key,n.key):(r=t.field,n=n,e=e.data.field(r),r=n.data.field(r),null!==e&&null!==r?Ei(e,r):Mr());switch(t.dir){case"asc":return i;case"desc":return-1*i;default:return Mr()}}(o,t,e);if(0!==s)return s;n=n||o.field.isKeyField()}return 0}}function Lo(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:yi(e)?"-0":e}}function Po(t){return{integerValue:""+t}}function Mo(t,e){return gi(e)?Po(e):Lo(t,e)}function Fo(t,e){return t instanceof Xo?Ai(t=e)||t&&"doubleValue"in t?e:{integerValue:0}:null}var Vo,Uo,qo=(n(Ko,Uo=_=function(){this._=void 0}),Ko),Bo=(n(jo,Vo=_),jo);function jo(t){var e=this;return(e=Vo.call(this)||this).elements=t,e}function Ko(){return null!==Uo&&Uo.apply(this,arguments)||this}function Go(t,e){for(var n=Zo(e),r=0,i=t.elements;r<i.length;r++)!function(e){n.some(function(t){return bi(t,e)})||n.push(e)}(i[r]);return{arrayValue:{values:n}}}var Qo,Ho=(n(zo,Qo=_),zo);function zo(t){var e=this;return(e=Qo.call(this)||this).elements=t,e}function Wo(t,e){for(var n=Zo(e),r=0,i=t.elements;r<i.length;r++)!function(e){n=n.filter(function(t){return!bi(t,e)})}(i[r]);return{arrayValue:{values:n}}}var Yo,Xo=(n($o,Yo=_),$o);function $o(t,e){var n=this;return(n=Yo.call(this)||this).R=t,n.A=e,n}function Jo(t){return hi(t.integerValue||t.doubleValue)}function Zo(t){return Di(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function ts(t,e){this.version=t,this.transformResults=e}var es=function(t,e){this.field=t,this.transform=e},ns=(rs.none=function(){return new rs},rs.exists=function(t){return new rs(void 0,t)},rs.updateTime=function(t){return new rs(t)},Object.defineProperty(rs.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),rs.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},rs);function rs(t,e){this.updateTime=t,this.exists=e}function is(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}function os(t,e,n){var r,i,o,s;t instanceof hs?(o=n,is((r=t).precondition,i=e)&&(s=r.value.clone(),o=gs(r.fieldTransforms,o,i),s.setAll(o),i.convertToFoundDocument(as(i),s).setHasLocalMutations())):t instanceof ls?(i=n,is((s=t).precondition,o=e)&&(n=gs(s.fieldTransforms,i,o),(i=o.data).setAll(ps(s)),i.setAll(n),o.convertToFoundDocument(as(o),i).setHasLocalMutations())):is(t.precondition,e)&&e.convertToNoDocument(Gr.min())}function ss(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&Br(n,r,function(t,e){return t.field.isEqual(e.field)&&(t=t.transform,e=e.transform,t instanceof Bo&&e instanceof Bo||t instanceof Ho&&e instanceof Ho?Br(t.elements,e.elements,bi):t instanceof Xo&&e instanceof Xo?bi(t.A,e.A):t instanceof qo&&e instanceof qo)})))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask));var n,r}function as(t){return t.isFoundDocument()?t.version:Gr.min()}var us,cs,hs=(n(ds,cs=C=function(){}),ds),ls=(n(fs,us=C),fs);function fs(t,e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=us.call(this)||this).key=t,o.data=e,o.fieldMask=n,o.precondition=r,o.fieldTransforms=i,o.type=1,o}function ds(t,e,n,r){void 0===r&&(r=[]);var i=this;return(i=cs.call(this)||this).key=t,i.value=e,i.precondition=n,i.fieldTransforms=r,i.type=0,i}function ps(n){var r=new Map;return n.fieldMask.fields.forEach(function(t){var e;t.isEmpty()||(e=n.data.field(t),r.set(t,e))}),r}function ys(t,e,n){var r=new Map;Fr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,(o=s,s=a,a=n[i],o instanceof Bo?Go(o,s):o instanceof Ho?Wo(o,s):a))}return r}function gs(t,e,n){for(var r,i=new Map,o=0,s=t;o<s.length;o++){var a=s[o],u=a.transform,c=n.data.field(a.field);i.set(a.field,(r=c,c=void 0,u instanceof qo?(c={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}},r&&(c.fields.__previous_value__=r),{mapValue:c}):u instanceof Bo?Go(u,r):u instanceof Ho?Wo(u,r):(r=Jo(u=Fo(c=u,r))+Jo(c.A),Ai(u)&&Ai(c.A)?Po(r):Lo(c.R,r))))}return i}function ms(t){this.count=t}var vs,ws,bs,Ts=(n(_s,bs=C),_s),Es=(n(Is,ws=C),Is);function Is(t,e){var n=this;return(n=ws.call(this)||this).key=t,n.precondition=e,n.type=3,n.fieldTransforms=[],n}function _s(t,e){var n=this;return(n=bs.call(this)||this).key=t,n.precondition=e,n.type=2,n.fieldTransforms=[],n}function Ss(t){switch(t){case Dr.OK:return Mr(),0;case Dr.CANCELLED:case Dr.UNKNOWN:case Dr.DEADLINE_EXCEEDED:case Dr.RESOURCE_EXHAUSTED:case Dr.INTERNAL:case Dr.UNAVAILABLE:case Dr.UNAUTHENTICATED:return;case Dr.INVALID_ARGUMENT:case Dr.NOT_FOUND:case Dr.ALREADY_EXISTS:case Dr.PERMISSION_DENIED:case Dr.FAILED_PRECONDITION:case Dr.ABORTED:case Dr.OUT_OF_RANGE:case Dr.UNIMPLEMENTED:case Dr.DATA_LOSS:return 1;default:return Mr(),0}}function As(t){if(void 0===t)return Or("GRPC error has no .code"),Dr.UNKNOWN;switch(t){case vs.OK:return Dr.OK;case vs.CANCELLED:return Dr.CANCELLED;case vs.UNKNOWN:return Dr.UNKNOWN;case vs.DEADLINE_EXCEEDED:return Dr.DEADLINE_EXCEEDED;case vs.RESOURCE_EXHAUSTED:return Dr.RESOURCE_EXHAUSTED;case vs.INTERNAL:return Dr.INTERNAL;case vs.UNAVAILABLE:return Dr.UNAVAILABLE;case vs.UNAUTHENTICATED:return Dr.UNAUTHENTICATED;case vs.INVALID_ARGUMENT:return Dr.INVALID_ARGUMENT;case vs.NOT_FOUND:return Dr.NOT_FOUND;case vs.ALREADY_EXISTS:return Dr.ALREADY_EXISTS;case vs.PERMISSION_DENIED:return Dr.PERMISSION_DENIED;case vs.FAILED_PRECONDITION:return Dr.FAILED_PRECONDITION;case vs.ABORTED:return Dr.ABORTED;case vs.OUT_OF_RANGE:return Dr.OUT_OF_RANGE;case vs.UNIMPLEMENTED:return Dr.UNIMPLEMENTED;case vs.DATA_LOSS:return Dr.DATA_LOSS;default:return Mr()}}(_=vs={})[_.OK=0]="OK",_[_.CANCELLED=1]="CANCELLED",_[_.UNKNOWN=2]="UNKNOWN",_[_.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",_[_.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",_[_.NOT_FOUND=5]="NOT_FOUND",_[_.ALREADY_EXISTS=6]="ALREADY_EXISTS",_[_.PERMISSION_DENIED=7]="PERMISSION_DENIED",_[_.UNAUTHENTICATED=16]="UNAUTHENTICATED",_[_.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",_[_.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",_[_.ABORTED=10]="ABORTED",_[_.OUT_OF_RANGE=11]="OUT_OF_RANGE",_[_.UNIMPLEMENTED=12]="UNIMPLEMENTED",_[_.INTERNAL=13]="INTERNAL",_[_.UNAVAILABLE=14]="UNAVAILABLE",_[_.DATA_LOSS=15]="DATA_LOSS";var Ds=(xs.prototype.insert=function(t,e){return new xs(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Cs.BLACK,null,null))},xs.prototype.remove=function(t){return new xs(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Cs.BLACK,null,null))},xs.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},xs.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},xs.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(xs.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),xs.prototype.minKey=function(){return this.root.minKey()},xs.prototype.maxKey=function(){return this.root.maxKey()},xs.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},xs.prototype.forEach=function(n){this.inorderTraversal(function(t,e){return n(t,e),!1})},xs.prototype.toString=function(){var n=[];return this.inorderTraversal(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},xs.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},xs.prototype.getIterator=function(){return new Ns(this.root,null,this.comparator,!1)},xs.prototype.getIteratorFrom=function(t){return new Ns(this.root,t,this.comparator,!1)},xs.prototype.getReverseIterator=function(){return new Ns(this.root,null,this.comparator,!0)},xs.prototype.getReverseIteratorFrom=function(t){return new Ns(this.root,t,this.comparator,!0)},xs),Ns=(Rs.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},Rs.prototype.hasNext=function(){return 0<this.nodeStack.length},Rs.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},Rs),Cs=(ks.prototype.copy=function(t,e,n,r,i){return new ks(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},ks.prototype.isEmpty=function(){return!1},ks.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},ks.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},ks.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},ks.prototype.minKey=function(){return this.min().key},ks.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},ks.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},ks.prototype.removeMin=function(){if(this.left.isEmpty())return ks.EMPTY;var t=this;return(t=(t=t.left.isRed()||t.left.left.isRed()?t:t.moveRedLeft()).copy(null,null,null,t.left.removeMin(),null)).fixUp()},ks.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r=(r=r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()?r:r.moveRedLeft()).copy(null,null,null,r.left.remove(t,e),null);else{if(0===e(t,(r=(r=r.left.isRed()?r.rotateRight():r).right.isEmpty()||r.right.isRed()||r.right.left.isRed()?r:r.moveRedRight()).key)){if(r.right.isEmpty())return ks.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},ks.prototype.isRed=function(){return this.color},ks.prototype.fixUp=function(){var t=this;return(t=(t=t.right.isRed()&&!t.left.isRed()?t.rotateLeft():t).left.isRed()&&t.left.left.isRed()?t.rotateRight():t).left.isRed()&&t.right.isRed()?t.colorFlip():t},ks.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()?(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip():t},ks.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()?(t=t.rotateRight()).colorFlip():t},ks.prototype.rotateLeft=function(){var t=this.copy(null,null,ks.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},ks.prototype.rotateRight=function(){var t=this.copy(null,null,ks.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},ks.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},ks.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},ks.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Mr();if(this.right.isRed())throw Mr();var t=this.left.check();if(t!==this.right.check())throw Mr();return t+(this.isRed()?0:1)},ks);function ks(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:ks.RED,this.left=null!=r?r:ks.EMPTY,this.right=null!=i?i:ks.EMPTY,this.size=this.left.size+1+this.right.size}function Rs(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}function xs(t,e){this.comparator=t,this.root=e||Cs.EMPTY}function Os(){this.size=0}Cs.EMPTY=null,Cs.RED=!0,Cs.BLACK=!1,Cs.EMPTY=(Object.defineProperty(Os.prototype,"key",{get:function(){throw Mr()},enumerable:!1,configurable:!0}),Object.defineProperty(Os.prototype,"value",{get:function(){throw Mr()},enumerable:!1,configurable:!0}),Object.defineProperty(Os.prototype,"color",{get:function(){throw Mr()},enumerable:!1,configurable:!0}),Object.defineProperty(Os.prototype,"left",{get:function(){throw Mr()},enumerable:!1,configurable:!0}),Object.defineProperty(Os.prototype,"right",{get:function(){throw Mr()},enumerable:!1,configurable:!0}),Os.prototype.copy=function(t,e,n,r,i){return this},Os.prototype.insert=function(t,e,n){return new Cs(t,e)},Os.prototype.remove=function(t,e){return this},Os.prototype.isEmpty=function(){return!0},Os.prototype.inorderTraversal=function(t){return!1},Os.prototype.reverseTraversal=function(t){return!1},Os.prototype.minKey=function(){return null},Os.prototype.maxKey=function(){return null},Os.prototype.isRed=function(){return!1},Os.prototype.checkMaxDepth=function(){return!0},Os.prototype.check=function(){return 0},new Os);var Ls=(Vs.prototype.has=function(t){return null!==this.data.get(t)},Vs.prototype.first=function(){return this.data.minKey()},Vs.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(Vs.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),Vs.prototype.indexOf=function(t){return this.data.indexOf(t)},Vs.prototype.forEach=function(n){this.data.inorderTraversal(function(t,e){return n(t),!1})},Vs.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},Vs.prototype.forEachWhile=function(t,e){for(var n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},Vs.prototype.firstAfterOrEqual=function(t){return(t=this.data.getIteratorFrom(t)).hasNext()?t.getNext().key:null},Vs.prototype.getIterator=function(){return new Ps(this.data.getIterator())},Vs.prototype.getIteratorFrom=function(t){return new Ps(this.data.getIteratorFrom(t))},Vs.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},Vs.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Vs.prototype.isEmpty=function(){return this.data.isEmpty()},Vs.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},Vs.prototype.isEqual=function(t){if(!(t instanceof Vs))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},Vs.prototype.toArray=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},Vs.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},Vs.prototype.copy=function(t){var e=new Vs(this.comparator);return e.data=t,e},Vs),Ps=(Fs.prototype.getNext=function(){return this.iter.getNext().key},Fs.prototype.hasNext=function(){return this.iter.hasNext()},Fs),Ms=new Ds(mi.comparator);function Fs(t){this.iter=t}function Vs(t){this.comparator=t,this.data=new Ds(this.comparator)}var Us=new Ds(mi.comparator),qs=new Ds(mi.comparator),Bs=new Ls(mi.comparator);function js(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Bs,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}function Ks(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r}function Gs(t,e){this.targetId=t,this.V=e}function Qs(t,e,n,r){void 0===n&&(n=ni.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var Hs=new Ls(qr),zs=(ta.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n=new Map;return n.set(t,Ws.createSynthesizedTargetChangeForCurrentChange(t,e)),new ta(Gr.min(),n,Hs,Ms,js())},ta),Ws=(Zs.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new Zs(ni.EMPTY_BYTE_STRING,e,js(),js(),js())},Zs),Ys=(Object.defineProperty(Js.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(Js.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(Js.prototype,"F",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(Js.prototype,"$",{get:function(){return this.k},enumerable:!1,configurable:!0}),Js.prototype.O=function(t){0<t.approximateByteSize()&&(this.k=!0,this.C=t)},Js.prototype.M=function(){var n=js(),r=js(),i=js();return this.D.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:Mr()}}),new Ws(this.C,this.N,n,r,i)},Js.prototype.L=function(){this.k=!1,this.D=na()},Js.prototype.B=function(t,e){this.k=!0,this.D=this.D.insert(t,e)},Js.prototype.q=function(t){this.k=!0,this.D=this.D.remove(t)},Js.prototype.U=function(){this.S+=1},Js.prototype.K=function(){--this.S},Js.prototype.j=function(){this.k=!0,this.N=!0},Js),Xs=($s.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.tt(r,t.key,t.P)},$s.prototype.et=function(n){var r=this;this.forEachTarget(n,function(t){var e=r.nt(t);switch(n.state){case 0:r.st(t)&&e.O(n.resumeToken);break;case 1:e.K(),e.F||e.L(),e.O(n.resumeToken);break;case 2:e.K(),e.F||r.removeTarget(t);break;case 3:r.st(t)&&(e.j(),e.O(n.resumeToken));break;case 4:r.st(t)&&(r.it(t),e.O(n.resumeToken));break;default:Mr()}})},$s.prototype.forEachTarget=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.G.forEach(function(t,e){r.st(e)&&n(e)})},$s.prototype.rt=function(t){var e=t.targetId,n=t.V.count;(t=this.ot(e))&&(qi(t=t.target)?0===n?(t=new mi(t.path),this.tt(e,t,Pi.newNoDocument(t,Gr.min()))):Fr(1===n):this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e)))},$s.prototype.ut=function(r){var i=this,o=new Map;this.G.forEach(function(t,e){var n=i.ot(e);n&&(t.current&&qi(n.target)&&(n=new mi(n.target.path),null!==i.H.get(n)||i.at(e,n)||i.tt(e,n,Pi.newNoDocument(n,r))),t.$&&(o.set(e,t.M()),t.L()))});var s=js();this.J.forEach(function(t,e){var n=!0;e.forEachWhile(function(t){return!(t=i.ot(t))||2===t.purpose||(n=!1)}),n&&(s=s.add(t))});var t=new zs(r,o,this.Y,this.H,s);return this.H=Ms,this.J=ea(),this.Y=new Ls(qr),t},$s.prototype.Z=function(t,e){var n;this.st(t)&&(n=this.at(t,e.key)?2:0,this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t)))},$s.prototype.tt=function(t,e,n){var r;this.st(t)&&(r=this.nt(t),this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n)))},$s.prototype.removeTarget=function(t){this.G.delete(t)},$s.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},$s.prototype.U=function(t){this.nt(t).U()},$s.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new Ys,this.G.set(t,e)),e},$s.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Ls(qr),this.J=this.J.insert(t,e)),e},$s.prototype.st=function(t){var e=null!==this.ot(t);return e||xr("WatchChangeAggregator","Detected inactive target",t),e},$s.prototype.ot=function(t){var e=this.G.get(t);return e&&e.F?null:this.W.lt(t)},$s.prototype.it=function(e){var n=this;this.G.set(e,new Ys),this.W.getRemoteKeysForTarget(e).forEach(function(t){n.tt(e,t,null)})},$s.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},$s);function $s(t){this.W=t,this.G=new Map,this.H=Ms,this.J=ea(),this.Y=new Ls(qr)}function Js(){this.S=0,this.D=na(),this.C=ni.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}function Zs(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}function ta(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}function ea(){return new Ds(mi.comparator)}function na(){return new Ds(mi.comparator)}function ra(t,e){this.databaseId=t,this.I=e}var ia={asc:"ASCENDING",desc:"DESCENDING"},oa={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};function sa(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function aa(t,e){return t.I?e.toBase64():e.toUint8Array()}function ua(t){return Fr(!!t),Gr.fromTimestamp((t=ci(t),new Kr(t.seconds,t.nanos)))}function ca(t,e){return new Jr(["projects",t.projectId,"databases",t.database]).child("documents").child(e).canonicalString()}function ha(t){return Fr(Na(t=Jr.fromString(t))),t}function la(t,e){return ca(t.databaseId,e.path)}function fa(t,e){if((e=ha(e)).get(1)!==t.databaseId.projectId)throw new Nr(Dr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+t.databaseId.projectId);if(e.get(3)!==t.databaseId.database)throw new Nr(Dr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+t.databaseId.database);return new mi(ga(e))}function da(t,e){return ca(t.databaseId,e)}function pa(t){return 4===(t=ha(t)).length?Jr.emptyPath():ga(t)}function ya(t){return new Jr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ga(t){return Fr(4<t.length&&"documents"===t.get(4)),t.popFirst(5)}function ma(t,e,n){return{name:la(t,e),fields:n.value.mapValue.fields}}function va(t,e,n){var r=fa(t,e.name),t=ua(e.updateTime),e=new xi({mapValue:{fields:e.fields}}),e=Pi.newFoundDocument(r,t,e);return n&&e.setHasCommittedMutations(),n?e.setHasCommittedMutations():e}function wa(t,e){var n,r,i;if(e instanceof hs)n={update:ma(t,e.key,e.value)};else if(e instanceof Ts)n={delete:la(t,e.key)};else if(e instanceof ls)n={update:ma(t,e.key,e.data),updateMask:(r=e.fieldMask,i=[],r.fields.forEach(function(t){return i.push(t.canonicalString())}),{fieldPaths:i})};else{if(!(e instanceof Es))return Mr();n={verify:la(t,e.key)}}return 0<e.fieldTransforms.length&&(n.updateTransforms=e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof qo)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(e instanceof Bo)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:e.elements}};if(e instanceof Ho)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:e.elements}};if(e instanceof Xo)return{fieldPath:t.field.canonicalString(),increment:e.A};throw Mr()})),e.precondition.isNone||(n.currentDocument=void 0!==(e=e.precondition).updateTime?{updateTime:sa(t,e.updateTime.toTimestamp())}:void 0!==e.exists?{exists:e.exists}:Mr()),n}function ba(i,t){var e=t.currentDocument?void 0!==(s=t.currentDocument).updateTime?ns.updateTime(ua(s.updateTime)):void 0!==s.exists?ns.exists(s.exists):ns.none():ns.none(),n=t.updateTransforms?t.updateTransforms.map(function(t){return e=i,r=null,"setToServerValue"in(t=t)?(Fr("REQUEST_TIME"===t.setToServerValue),r=new qo):"appendMissingElements"in t?(n=t.appendMissingElements.values||[],r=new Bo(n)):"removeAllFromArray"in t?(n=t.removeAllFromArray.values||[],r=new Ho(n)):"increment"in t?r=new Xo(e,t.increment):Mr(),t=ti.fromServerFormat(t.fieldPath),new es(t,r);var e,n,r}):[];if(t.update){t.update.name;var r=fa(i,t.update.name),o=new xi({mapValue:{fields:t.update.fields}});if(t.updateMask){var s=(s=t.updateMask.fieldPaths||[],new ei(s.map(function(t){return ti.fromServerFormat(t)})));return new ls(r,o,s,e,n)}return new hs(r,o,e,n)}return t.delete?(n=fa(i,t.delete),new Ts(n,e)):t.verify?(t=fa(i,t.verify),new Es(t,e)):Mr()}function Ta(t,e){return{documents:[da(t,e.path)]}}function Ea(t,e){var n={structuredQuery:{}},r=e.path;return null!==e.collectionGroup?(n.parent=da(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=da(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),(r=function(t){if(0!==t.length)return 1===(t=t.map(function(t){if("=="===t.op){if(Ci(t.value))return{unaryFilter:{field:Aa(t.field),op:"IS_NAN"}};if(Ni(t.value))return{unaryFilter:{field:Aa(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ci(t.value))return{unaryFilter:{field:Aa(t.field),op:"IS_NOT_NAN"}};if(Ni(t.value))return{unaryFilter:{field:Aa(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Aa(t.field),op:(e=t.op,oa[e]),value:t.value}};var e})).length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(e.filters))&&(n.structuredQuery.where=r),(r=function(t){if(0!==t.length)return t.map(function(t){return{field:Aa(t.field),direction:(t=t.dir,ia[t])}})}(e.orderBy))&&(n.structuredQuery.orderBy=r),r=e.limit,null!==(r=t.I||pi(r)?r:{value:r})&&(n.structuredQuery.limit=r),e.startAt&&(n.structuredQuery.startAt=_a(e.startAt)),e.endAt&&(n.structuredQuery.endAt=_a(e.endAt)),n}function Ia(t){var e=pa(t.parent),n=t.structuredQuery,r=null;0<(s=n.from?n.from.length:0)&&(Fr(1===s),(a=n.from[0]).allDescendants?r=a.collectionId:e=e.child(a.collectionId));var i=[];n.where&&(i=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Da(t.unaryFilter.field);return ji.create(e,"==",{doubleValue:NaN});case"IS_NULL":return e=Da(t.unaryFilter.field),ji.create(e,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=Da(t.unaryFilter.field);return ji.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":return n=Da(t.unaryFilter.field),ji.create(n,"!=",{nullValue:"NULL_VALUE"});default:return Mr()}}(e)]:void 0!==e.fieldFilter?[(n=e,ji.create(Da(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Mr()}}(),n.fieldFilter.value))]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(t).reduce(function(t,e){return t.concat(e)}):Mr():[];var n}(n.where));var o=[],t=null,s=null,a=null;return wo(e,r,o=n.orderBy?n.orderBy.map(function(t){return new yo(Da((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e}):o,i,t=n.limit?pi(i="object"==typeof(i=n.limit)?i.value:i)?null:i:t,"F",s=n.startAt?Sa(n.startAt):s,a=n.endAt?Sa(n.endAt):a)}function _a(t){return{before:t.before,values:t.position}}function Sa(t){var e=!!t.before,t=t.values||[];return new uo(t,e)}function Aa(t){return{fieldPath:t.canonicalString()}}function Da(t){return ti.fromServerFormat(t.fieldPath)}function Na(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function Ca(t){for(var o="",e=0;e<t.length;e++)0<o.length&&(o=ka(o)),o=function(t){for(var e=o,n=t.length,r=0;r<n;r++){var i=t.charAt(r);switch(i){case"\0":e+="";break;case"":e+="";break;default:e+=i}}return e}(t.get(e));return ka(o)}function ka(t){return t+""}function Ra(t){var e=t.length;if(Fr(2<=e),2===e)return Fr(""===t.charAt(0)&&""===t.charAt(1)),Jr.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&Mr(),t.charAt(s+1)){case"":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Mr()}o=s+2}return new Jr(r)}function xa(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}function Oa(t,e){this.seconds=t,this.nanoseconds=e}function La(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}function Pa(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}xa.store="owner",xa.key="owner",La.store="mutationQueues",La.keyPath="userId",Pa.store="mutations",Pa.keyPath="batchId",Pa.userMutationsIndex="userMutationsIndex",Pa.userMutationsKeyPath=["userId","batchId"];var Ma=(Fa.prefixForUser=function(t){return[t]},Fa.prefixForPath=function(t,e){return[t,Ca(e)]},Fa.key=function(t,e,n){return[t,Ca(e),n]},Fa);function Fa(){}function Va(t,e){this.path=t,this.readTime=e}function Ua(t,e){this.path=t,this.version=e}Ma.store="documentMutations",Ma.PLACEHOLDER=new Ma;function qa(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o}function Ba(t){this.byteSize=t}function ja(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s}qa.store="remoteDocuments",qa.readTimeIndex="readTimeIndex",qa.readTimeIndexPath="readTime",qa.collectionReadTimeIndex="collectionReadTimeIndex",qa.collectionReadTimeIndexPath=["parentPath","readTime"],Ba.store="remoteDocumentGlobal",Ba.key="remoteDocumentGlobalKey",ja.store="targets",ja.keyPath="targetId",ja.queryTargetsIndexName="queryTargetsIndex",ja.queryTargetsKeyPath=["canonicalId","targetId"];function Ka(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}function Ga(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}function Qa(t,e){this.collectionId=t,this.parent=e}function Ha(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}function za(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}function Wa(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}Ka.store="targetDocuments",Ka.keyPath=["targetId","path"],Ka.documentTargetsIndex="documentTargetsIndex",Ka.documentTargetsKeyPath=["path","targetId"],Ga.key="targetGlobalKey",Ga.store="targetGlobal",Qa.store="collectionParents",Qa.keyPath=["collectionId","parent"],Ha.store="clientMetadata",Ha.keyPath="clientId",za.store="bundles",za.keyPath="bundleId",Wa.store="namedQueries",Wa.keyPath="name";function Ya(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}var Xa,$a=s(s([],s(s([],s(s([],s(s([],[La.store,Pa.store,Ma.store,qa.store,ja.store,xa.store,Ga.store,Ka.store]),[Ha.store])),[Ba.store])),[Qa.store])),[za.store,Wa.store]),Ja="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",C=(cu.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},cu.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},cu),Za=(uu.prototype.catch=function(t){return this.next(void 0,t)},uu.prototype.next=function(r,i){var o=this;return this.callbackAttached&&Mr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new uu(function(e,n){o.nextCallback=function(t){o.wrapSuccess(r,t).next(e,n)},o.catchCallback=function(t){o.wrapFailure(i,t).next(e,n)}})},uu.prototype.toPromise=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},uu.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof uu?e:uu.resolve(e)}catch(t){return uu.reject(t)}},uu.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):uu.resolve(e)},uu.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):uu.reject(e)},uu.resolve=function(n){return new uu(function(t,e){t(n)})},uu.reject=function(n){return new uu(function(t,e){e(n)})},uu.waitFor=function(t){return new uu(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},uu.or=function(t){for(var n=uu.resolve(!1),e=0,r=t;e<r.length;e++)!function(e){n=n.next(function(t){return t?uu.resolve(t):e()})}(r[e]);return n},uu.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.waitFor(i)},uu),tu=(au.open=function(t,e,n,r){try{return new au(e,t.transaction(r,n))}catch(t){throw new ru(e,t)}},Object.defineProperty(au.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),au.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(xr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},au.prototype.store=function(t){return t=this.transaction.objectStore(t),new lu(t)},au),eu=(su.delete=function(t){return xr("SimpleDb","Removing database:",t),du(window.indexedDB.deleteDatabase(t)).toPromise()},su.yt=function(){if("undefined"==typeof indexedDB)return!1;if(su.gt())return!0;var t=h(),e=0<(n=su._t(t))&&n<10,n=0<(n=su.Et(t))&&n<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||e||n)},su.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},su.It=function(t,e){return t.store(e)},su._t=function(t){return t=(t=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i))?t[1].split("_").slice(0,2).join("."):"-1",Number(t)},su.Et=function(t){return t=(t=t.match(/Android ([\d.]+)/i))?t[1].split(".").slice(0,2).join("."):"-1",Number(t)},su.prototype.At=function(o){return y(this,void 0,void 0,function(){var e,i=this;return g(this,function(t){switch(t.label){case 0:return this.db?[3,2]:(xr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,n){var r=indexedDB.open(i.name,i.version);r.onsuccess=function(t){t=t.target.result,e(t)},r.onblocked=function(){n(new ru(o,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=function(t){"VersionError"===(t=t.target.error).name?n(new Nr(Dr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new ru(o,t))},r.onupgradeneeded=function(t){xr("SimpleDb",'Database "'+i.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;i.wt.Rt(e,r.transaction,t.oldVersion,i.version).next(function(){xr("SimpleDb","Database upgrade to version "+i.version+" complete")})}})]);case 1:e.db=t.sent(),t.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return i.bt(t)}),this.db)]}})})},su.prototype.vt=function(e){this.bt=e,this.db&&(this.db.onversionchange=function(t){return e(t)})},su.prototype.runTransaction=function(a,n,u,c){return y(this,void 0,void 0,function(){var i,o,s,e;return g(this,function(t){switch(t.label){case 0:i="readonly"===n,o=0,e=function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:++o,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,s.At(a)];case 2:return s.db=t.sent(),e=tu.open(s.db,a,i?"readonly":"readwrite",u),n=c(e).catch(function(t){return e.abort(t),Za.reject(t)}).toPromise(),r={},n.catch(function(){}),[4,e.dt];case 3:return[2,(r.value=(t.sent(),n),r)];case 4:return n=t.sent(),r="FirebaseError"!==n.name&&o<3,xr("SimpleDb","Transaction failed with error:",n.message,"Retrying:",r),s.close(),r?[3,5]:[2,{value:Promise.reject(n)}];case 5:return[2]}})},s=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(e=t.sent()))return[2,e.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},su.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},su),nu=(Object.defineProperty(ou.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(ou.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(ou.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),ou.prototype.done=function(){this.Vt=!0},ou.prototype.Ct=function(t){this.St=t},ou.prototype.delete=function(){return du(this.Pt.delete())},ou),ru=(n(iu,Xa=Nr),iu);function iu(t,e){var n=this;return(n=Xa.call(this,Dr.UNAVAILABLE,"IndexedDB transaction '"+t+"' failed: "+e)||this).name="IndexedDbTransactionError",n}function ou(t){this.Pt=t,this.Vt=!1,this.St=null}function su(t,e,n){this.name=t,this.version=e,this.wt=n,12.2===su._t(h())&&Or("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function au(e,t){var n=this;this.action=e,this.transaction=t,this.aborted=!1,this.ft=new Ya,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){t.error?n.ft.reject(new ru(e,t.error)):n.ft.resolve()},this.transaction.onerror=function(t){t=yu(t.target.error),n.ft.reject(new ru(e,t))}}function uu(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}function cu(){this.onCommittedListeners=[]}function hu(t){return"IndexedDbTransactionError"===t.name}var lu=(fu.prototype.put=function(t,e){return du(t=void 0!==e?(xr("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(xr("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},fu.prototype.add=function(t){return xr("SimpleDb","ADD",this.store.name,t,t),du(this.store.add(t))},fu.prototype.get=function(e){var n=this;return du(this.store.get(e)).next(function(t){return xr("SimpleDb","GET",n.store.name,e,t=void 0===t?null:t),t})},fu.prototype.delete=function(t){return xr("SimpleDb","DELETE",this.store.name,t),du(this.store.delete(t))},fu.prototype.count=function(){return xr("SimpleDb","COUNT",this.store.name),du(this.store.count())},fu.prototype.Nt=function(t,e){var e=this.cursor(this.options(t,e)),n=[];return this.xt(e,function(t,e){n.push(e)}).next(function(){return n})},fu.prototype.kt=function(t,e){return xr("SimpleDb","DELETE ALL",this.store.name),(e=this.options(t,e)).Ft=!1,e=this.cursor(e),this.xt(e,function(t,e,n){return n.delete()})},fu.prototype.$t=function(t,e){e?n=t:(n={},e=t);var n=this.cursor(n);return this.xt(n,e)},fu.prototype.Ot=function(r){var t=this.cursor({});return new Za(function(n,e){t.onerror=function(t){t=yu(t.target.error),e(t)},t.onsuccess=function(t){var e=t.target.result;e?r(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},fu.prototype.xt=function(t,i){var o=[];return new Za(function(r,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n=t.target.result;n?(e=new nu(n),(t=i(n.primaryKey,n.value,e))instanceof Za&&(t=t.catch(function(t){return e.done(),Za.reject(t)}),o.push(t)),e.isDone?r():null===e.Dt?n.continue():n.continue(e.Dt)):r()}}).next(function(){return Za.waitFor(o)})},fu.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},fu.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Ft?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},fu);function fu(t){this.store=t}function du(t){return new Za(function(e,n){t.onsuccess=function(t){t=t.target.result,e(t)},t.onerror=function(t){t=yu(t.target.error),n(t)}})}var pu=!1;function yu(t){var e=eu._t(h());if(12.2<=e&&e<13&&0<=t.message.indexOf(e="An internal error was encountered in the Indexed Database server")){var n=new Nr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+e+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return pu||(pu=!0,setTimeout(function(){throw n},0)),n}return t}var gu,mu=(n(vu,gu=C),vu);function vu(t,e){var n=this;return(n=gu.call(this)||this).Mt=t,n.currentSequenceNumber=e,n}function wu(t,e){return eu.It(t.Mt,e)}function bu(t){this.Lt=t}var Tu=(Au.prototype.applyToRemoteDocument=function(t,e){for(var n,r,i,o,s,a,u=e.mutationResults,c=0;c<this.mutations.length;c++){var h=this.mutations[c];h.key.isEqual(t.key)&&(n=h,r=t,i=u[c],h=a=s=o=void 0,n instanceof hs?(s=r,a=i,h=(o=n).value.clone(),o=ys(o.fieldTransforms,s,a.transformResults),h.setAll(o),s.convertToFoundDocument(a.version,h).setHasCommittedMutations()):n instanceof ls?(o=r,s=i,is((a=n).precondition,o)?(h=ys(a.fieldTransforms,o,s.transformResults),(n=o.data).setAll(ps(a)),n.setAll(h),o.convertToFoundDocument(s.version,n).setHasCommittedMutations()):o.convertToUnknownDocument(s.version)):r.convertToNoDocument(i.version).setHasCommittedMutations())}},Au.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(r=n[e]).key.isEqual(t.key)&&os(r,t,this.localWriteTime);for(var r,i=0,o=this.mutations;i<o.length;i++)(r=o[i]).key.isEqual(t.key)&&os(r,t,this.localWriteTime)},Au.prototype.applyToLocalDocumentSet=function(n){var r=this;this.mutations.forEach(function(t){var e=n.get(t.key),t=e;r.applyToLocalView(t),e.isValidDocument()||t.convertToNoDocument(Gr.min())})},Au.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},js())},Au.prototype.isEqual=function(t){return this.batchId===t.batchId&&Br(this.mutations,t.mutations,ss)&&Br(this.baseMutations,t.baseMutations,ss)},Au),Eu=(Su.from=function(t,e,n){Fr(t.mutations.length===n.length);for(var r=qs,i=t.mutations,o=0;o<i.length;o++)r=r.insert(i[o].key,n[o].version);return new Su(t,e,n,r)},Su),Iu=(_u.prototype.withSequenceNumber=function(t){return new _u(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},_u.prototype.withResumeToken=function(t,e){return new _u(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},_u.prototype.withLastLimboFreeSnapshotVersion=function(t){return new _u(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},_u);function _u(t,e,n,r,i,o,s){void 0===i&&(i=Gr.min()),void 0===o&&(o=Gr.min()),void 0===s&&(s=ni.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Su(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}function Au(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}function Du(t,e){if(e.document)return va(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=mi.fromSegments(e.noDocument.path),r=xu(e.noDocument.readTime),n=Pi.newNoDocument(n,r);return e.hasCommittedMutations?n.setHasCommittedMutations():n}return e.unknownDocument?(n=mi.fromSegments(e.unknownDocument.path),r=xu(e.unknownDocument.version),Pi.newUnknownDocument(n,r)):Mr()}function Nu(t,e,n){var r=Cu(n),n=e.key.path.popLast().toArray();if(e.isFoundDocument()){var i={name:la(o=t.Lt,(s=e).key),fields:s.data.value.mapValue.fields,updateTime:sa(o,s.version.toTimestamp())},o=e.hasCommittedMutations;return new qa(null,null,i,o,r,n)}if(e.isNoDocument()){var s=e.key.path.toArray(),i=Ru(e.version),o=e.hasCommittedMutations;return new qa(null,new Va(s,i),null,o,r,n)}return e.isUnknownDocument()?(o=e.key.path.toArray(),e=Ru(e.version),new qa(new Ua(o,e),null,null,!0,r,n)):Mr()}function Cu(t){return[(t=t.toTimestamp()).seconds,t.nanoseconds]}function ku(t){return t=new Kr(t[0],t[1]),Gr.fromTimestamp(t)}function Ru(t){return t=t.toTimestamp(),new Oa(t.seconds,t.nanoseconds)}function xu(t){return t=new Kr(t.seconds,t.nanoseconds),Gr.fromTimestamp(t)}function Ou(e,t){for(var n=(t.baseMutations||[]).map(function(t){return ba(e.Lt,t)}),r=0;r<t.mutations.length-1;++r){var i,o=t.mutations[r];r+1<t.mutations.length&&void 0!==t.mutations[r+1].transform&&(i=t.mutations[r+1],o.updateTransforms=i.transform.fieldTransforms,t.mutations.splice(r+1,1),++r)}var s=t.mutations.map(function(t){return ba(e.Lt,t)}),a=Kr.fromMillis(t.localWriteTimeMs);return new Tu(t.batchId,a,n,s)}function Lu(t){var e=xu(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?xu(t.lastLimboFreeSnapshotVersion):Gr.min(),r=void 0!==t.query.documents?(Fr(1===(r=t.query).documents.length),Do(bo(pa(r.documents[0])))):Do(Ia(t.query));return new Iu(r,t.targetId,0,t.lastListenSequenceNumber,e,n,ni.fromBase64String(t.resumeToken))}function Pu(t,e){var n=Ru(e.snapshotVersion),r=Ru(e.lastLimboFreeSnapshotVersion),i=(qi(e.target)?Ta:Ea)(t.Lt,e.target),t=e.resumeToken.toBase64();return new ja(e.targetId,Vi(e.target),n,t,e.sequenceNumber,r,i)}function Mu(t){var e=Ia({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?No(e,e.limit,"L"):e}var Fu=(Vu.prototype.getBundleMetadata=function(t,e){return Uu(t).get(e).next(function(t){if(t)return{id:t.bundleId,createTime:xu(t.createTime),version:t.version}})},Vu.prototype.saveBundleMetadata=function(t,e){return Uu(t).put({bundleId:e.id,createTime:Ru(ua(e.createTime)),version:e.version})},Vu.prototype.getNamedQuery=function(t,e){return qu(t).get(e).next(function(t){if(t)return{name:t.name,query:Mu(t.bundledQuery),readTime:xu(t.readTime)}})},Vu.prototype.saveNamedQuery=function(t,e){return qu(t).put({name:e.name,readTime:Ru(ua(e.readTime)),bundledQuery:e.bundledQuery})},Vu);function Vu(){}function Uu(t){return wu(t,za.store)}function qu(t){return wu(t,Wa.store)}var Bu=(Hu.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),Za.resolve()},Hu.prototype.getCollectionParents=function(t,e){return Za.resolve(this.Bt.getEntries(e))},Hu),ju=(Qu.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Ls(Jr.comparator),t=!r.has(n);return this.index[e]=r.add(n),t},Qu.prototype.has=function(t){var e=t.lastSegment(),t=t.popLast();return(e=this.index[e])&&e.has(t)},Qu.prototype.getEntries=function(t){return(this.index[t]||new Ls(Jr.comparator)).toArray()},Qu),Ku=(Gu.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(this.qt.has(e))return Za.resolve();var r=e.lastSegment(),i=e.popLast();return t.addOnCommittedListener(function(){n.qt.add(e)}),i={collectionId:r,parent:Ca(i)},zu(t).put(i)},Gu.prototype.getCollectionParents=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[jr(i),""],!1,!0);return zu(t).Nt(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Ra(r.parent))}return o})},Gu);function Gu(){this.qt=new ju}function Qu(){this.index={}}function Hu(){this.Bt=new ju}function zu(t){return wu(t,Qa.store)}var Wu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Yu=(Xu.withCacheSize=function(t){return new Xu(t,Xu.DEFAULT_COLLECTION_PERCENTILE,Xu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},Xu);function Xu(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}function $u(t,e,n){var r=t.store(Pa.store),i=t.store(Ma.store),o=[],t=IDBKeyRange.only(n.batchId),s=0,t=r.$t({range:t},function(t,e,n){return s++,n.delete()});o.push(t.next(function(){Fr(1===s)}));for(var a=[],u=0,c=n.mutations;u<c.length;u++){var h=c[u],l=Ma.key(e,h.key.path,n.batchId);o.push(i.delete(l)),a.push(h.key)}return Za.waitFor(o).next(function(){return a})}function Ju(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Mr();e=t.noDocument}return JSON.stringify(e).length}Yu.DEFAULT_COLLECTION_PERCENTILE=10,Yu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Yu.DEFAULT=new Yu(41943040,Yu.DEFAULT_COLLECTION_PERCENTILE,Yu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Yu.DISABLED=new Yu(-1,0,0);var Zu=(tc.Qt=function(t,e,n,r){return Fr(""!==t.uid),new tc(t.isAuthenticated()?t.uid:"",e,n,r)},tc.prototype.checkEmpty=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return nc(t).$t({index:Pa.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},tc.prototype.addMutationBatch=function(p,y,g,m){var v=this,w=rc(p),b=nc(p);return b.add({}).next(function(t){Fr("number"==typeof t);for(var e,n,r,i,o,s=new Tu(t,y,g,m),a=(e=v.R,n=v.userId,i=(r=s).baseMutations.map(function(t){return wa(e.Lt,t)}),o=r.mutations.map(function(t){return wa(e.Lt,t)}),new Pa(n,r.batchId,r.localWriteTime.toMillis(),i,o)),u=[],c=new Ls(function(t,e){return qr(t.canonicalString(),e.canonicalString())}),h=0,l=m;h<l.length;h++){var f=l[h],d=Ma.key(v.userId,f.key.path,t),c=c.add(f.key.path.popLast());u.push(b.put(a)),u.push(w.put(d,Ma.PLACEHOLDER))}return c.forEach(function(t){u.push(v.Ut.addToCollectionParentIndex(p,t))}),p.addOnCommittedListener(function(){v.Kt[t]=s.keys()}),Za.waitFor(u).next(function(){return s})})},tc.prototype.lookupMutationBatch=function(t,e){var n=this;return nc(t).get(e).next(function(t){return t?(Fr(t.userId===n.userId),Ou(n.R,t)):null})},tc.prototype.jt=function(t,e){var n=this;return this.Kt[e]?Za.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next(function(t){return t?(t=t.keys(),n.Kt[e]=t):null})},tc.prototype.getNextMutationBatchAfterBatchId=function(t,e){var r=this,i=e+1,e=IDBKeyRange.lowerBound([this.userId,i]),o=null;return nc(t).$t({index:Pa.userMutationsIndex,range:e},function(t,e,n){e.userId===r.userId&&(Fr(e.batchId>=i),o=Ou(r.R,e)),n.done()}).next(function(){return o})},tc.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return nc(t).$t({index:Pa.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},tc.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return nc(t).Nt(Pa.userMutationsIndex,n).next(function(t){return t.map(function(t){return Ou(e.R,t)})})},tc.prototype.getAllMutationBatchesAffectingDocumentKey=function(o,s){var a=this,t=Ma.prefixForPath(this.userId,s.path),t=IDBKeyRange.lowerBound(t),u=[];return rc(o).$t({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Ra(i);if(r===a.userId&&s.path.isEqual(i))return nc(o).get(t).next(function(t){if(!t)throw Mr();Fr(t.userId===a.userId),u.push(Ou(a.R,t))});n.done()}).next(function(){return u})},tc.prototype.getAllMutationBatchesAffectingDocumentKeys=function(e,t){var s=this,a=new Ls(qr),n=[];return t.forEach(function(o){var t=Ma.prefixForPath(s.userId,o.path),t=IDBKeyRange.lowerBound(t),t=rc(e).$t({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Ra(i);r===s.userId&&o.path.isEqual(i)?a=a.add(t):n.done()});n.push(t)}),Za.waitFor(n).next(function(){return s.Wt(e,a)})},tc.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var o=this,s=e.path,a=s.length+1,e=Ma.prefixForPath(this.userId,s),e=IDBKeyRange.lowerBound(e),u=new Ls(qr);return rc(t).$t({range:e},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Ra(i);r===o.userId&&s.isPrefixOf(i)?i.length===a&&(u=u.add(t)):n.done()}).next(function(){return o.Wt(t,u)})},tc.prototype.Wt=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(nc(e).get(t).next(function(t){if(null===t)throw Mr();Fr(t.userId===n.userId),r.push(Ou(n.R,t))}))}),Za.waitFor(i).next(function(){return r})},tc.prototype.removeMutationBatch=function(e,n){var r=this;return $u(e.Mt,this.userId,n).next(function(t){return e.addOnCommittedListener(function(){r.Gt(n.batchId)}),Za.forEach(t,function(t){return r.referenceDelegate.markPotentiallyOrphaned(e,t)})})},tc.prototype.Gt=function(t){delete this.Kt[t]},tc.prototype.performConsistencyCheck=function(e){var i=this;return this.checkEmpty(e).next(function(t){if(!t)return Za.resolve();var t=IDBKeyRange.lowerBound(Ma.prefixForUser(i.userId)),r=[];return rc(e).$t({range:t},function(t,e,n){t[0]===i.userId?(t=Ra(t[1]),r.push(t)):n.done()}).next(function(){Fr(0===r.length)})})},tc.prototype.containsKey=function(t,e){return ec(t,this.userId,e)},tc.prototype.zt=function(t){var e=this;return ic(t).get(this.userId).next(function(t){return t||new La(e.userId,-1,"")})},tc);function tc(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}function ec(t,o,e){var s=(e=Ma.prefixForPath(o,e.path))[1],e=IDBKeyRange.lowerBound(e),a=!1;return rc(t).$t({range:e,Ft:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(a=!0),n.done()}).next(function(){return a})}function nc(t){return wu(t,Pa.store)}function rc(t){return wu(t,Ma.store)}function ic(t){return wu(t,La.store)}var oc=(uc.prototype.next=function(){return this.Ht+=2,this.Ht},uc.Jt=function(){return new uc(0)},uc.Yt=function(){return new uc(-1)},uc),sc=(ac.prototype.allocateTargetId=function(n){var r=this;return this.Xt(n).next(function(t){var e=new oc(t.highestTargetId);return t.highestTargetId=e.next(),r.Zt(n,t).next(function(){return t.highestTargetId})})},ac.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return Gr.fromTimestamp(new Kr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},ac.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},ac.prototype.setTargetsMetadata=function(e,n,r){var i=this;return this.Xt(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.toTimestamp()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.Zt(e,t)})},ac.prototype.addTargetData=function(e,n){var r=this;return this.te(e,n).next(function(){return r.Xt(e).next(function(t){return t.targetCount+=1,r.ee(n,t),r.Zt(e,t)})})},ac.prototype.updateTargetData=function(t,e){return this.te(t,e)},ac.prototype.removeTargetData=function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next(function(){return cc(e).delete(t.targetId)}).next(function(){return n.Xt(e)}).next(function(t){return Fr(0<t.targetCount),--t.targetCount,n.Zt(e,t)})},ac.prototype.removeTargets=function(n,r,i){var o=this,s=0,a=[];return cc(n).$t(function(t,e){(e=Lu(e)).sequenceNumber<=r&&null===i.get(e.targetId)&&(s++,a.push(o.removeTargetData(n,e)))}).next(function(){return Za.waitFor(a)}).next(function(){return s})},ac.prototype.forEachTarget=function(t,n){return cc(t).$t(function(t,e){e=Lu(e),n(e)})},ac.prototype.Xt=function(t){return hc(t).get(Ga.key).next(function(t){return Fr(null!==t),t})},ac.prototype.Zt=function(t,e){return hc(t).put(Ga.key,e)},ac.prototype.te=function(t,e){return cc(t).put(Pu(this.R,e))},ac.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},ac.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},ac.prototype.getTargetData=function(t,r){var e=Vi(r),e=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),i=null;return cc(t).$t({range:e,index:ja.queryTargetsIndexName},function(t,e,n){e=Lu(e),Ui(r,e.target)&&(i=e,n.done())}).next(function(){return i})},ac.prototype.addMatchingKeys=function(n,t,r){var i=this,o=[],s=lc(n);return t.forEach(function(t){var e=Ca(t.path);o.push(s.put(new Ka(r,e))),o.push(i.referenceDelegate.addReference(n,r,t))}),Za.waitFor(o)},ac.prototype.removeMatchingKeys=function(n,t,r){var i=this,o=lc(n);return Za.forEach(t,function(t){var e=Ca(t.path);return Za.waitFor([o.delete([r,e]),i.referenceDelegate.removeReference(n,r,t)])})},ac.prototype.removeMatchingKeysForTargetId=function(t,e){return t=lc(t),e=IDBKeyRange.bound([e],[e+1],!1,!0),t.delete(e)},ac.prototype.getMatchingKeysForTargetId=function(t,e){var e=IDBKeyRange.bound([e],[e+1],!1,!0),t=lc(t),r=js();return t.$t({range:e,Ft:!0},function(t,e,n){t=Ra(t[1]),t=new mi(t),r=r.add(t)}).next(function(){return r})},ac.prototype.containsKey=function(t,e){var e=Ca(e.path),e=IDBKeyRange.bound([e],[jr(e)],!1,!0),i=0;return lc(t).$t({index:Ka.documentTargetsIndex,Ft:!0,range:e},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},ac.prototype.lt=function(t,e){return cc(t).get(e).next(function(t){return t?Lu(t):null})},ac);function ac(t,e){this.referenceDelegate=t,this.R=e}function uc(t){this.Ht=t}function cc(t){return wu(t,ja.store)}function hc(t){return wu(t,Ga.store)}function lc(t){return wu(t,Ka.store)}function fc(e){return y(this,void 0,void 0,function(){return g(this,function(t){if(e.code!==Dr.FAILED_PRECONDITION||e.message!==Ja)throw e;return xr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function dc(t,e){var n=t[0],r=t[1],t=e[0],e=e[1];return 0===(t=qr(n,t))?qr(r,e):t}var pc=(Tc.prototype.ie=function(){return++this.se},Tc.prototype.re=function(t){var e=[t,this.ie()];this.buffer.size<this.ne?this.buffer=this.buffer.add(e):dc(e,t=this.buffer.last())<0&&(this.buffer=this.buffer.delete(t).add(e))},Object.defineProperty(Tc.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),Tc),yc=(bc.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},bc.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(bc.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),bc.prototype.ue=function(n){var t=this,e=this.oe?3e5:6e4;xr("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:this.ce=null,this.oe=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.collectGarbage(this.garbageCollector)];case 2:return t.sent(),[3,7];case 3:return hu(e=t.sent())?(xr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,fc(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.ue(n)];case 8:return t.sent(),[2]}})})})},bc),gc=(wc.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},wc.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Za.resolve(_r.o);var r=new pc(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},wc.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},wc.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},wc.prototype.collect=function(e,n){var r=this;return-1===this.params.cacheSizeCollectionThreshold?(xr("LruGarbageCollector","Garbage collection skipped; disabled"),Za.resolve(Wu)):this.getCacheSize(e).next(function(t){return t<r.params.cacheSizeCollectionThreshold?(xr("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.cacheSizeCollectionThreshold),Wu):r.fe(e,n)})},wc.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},wc.prototype.fe=function(e,n){var r,i,o,s,a,u,c,h=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(function(t){return i=t>h.params.maximumSequenceNumbersToCollect?(xr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+t),h.params.maximumSequenceNumbersToCollect):t,s=Date.now(),h.nthSequenceNumber(e,i)}).next(function(t){return r=t,a=Date.now(),h.removeTargets(e,r,n)}).next(function(t){return o=t,u=Date.now(),h.removeOrphanedDocuments(e,r)}).next(function(t){return c=Date.now(),Rr()<=m.DEBUG&&xr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-l)+"ms\n\tDetermined least recently used "+i+" in "+(a-s)+"ms\n\tRemoved "+o+" targets in "+(u-a)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-l)+"ms"),Za.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:t})})},wc),mc=(vc.prototype.he=function(t){var n=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(e){return n.next(function(t){return e+t})})},vc.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},vc.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},vc.prototype.le=function(t,n){return this.we(t,function(t,e){return n(e)})},vc.prototype.addReference=function(t,e,n){return Ec(t,n)},vc.prototype.removeReference=function(t,e,n){return Ec(t,n)},vc.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},vc.prototype.markPotentiallyOrphaned=Ec,vc.prototype._e=function(t,e){return r=e,i=!1,ic(n=t).Ot(function(t){return ec(n,t,r).next(function(t){return t&&(i=!0),Za.resolve(!t)})}).next(function(){return i});var n,r,i},vc.prototype.removeOrphanedDocuments=function(n,r){var i=this,o=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],a=0;return this.we(n,function(e,t){t<=r&&(t=i._e(n,e).next(function(t){if(!t)return a++,o.getEntry(n,e).next(function(){return o.removeEntry(e),lc(n).delete([0,Ca(e.path)])})}),s.push(t))}).next(function(){return Za.waitFor(s)}).next(function(){return o.apply(n)}).next(function(){return a})},vc.prototype.removeTarget=function(t,e){return e=e.withSequenceNumber(t.currentSequenceNumber),this.db.getTargetCache().updateTargetData(t,e)},vc.prototype.updateLimboDocument=Ec,vc.prototype.we=function(t,r){var i,t=lc(t),o=_r.o;return t.$t({index:Ka.documentTargetsIndex},function(t,e){var n=t[0];t[1],t=e.path,e=e.sequenceNumber,0===n?(o!==_r.o&&r(new mi(Ra(i)),o),o=e,i=t):o=_r.o}).next(function(){o!==_r.o&&r(new mi(Ra(i)),o)})},vc.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},vc);function vc(t,e){this.db=t,this.garbageCollector=new gc(this,e)}function wc(t,e){this.ae=t,this.params=e}function bc(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}function Tc(t){this.ne=t,this.buffer=new Ls(dc),this.se=0}function Ec(t,e){return lc(t).put((t=t.currentSequenceNumber,new Ka(0,Ca(e.path),t)))}var Ic,_c=(kc.prototype.get=function(t){var e=this.mapKeyFn(t);if(void 0!==(e=this.inner[e]))for(var n=0,r=e;n<r.length;n++){var i=(o=r[n])[0],o=o[1];if(this.equalsFn(i,t))return o}},kc.prototype.has=function(t){return void 0!==this.get(t)},kc.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},kc.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},kc.prototype.forEach=function(s){Wr(this.inner,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=(o=r[n])[0],o=o[1];s(i,o)}})},kc.prototype.isEmpty=function(){return Yr(this.inner)},kc),_=(Cc.prototype.getReadTime=function(t){return(t=this.changes.get(t))?t.readTime:Gr.min()},Cc.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},Cc.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:Pi.newInvalidDocument(t),readTime:e})},Cc.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Za.resolve(n.document):this.getFromCache(t,e)},Cc.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},Cc.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},Cc.prototype.assertNotApplied=function(){},Cc),Sc=(Nc.prototype.addEntry=function(t,e,n){return xc(t).put(Oc(e),n)},Nc.prototype.removeEntry=function(t,e){return t=xc(t),e=Oc(e),t.delete(e)},Nc.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.me(e,t)})},Nc.prototype.getEntry=function(t,e){var n=this;return xc(t).get(Oc(e)).next(function(t){return n.ye(e,t)})},Nc.prototype.ge=function(t,e){var n=this;return xc(t).get(Oc(e)).next(function(t){return{document:n.ye(e,t),size:Ju(t)}})},Nc.prototype.getEntries=function(t,e){var n=this,r=Ms;return this.pe(t,e,function(t,e){e=n.ye(t,e),r=r.insert(t,e)}).next(function(){return r})},Nc.prototype.Ee=function(t,e){var r=this,i=Ms,o=new Ds(mi.comparator);return this.pe(t,e,function(t,e){var n=r.ye(t,e);i=i.insert(t,n),o=o.insert(t,Ju(e))}).next(function(){return{documents:i,Te:o}})},Nc.prototype.pe=function(t,e,i){if(e.isEmpty())return Za.resolve();var n=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),o=e.getIterator(),s=o.getNext();return xc(t).$t({range:n},function(t,e,n){for(var r=mi.fromSegments(t);s&&mi.comparator(s,r)<0;)i(s,null),s=o.getNext();s&&s.isEqual(r)&&(i(s,e),s=o.hasNext()?o.getNext():null),s?n.Ct(s.path.toArray()):n.done()}).next(function(){for(;s;)i(s,null),s=o.hasNext()?o.getNext():null})},Nc.prototype.getDocumentsMatchingQuery=function(t,r,e){var n,i=this,o=Ms,s=r.path.length+1,a={};return e.isEqual(Gr.min())?(n=r.path.toArray(),a.range=IDBKeyRange.lowerBound(n)):(n=r.path.toArray(),e=Cu(e),a.range=IDBKeyRange.lowerBound([n,e],!0),a.index=qa.collectionReadTimeIndex),xc(t).$t(a,function(t,e,n){t.length===s&&(e=Du(i.R,e),r.path.isPrefixOf(e.key.path)?xo(r,e)&&(o=o.insert(e.key,e)):n.done())}).next(function(){return o})},Nc.prototype.newChangeBuffer=function(t){return new Ac(this,!!t&&t.trackRemovals)},Nc.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Nc.prototype.getMetadata=function(t){return Rc(t).get(Ba.key).next(function(t){return Fr(!!t),t})},Nc.prototype.me=function(t,e){return Rc(t).put(Ba.key,e)},Nc.prototype.ye=function(t,e){return!e||(e=Du(this.R,e)).isNoDocument()&&e.version.isEqual(Gr.min())?Pi.newInvalidDocument(t):e},Nc),Ac=(n(Dc,Ic=_),Dc.prototype.applyChanges=function(i){var o=this,s=[],a=0,u=new Ls(function(t,e){return qr(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(t,e){var n,r=o.Ae.get(t);e.document.isValidDocument()?(n=Nu(o.Ie.R,e.document,o.getReadTime(t)),u=u.add(t.path.popLast()),e=Ju(n),a+=e-r,s.push(o.Ie.addEntry(i,t,n))):(a-=r,o.trackRemovals?(r=Nu(o.Ie.R,Pi.newNoDocument(t,Gr.min()),o.getReadTime(t)),s.push(o.Ie.addEntry(i,t,r))):s.push(o.Ie.removeEntry(i,t)))}),u.forEach(function(t){s.push(o.Ie.Ut.addToCollectionParentIndex(i,t))}),s.push(this.Ie.updateMetadata(i,a)),Za.waitFor(s)},Dc.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},Dc.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},Dc);function Dc(t,e){var n=this;return(n=Ic.call(this)||this).Ie=t,n.trackRemovals=e,n.Ae=new _c(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),n}function Nc(t,e){this.R=t,this.Ut=e}function Cc(){this.changes=new _c(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}function kc(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}function Rc(t){return wu(t,Ba.store)}function xc(t){return wu(t,qa.store)}function Oc(t){return t.path.toArray()}var Lc=(Pc.prototype.Rt=function(e,n,t,r){var i=this;Fr(t<r&&0<=t&&r<=11);var o=new tu("createOrUpgrade",n);t<1&&1<=r&&(e.createObjectStore(xa.store),(s=e).createObjectStore(La.store,{keyPath:La.keyPath}),s.createObjectStore(Pa.store,{keyPath:Pa.keyPath,autoIncrement:!0}).createIndex(Pa.userMutationsIndex,Pa.userMutationsKeyPath,{unique:!0}),s.createObjectStore(Ma.store),Mc(e),e.createObjectStore(qa.store));var s,a=Za.resolve();return t<3&&3<=r&&(0!==t&&((s=e).deleteObjectStore(Ka.store),s.deleteObjectStore(ja.store),s.deleteObjectStore(Ga.store),Mc(e)),a=a.next(function(){return t=o.store(Ga.store),e=new Ga(0,0,Gr.min().toTimestamp(),0),t.put(Ga.key,e);var t,e})),t<4&&4<=r&&(a=(a=0!==t?a.next(function(){return n=e,(r=o).store(Pa.store).Nt().next(function(t){n.deleteObjectStore(Pa.store),n.createObjectStore(Pa.store,{keyPath:Pa.keyPath,autoIncrement:!0}).createIndex(Pa.userMutationsIndex,Pa.userMutationsKeyPath,{unique:!0});var e=r.store(Pa.store),t=t.map(function(t){return e.put(t)});return Za.waitFor(t)});var n,r}):a).next(function(){e.createObjectStore(Ha.store,{keyPath:Ha.keyPath})})),t<5&&5<=r&&(a=a.next(function(){return i.Re(o)})),t<6&&6<=r&&(a=a.next(function(){return e.createObjectStore(Ba.store),i.be(o)})),t<7&&7<=r&&(a=a.next(function(){return i.ve(o)})),t<8&&8<=r&&(a=a.next(function(){return i.Pe(e,o)})),t<9&&9<=r&&(a=a.next(function(){var t;(t=e).objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges"),(t=n.objectStore(qa.store)).createIndex(qa.readTimeIndex,qa.readTimeIndexPath,{unique:!1}),t.createIndex(qa.collectionReadTimeIndex,qa.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=r&&(a=a.next(function(){return i.Ve(o)})),t<11&&11<=r?a.next(function(){e.createObjectStore(za.store,{keyPath:za.keyPath}),e.createObjectStore(Wa.store,{keyPath:Wa.keyPath})}):a},Pc.prototype.be=function(e){var n=0;return e.store(qa.store).$t(function(t,e){n+=Ju(e)}).next(function(){var t=new Ba(n);return e.store(Ba.store).put(Ba.key,t)})},Pc.prototype.Re=function(n){var r=this,t=n.store(La.store),i=n.store(Pa.store);return t.Nt().next(function(t){return Za.forEach(t,function(e){var t=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return i.Nt(Pa.userMutationsIndex,t).next(function(t){return Za.forEach(t,function(t){return Fr(t.userId===e.userId),t=Ou(r.R,t),$u(n,e.userId,t).next(function(){})})})})})},Pc.prototype.ve=function(t){var o=t.store(Ka.store),e=t.store(qa.store);return t.store(Ga.store).get(Ga.key).next(function(r){var i=[];return e.$t(function(t,e){var n=new Jr(t),t=[0,Ca(n)];i.push(o.get(t).next(function(t){return t?Za.resolve():o.put(new Ka(0,Ca(n),r.highestListenSequenceNumber))}))}).next(function(){return Za.waitFor(i)})})},Pc.prototype.Pe=function(t,e){function r(t){if(i.add(t)){var e=t.lastSegment(),t=t.popLast();return n.put({collectionId:e,parent:Ca(t)})}}t.createObjectStore(Qa.store,{keyPath:Qa.keyPath});var n=e.store(Qa.store),i=new ju;return e.store(qa.store).$t({Ft:!0},function(t,e){return r((t=new Jr(t)).popLast())}).next(function(){return e.store(Ma.store).$t({Ft:!0},function(t,e){t[0];var n=t[1];return t[2],r((n=Ra(n)).popLast())})})},Pc.prototype.Ve=function(t){var n=this,r=t.store(ja.store);return r.$t(function(t,e){return e=Lu(e),e=Pu(n.R,e),r.put(e)})},Pc);function Pc(t){this.R=t}function Mc(t){t.createObjectStore(Ka.store,{keyPath:Ka.keyPath}).createIndex(Ka.documentTargetsIndex,Ka.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(ja.store,{keyPath:ja.keyPath}).createIndex(ja.queryTargetsIndexName,ja.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Ga.store)}var Fc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Vc=(Uc.prototype.start=function(){var e=this;return this.je().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new Nr(Dr.FAILED_PRECONDITION,Fc);return e.We(),e.Ge(),e.ze(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.qe.getHighestSequenceNumber(t)})}).then(function(t){e.Ne=new _r(t,e.De)}).then(function(){e.xe=!0}).catch(function(t){return e.Be&&e.Be.close(),Promise.reject(t)})},Uc.prototype.He=function(n){var t=this;return this.Me=function(e){return y(t,void 0,void 0,function(){return g(this,function(t){return this.started?[2,n(e)]:[2]})})},n(this.isPrimary)},Uc.prototype.setDatabaseDeletedListener=function(n){var t=this;this.Be.vt(function(e){return y(t,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},Uc.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return y(e,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},Uc.prototype.je=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return Bc(e).put(new Ha(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.Je(e).next(function(t){t||(n.isPrimary=!1,n.Se.enqueueRetryable(function(){return n.Me(!1)}))})}).next(function(){return n.Ye(e)}).next(function(t){return n.isPrimary&&!t?n.Xe(e).next(function(){return!1}):!!t&&n.Ze(e).next(function(){return!0})})}).catch(function(t){if(hu(t))return xr("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return xr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.Se.enqueueRetryable(function(){return n.Me(t)}),n.isPrimary=t})},Uc.prototype.Je=function(t){var e=this;return qc(t).get(xa.key).next(function(t){return Za.resolve(e.tn(t))})},Uc.prototype.en=function(t){return Bc(t).delete(this.clientId)},Uc.prototype.nn=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o=this;return g(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=wu(t,Ha.store);return r.Nt().next(function(t){var e=o.rn(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return Za.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.Qe)for(n=0,r=e;n<r.length;n++)i=r[n],this.Qe.removeItem(this.on(i.clientId));t.label=2;case 2:return[2]}})})},Uc.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},Uc.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},Uc.prototype.Ye=function(e){var r=this;return this.Ce?Za.resolve(!0):qc(e).get(xa.key).next(function(t){if(null!==t&&r.sn(t.leaseTimestampMs,5e3)&&!r.cn(t.ownerId)){if(r.tn(t)&&r.networkEnabled)return!0;if(!r.tn(t)){if(!t.allowTabSynchronization)throw new Nr(Dr.FAILED_PRECONDITION,Fc);return!1}}return!(!r.networkEnabled||!r.inForeground)||Bc(e).Nt().next(function(t){return void 0===r.rn(t,5e3).find(function(t){if(r.clientId!==t.clientId){var e=!r.networkEnabled&&t.networkEnabled,n=!r.inForeground&&t.inForeground,t=r.networkEnabled===t.networkEnabled;if(e||n&&t)return!0}return!1})})}).next(function(t){return r.isPrimary!==t&&xr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},Uc.prototype.shutdown=function(){return y(this,void 0,void 0,function(){var n=this;return g(this,function(t){switch(t.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[xa.store,Ha.store],function(t){var e=new mu(t,_r.o);return n.Xe(e).next(function(){return n.en(e)})})];case 1:return t.sent(),this.Be.close(),this.ln(),[2]}})})},Uc.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},Uc.prototype.fn=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return Bc(t).Nt().next(function(t){return e.rn(t,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(Uc.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),Uc.prototype.getMutationQueue=function(t){return Zu.Qt(t,this.R,this.Ut,this.referenceDelegate)},Uc.prototype.getTargetCache=function(){return this.qe},Uc.prototype.getRemoteDocumentCache=function(){return this.Ue},Uc.prototype.getIndexManager=function(){return this.Ut},Uc.prototype.getBundleCache=function(){return this.Ke},Uc.prototype.runTransaction=function(e,n,r){var i,o=this;return xr("IndexedDbPersistence","Starting transaction:",e),this.Be.runTransaction(e,"readonly"===n?"readonly":"readwrite",$a,function(t){return i=new mu(t,o.Ne?o.Ne.next():_r.o),"readwrite-primary"===n?o.Je(i).next(function(t){return!!t||o.Ye(i)}).next(function(t){if(!t)throw Or("Failed to obtain primary lease for action '"+e+"'."),o.isPrimary=!1,o.Se.enqueueRetryable(function(){return o.Me(!1)}),new Nr(Dr.FAILED_PRECONDITION,Ja);return r(i)}).next(function(t){return o.Ze(i).next(function(){return t})}):o.dn(i).next(function(){return r(i)})}).then(function(t){return i.raiseOnCommittedEvent(),t})},Uc.prototype.dn=function(t){var e=this;return qc(t).get(xa.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Nr(Dr.FAILED_PRECONDITION,Fc)})},Uc.prototype.Ze=function(t){var e=new xa(this.clientId,this.allowTabSynchronization,Date.now());return qc(t).put(xa.key,e)},Uc.yt=function(){return eu.yt()},Uc.prototype.Xe=function(t){var e=this,n=qc(t);return n.get(xa.key).next(function(t){return e.tn(t)?(xr("IndexedDbPersistence","Releasing primary lease."),n.delete(xa.key)):Za.resolve()})},Uc.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Or("Detected an update time that is in the future: "+t+" > "+n),1))},Uc.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Fe=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.Fe),this.inForeground="visible"===this.document.visibilityState)},Uc.prototype.an=function(){this.Fe&&(this.document.removeEventListener("visibilitychange",this.Fe),this.Fe=null)},Uc.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ke=function(){e.un(),!function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&navigator.appVersion.match("Version/14")&&e.Se.enterRestrictedMode(!0),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("pagehide",this.ke))},Uc.prototype.hn=function(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)},Uc.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return xr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Or("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},Uc.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Or("Failed to set zombie client id.",t)}},Uc.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},Uc.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Uc);function Uc(t,e,n,r,i,o,s,a,u,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Se=i,this.window=o,this.document=s,this.De=u,this.Ce=c,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.Fe=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!Uc.yt())throw new Nr(Dr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new mc(this,r),this.Le=e+"main",this.R=new bu(a),this.Be=new eu(this.Le,11,new Lc(this.R)),this.qe=new sc(this.referenceDelegate,this.R),this.Ut=new Ku,this.Ue=(e=this.R,a=this.Ut,new Sc(e,a)),this.Ke=new Fu,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===c&&Or("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function qc(t){return wu(t,xa.store)}function Bc(t){return wu(t,Ha.store)}function jc(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}function Kc(t,e){this.progress=t,this.wn=e}var Gc=($c.prototype.mn=function(e,n){var r=this;return this._n.getAllMutationBatchesAffectingDocumentKey(e,n).next(function(t){return r.yn(e,n,t)})},$c.prototype.yn=function(t,e,r){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,n=r;e<n.length;e++)n[e].applyToLocalView(t);return t})},$c.prototype.gn=function(t,i){t.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)r[n].applyToLocalView(e)})},$c.prototype.pn=function(e,t){var n=this;return this.Ue.getEntries(e,t).next(function(t){return n.En(e,t).next(function(){return t})})},$c.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},$c.prototype.getDocumentsMatchingQuery=function(t,e,n){return mi.isDocumentKey((r=e).path)&&null===r.collectionGroup&&0===r.filters.length?this.Tn(t,e.path):So(e)?this.In(t,e,n):this.An(t,e,n);var r},$c.prototype.Tn=function(t,e){return this.mn(t,new mi(e)).next(function(t){var e=Us;return t.isFoundDocument()?e.insert(t.key,t):e})},$c.prototype.In=function(n,r,i){var o=this,s=r.collectionGroup,a=Us;return this.Ut.getCollectionParents(n,s).next(function(t){return Za.forEach(t,function(t){var e=(e=r,t=t.child(s),new vo(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt));return o.An(n,e,i).next(function(t){t.forEach(function(t,e){a=a.insert(t,e)})})}).next(function(){return a})})},$c.prototype.An=function(e,n,t){var c,h,r=this;return this.Ue.getDocumentsMatchingQuery(e,n,t).next(function(t){return c=t,r._n.getAllMutationBatchesAffectingQuery(e,n)}).next(function(t){return h=t,r.Rn(e,h,c).next(function(t){c=t;for(var e=0,n=h;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],a=s.key,u=c.get(a);null==u&&(u=Pi.newInvalidDocument(a),c=c.insert(a,u)),os(s,u,r.localWriteTime),u.isFoundDocument()||(c=c.remove(a))}})}).next(function(){return c.forEach(function(t,e){xo(n,e)||(c=c.remove(t))}),c})},$c.prototype.Rn=function(t,e,n){for(var r=js(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof ls&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},$c),Qc=(Xc.Pn=function(t,e){for(var n=js(),r=js(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new Xc(t,e.fromCache,n,r)},Xc),Hc=(Yc.prototype.Vn=function(t){this.Sn=t},Yc.prototype.getDocumentsMatchingQuery=function(e,r,i,o){var s=this;return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())||i.isEqual(Gr.min())?this.Dn(e,r):this.Sn.pn(e,o).next(function(t){var n=s.Cn(r,t);return(To(r)||Eo(r))&&s.Nn(r.limitType,n,o,i)?s.Dn(e,r):(Rr()<=m.DEBUG&&xr("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ro(r)),s.Sn.getDocumentsMatchingQuery(e,r,i).next(function(e){return n.forEach(function(t){e=e.insert(t.key,t)}),e}))})},Yc.prototype.Cn=function(n,t){var r=new Ls(Oo(n));return t.forEach(function(t,e){xo(n,e)&&(r=r.add(e))}),r},Yc.prototype.Nn=function(t,e,n,r){return n.size!==e.size||!!(e="F"===t?e.last():e.first())&&(e.hasPendingWrites||0<e.version.compareTo(r))},Yc.prototype.Dn=function(t,e){return Rr()<=m.DEBUG&&xr("QueryEngine","Using full collection scan to execute query:",Ro(e)),this.Sn.getDocumentsMatchingQuery(t,e,Gr.min())},Yc),zc=(Wc.prototype.collectGarbage=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.collect(t,n.kn)})},Wc);function Wc(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.kn=new Ds(qr),this.Fn=new _c(Vi,Ui),this.$n=Gr.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Gc(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}function Yc(){}function Xc(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}function $c(t,e,n){this.Ue=t,this._n=e,this.Ut=n}function Jc(t,e,n,r){return new zc(t,e,n,r)}function Zc(i,o){return y(this,void 0,void 0,function(){var e,n,v,r;return g(this,function(t){switch(t.label){case 0:return n=(e=i)._n,v=e.Mn,[4,e.persistence.runTransaction("Handle user change","readonly",function(g){var m;return e._n.getAllMutationBatches(g).next(function(t){return m=t,n=e.persistence.getMutationQueue(o),v=new Gc(e.On,n,e.persistence.getIndexManager()),n.getAllMutationBatches(g)}).next(function(t){for(var e=[],n=[],r=js(),i=0,o=m;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var a=0,u=s.mutations;a<u.length;a++)var c=u[a],r=r.add(c.key)}for(var h=0,l=t;h<l.length;h++){var f=l[h];n.push(f.batchId);for(var d=0,p=f.mutations;d<p.length;d++){var y=p[d];r=r.add(y.key)}}return v.pn(g,r).next(function(t){return{Ln:t,removedBatchIds:e,addedBatchIds:n}})})})];case 1:return r=t.sent(),[2,(e._n=n,e.Mn=v,e.xn.Vn(e.Mn),r)]}})})}function th(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function eh(t,s,e,a,u){var n=js();return e.forEach(function(t){return n=n.add(t)}),s.getEntries(t,n).next(function(i){var o=Ms;return e.forEach(function(t,e){var n=i.get(t),r=(null==u?void 0:u.get(t))||a;e.isNoDocument()&&e.version.isEqual(Gr.min())?(s.removeEntry(t,r),o=o.insert(t,e)):!n.isValidDocument()||0<e.version.compareTo(n.version)||0===e.version.compareTo(n.version)&&n.hasPendingWrites?(s.addEntry(e,r),o=o.insert(t,e)):xr("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version)}),o})}function nh(t,r){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.qe.getTargetData(e,r).next(function(t){return t?(n=t,Za.resolve(n)):i.qe.allocateTargetId(e).next(function(t){return n=new Iu(r,t,0,e.currentSequenceNumber),i.qe.addTargetData(e,n).next(function(){return n})})})}).then(function(t){var e=i.kn.get(t.targetId);return(null===e||0<t.snapshotVersion.compareTo(e.snapshotVersion))&&(i.kn=i.kn.insert(t.targetId,t),i.Fn.set(r,t.targetId)),t})}function rh(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:n=(e=i).kn.get(o),r=s?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),s?[3,3]:[4,e.persistence.runTransaction("Release target",r,function(t){return e.persistence.referenceDelegate.removeTarget(t,n)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!hu(r=t.sent()))throw r;return xr("LocalStore","Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return e.kn=e.kn.remove(o),e.Fn.delete(n.target),[2]}})})}function ih(t,o,s){var a=t,u=Gr.min(),c=js();return a.persistence.runTransaction("Execute query","readonly",function(e){return t=a,n=e,r=Do(o),(void 0!==(t=(i=t).Fn.get(r))?Za.resolve(i.kn.get(t)):i.qe.getTargetData(n,r)).next(function(t){if(t)return u=t.lastLimboFreeSnapshotVersion,a.qe.getMatchingKeysForTargetId(e,t.targetId).next(function(t){c=t})}).next(function(){return a.xn.getDocumentsMatchingQuery(e,o,s?u:Gr.min(),s?c:js())}).next(function(t){return{documents:t,Bn:c}});var t,n,r,i})}function oh(t,e){var n=t,r=n.qe;return(t=n.kn.get(e))?Promise.resolve(t.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function sh(t){var s=t;return s.persistence.runTransaction("Get new document changes","readonly",function(t){return e=s.On,n=t,t=s.$n,r=e,i=Ms,o=Cu(t),t=xc(n),n=IDBKeyRange.lowerBound(o,!0),t.$t({index:qa.readTimeIndex,range:n},function(t,e){var n=Du(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:ku(o)}});var e,n,r,i,o}).then(function(t){var e=t.wn,t=t.readTime;return s.$n=t,e})}var ah,uh,ch=(kh.prototype.getBundleMetadata=function(t,e){return Za.resolve(this.Qn.get(e))},kh.prototype.saveBundleMetadata=function(t,e){return this.Qn.set(e.id,{id:e.id,version:e.version,createTime:ua(e.createTime)}),Za.resolve()},kh.prototype.getNamedQuery=function(t,e){return Za.resolve(this.jn.get(e))},kh.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,{name:e.name,query:Mu(e.bundledQuery),readTime:ua(e.readTime)}),Za.resolve()},kh),hh=(Ch.prototype.isEmpty=function(){return this.Wn.isEmpty()},Ch.prototype.addReference=function(t,e){e=new lh(t,e),this.Wn=this.Wn.add(e),this.zn=this.zn.add(e)},Ch.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},Ch.prototype.removeReference=function(t,e){this.Yn(new lh(t,e))},Ch.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},Ch.prototype.Zn=function(t){var e=this,n=new mi(new Jr([])),r=new lh(n,t),t=new lh(n,t+1),i=[];return this.zn.forEachInRange([r,t],function(t){e.Yn(t),i.push(t.key)}),i},Ch.prototype.ts=function(){var e=this;this.Wn.forEach(function(t){return e.Yn(t)})},Ch.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},Ch.prototype.es=function(t){var e=new mi(new Jr([])),n=new lh(e,t),t=new lh(e,t+1),r=js();return this.zn.forEachInRange([n,t],function(t){r=r.add(t.key)}),r},Ch.prototype.containsKey=function(t){var e=new lh(t,0);return null!==(e=this.Wn.firstAfterOrEqual(e))&&t.isEqual(e.key)},Ch),lh=(Nh.Gn=function(t,e){return mi.comparator(t.key,e.key)||qr(t.ns,e.ns)},Nh.Hn=function(t,e){return qr(t.ns,e.ns)||mi.comparator(t.key,e.key)},Nh),fh=(Dh.prototype.checkEmpty=function(t){return Za.resolve(0===this._n.length)},Dh.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++,0<this._n.length&&this._n[this._n.length-1],n=new Tu(i,e,n,r),this._n.push(n);for(var o=0,s=r;o<s.length;o++){var a=s[o];this.rs=this.rs.add(new lh(a.key,i)),this.Ut.addToCollectionParentIndex(t,a.key.path.popLast())}return Za.resolve(n)},Dh.prototype.lookupMutationBatch=function(t,e){return Za.resolve(this.os(e))},Dh.prototype.getNextMutationBatchAfterBatchId=function(t,e){return e=this.cs(e+1),Za.resolve(this._n.length>(e=e<0?0:e)?this._n[e]:null)},Dh.prototype.getHighestUnacknowledgedBatchId=function(){return Za.resolve(0===this._n.length?-1:this.ss-1)},Dh.prototype.getAllMutationBatches=function(t){return Za.resolve(this._n.slice())},Dh.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new lh(e,0),e=new lh(e,Number.POSITIVE_INFINITY),i=[];return this.rs.forEachInRange([r,e],function(t){t=n.os(t.ns),i.push(t)}),Za.resolve(i)},Dh.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Ls(qr);return e.forEach(function(t){var e=new lh(t,0),t=new lh(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,t],function(t){r=r.add(t.ns)})}),Za.resolve(this.us(r))},Dh.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,e=n;mi.isDocumentKey(e)||(e=e.child(""));var e=new lh(new mi(e),0),i=new Ls(qr);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(i=i.add(t.ns)),!0)},e),Za.resolve(this.us(i))},Dh.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){null!==(t=e.os(t))&&n.push(t)}),n},Dh.prototype.removeMutationBatch=function(n,r){var i=this;Fr(0===this.hs(r.batchId,"removed")),this._n.shift();var o=this.rs;return Za.forEach(r.mutations,function(t){var e=new lh(t.key,r.batchId);return o=o.delete(e),i.referenceDelegate.markPotentiallyOrphaned(n,t.key)}).next(function(){i.rs=o})},Dh.prototype.Gt=function(t){},Dh.prototype.containsKey=function(t,e){var n=new lh(e,0),n=this.rs.firstAfterOrEqual(n);return Za.resolve(e.isEqual(n&&n.key))},Dh.prototype.performConsistencyCheck=function(t){return this._n.length,Za.resolve()},Dh.prototype.hs=function(t,e){return this.cs(t)},Dh.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},Dh.prototype.os=function(t){return(t=this.cs(t))<0||t>=this._n.length?null:this._n[t]},Dh),dh=(Ah.prototype.addEntry=function(t,e,n){var r=e.key,i=(o=this.docs.get(r))?o.size:0,o=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:o,readTime:n}),this.size+=o-i,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},Ah.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Ah.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Za.resolve(n?n.document.clone():Pi.newInvalidDocument(e))},Ah.prototype.getEntries=function(t,e){var n=this,r=Ms;return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():Pi.newInvalidDocument(t))}),Za.resolve(r)},Ah.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Ms,i=new mi(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=(a=o.getNext()).key,a=(u=a.value).document,u=u.readTime;if(!e.path.isPrefixOf(s.path))break;u.compareTo(n)<=0||xo(e,a)&&(r=r.insert(a.key,a.clone()))}return Za.resolve(r)},Ah.prototype.fs=function(t,e){return Za.forEach(this.docs,function(t){return e(t)})},Ah.prototype.newChangeBuffer=function(t){return new ph(this)},Ah.prototype.getSize=function(t){return Za.resolve(this.size)},Ah),ph=(n(Sh,uh=_),Sh.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach(function(t,e){e.document.isValidDocument()?i.push(r.Ie.addEntry(n,e.document,r.getReadTime(t))):r.Ie.removeEntry(t)}),Za.waitFor(i)},Sh.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},Sh.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},Sh),yh=(_h.prototype.forEachTarget=function(t,n){return this.ds.forEach(function(t,e){return n(e)}),Za.resolve()},_h.prototype.getLastRemoteSnapshotVersion=function(t){return Za.resolve(this.lastRemoteSnapshotVersion)},_h.prototype.getHighestSequenceNumber=function(t){return Za.resolve(this.ws)},_h.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),Za.resolve(this.highestTargetId)},_h.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),Za.resolve()},_h.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new oc(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},_h.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,Za.resolve()},_h.prototype.updateTargetData=function(t,e){return this.te(e),Za.resolve()},_h.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),--this.targetCount,Za.resolve()},_h.prototype.removeTargets=function(n,r,i){var o=this,s=0,a=[];return this.ds.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.ds.delete(t),a.push(o.removeMatchingKeysForTargetId(n,e.targetId)),s++)}),Za.waitFor(a).next(function(){return s})},_h.prototype.getTargetCount=function(t){return Za.resolve(this.targetCount)},_h.prototype.getTargetData=function(t,e){return e=this.ds.get(e)||null,Za.resolve(e)},_h.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),Za.resolve()},_h.prototype.removeMatchingKeys=function(e,t,n){this._s.Xn(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.markPotentiallyOrphaned(e,t))}),Za.waitFor(i)},_h.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),Za.resolve()},_h.prototype.getMatchingKeysForTargetId=function(t,e){return e=this._s.es(e),Za.resolve(e)},_h.prototype.containsKey=function(t,e){return Za.resolve(this._s.containsKey(e))},_h),gh=(Ih.prototype.start=function(){return Promise.resolve()},Ih.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(Ih.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),Ih.prototype.setDatabaseDeletedListener=function(){},Ih.prototype.setNetworkEnabled=function(){},Ih.prototype.getIndexManager=function(){return this.Ut},Ih.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new fh(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},Ih.prototype.getTargetCache=function(){return this.qe},Ih.prototype.getRemoteDocumentCache=function(){return this.Ue},Ih.prototype.getBundleCache=function(){return this.Ke},Ih.prototype.runTransaction=function(t,e,n){var r=this;xr("MemoryPersistence","Starting transaction:",t);var i=new mh(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},Ih.prototype.Is=function(e,n){return Za.or(Object.values(this.gs).map(function(t){return function(){return t.containsKey(e,n)}}))},Ih),mh=(n(Eh,ah=C),Eh),vh=(Th.bs=function(t){return new Th(t)},Object.defineProperty(Th.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Mr()},enumerable:!1,configurable:!0}),Th.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),Za.resolve()},Th.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),Za.resolve()},Th.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),Za.resolve()},Th.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},Th.prototype.Es=function(){this.Rs=new Set},Th.prototype.Ts=function(n){var r=this,i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Za.forEach(this.vs,function(t){var e=mi.fromPath(t);return r.Ps(n,e).next(function(t){t||i.removeEntry(e)})}).next(function(){return r.Rs=null,i.apply(n)})},Th.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},Th.prototype.ps=function(t){return 0},Th.prototype.Ps=function(t,e){var n=this;return Za.or([function(){return Za.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},Th),wh=(bh.prototype.isAuthenticated=function(){return null!=this.uid},bh.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},bh.prototype.isEqual=function(t){return t.uid===this.uid},bh);function bh(t){this.uid=t}function Th(t){this.persistence=t,this.As=new hh,this.Rs=null}function Eh(t){var e=this;return(e=ah.call(this)||this).currentSequenceNumber=t,e}function Ih(t,e){var n=this;this.gs={},this.Ne=new _r(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new yh(this),this.Ut=new Bu,this.Ue=(t=this.Ut,new dh(t,function(t){return n.referenceDelegate.ps(t)})),this.R=new bu(e),this.Ke=new ch(this.R)}function _h(t){this.persistence=t,this.ds=new _c(Vi,Ui),this.lastRemoteSnapshotVersion=Gr.min(),this.highestTargetId=0,this.ws=0,this._s=new hh,this.targetCount=0,this.ys=oc.Jt()}function Sh(t){var e=this;return(e=uh.call(this)||this).Ie=t,e}function Ah(t,e){this.Ut=t,this.ls=e,this.docs=new Ds(mi.comparator),this.size=0}function Dh(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Ls(lh.Gn)}function Nh(t,e){this.key=t,this.ns=e}function Ch(){this.Wn=new Ls(lh.Gn),this.zn=new Ls(lh.Hn)}function kh(t){this.R=t,this.Qn=new Map,this.jn=new Map}function Rh(t,e){return"firestore_clients_"+t+"_"+e}function xh(t,e,n){return n="firestore_mutations_"+t+"_"+n,e.isAuthenticated()&&(n+="_"+e.uid),n}function Oh(t,e){return"firestore_targets_"+t+"_"+e}wh.UNAUTHENTICATED=new wh(null),wh.GOOGLE_CREDENTIALS=new wh("google-credentials-uid"),wh.FIRST_PARTY=new wh("first-party-uid"),wh.MOCK_USER=new wh("mock-user");var Lh,Ph=(il.Vs=function(t,e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Nr(i.error.code,i.error.message)),o?new il(t,e,i.state,r):(Or("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},il.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},il),Mh=(rl.Vs=function(t,e){var n,r=JSON.parse(e),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new Nr(r.error.code,r.error.message)),i?new rl(t,r.state,n):(Or("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},rl.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},rl),Fh=(nl.Vs=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Hs,o=0;r&&o<n.activeTargetIds.length;++o)r=gi(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new nl(t,i):(Or("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},nl),Vh=(el.Vs=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new el(e.clientId,e.onlineState):(Or("SharedClientState","Failed to parse online state: "+t),null)},el),Uh=(tl.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},tl.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},tl.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},tl),qh=(Zh.yt=function(t){return!(!t||!t.localStorage)},Zh.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,c,h,l=this;return g(this,function(t){switch(t.label){case 0:return[4,this.syncEngine.fn()];case 1:for(s=t.sent(),e=0,n=s;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(Rh(this.persistenceKey,r)))&&(o=Fh.Vs(r,i))&&(this.Fs=this.Fs.insert(o.clientId,o));for(this.Qs(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.$s;u<c.length;u++)h=c[u],this.ks(h);return this.$s=[],this.window.addEventListener("pagehide",function(){return l.shutdown()}),this.started=!0,[2]}})})},Zh.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},Zh.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.Fs)},Zh.prototype.isActiveQueryTarget=function(n){var r=!1;return this.Fs.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},Zh.prototype.addPendingMutation=function(t){this.zs(t,"pending")},Zh.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},Zh.prototype.addLocalQueryTarget=function(t){var e,n="not-current";return this.isActiveQueryTarget(t)&&(!(e=this.storage.getItem(Oh(this.persistenceKey,t)))||(e=Mh.Vs(t,e))&&(n=e.state)),this.Js.Ds(t),this.Qs(),n},Zh.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},Zh.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},Zh.prototype.clearQueryState=function(t){this.removeItem(Oh(this.persistenceKey,t))},Zh.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},Zh.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},Zh.prototype.setOnlineState=function(t){this.Xs(t)},Zh.prototype.notifyBundleLoaded=function(){this.Zs()},Zh.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},Zh.prototype.getItem=function(t){var e=this.storage.getItem(t);return xr("SharedClientState","READ",t,e),e},Zh.prototype.setItem=function(t,e){xr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},Zh.prototype.removeItem=function(t){xr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},Zh.prototype.ks=function(t){var e=this,o=t;o.storageArea===this.storage&&(xr("SharedClientState","EVENT",o.key,o.newValue),o.key!==this.Os?this.Se.enqueueRetryable(function(){return y(e,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){if(this.started){if(null!==o.key)if(this.Ls.test(o.key)){if(null==o.newValue)return e=this.ti(o.key),[2,this.ei(e,null)];if(e=this.ni(o.key,o.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(o.key)){if(null!==o.newValue&&(n=this.si(o.key,o.newValue)))return[2,this.ii(n)]}else if(this.qs.test(o.key)){if(null!==o.newValue&&(r=this.ri(o.key,o.newValue)))return[2,this.oi(r)]}else if(o.key===this.Us){if(null!==o.newValue&&(i=this.js(o.newValue)))return[2,this.Ws(i)]}else if(o.key===this.Ms)(i=function(t){var e=_r.o;if(null!=t)try{var n=JSON.parse(t);Fr("number"==typeof n),e=n}catch(t){Or("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(o.newValue))!==_r.o&&this.sequenceNumberHandler(i);else if(o.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(o);return[2]})})}):Or("Received WebStorage notification for local change. Another client might have garbage-collected our state"))},Object.defineProperty(Zh.prototype,"Js",{get:function(){return this.Fs.get(this.Ns)},enumerable:!1,configurable:!0}),Zh.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},Zh.prototype.zs=function(t,e,n){n=new Ph(this.currentUser,t,e,n),t=xh(this.persistenceKey,this.currentUser,t),this.setItem(t,n.Ss())},Zh.prototype.Hs=function(t){t=xh(this.persistenceKey,this.currentUser,t),this.removeItem(t)},Zh.prototype.Xs=function(t){t={clientId:this.Ns,onlineState:t},this.storage.setItem(this.Us,JSON.stringify(t))},Zh.prototype.Ys=function(t,e,n){var r=Oh(this.persistenceKey,t),n=new Mh(t,e,n);this.setItem(r,n.Ss())},Zh.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},Zh.prototype.ti=function(t){return(t=this.Ls.exec(t))?t[1]:null},Zh.prototype.ni=function(t,e){return t=this.ti(t),Fh.Vs(t,e)},Zh.prototype.si=function(t,e){var n=this.Bs.exec(t),t=Number(n[1]),n=void 0!==n[2]?n[2]:null;return Ph.Vs(new wh(n),t,e)},Zh.prototype.ri=function(t,e){return t=this.qs.exec(t),t=Number(t[1]),Mh.Vs(t,e)},Zh.prototype.js=function(t){return Vh.Vs(t)},Zh.prototype.ii=function(e){return y(this,void 0,void 0,function(){return g(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(e.batchId,e.state,e.error)]:(xr("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},Zh.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},Zh.prototype.ei=function(t,e){var n=this,r=e?this.Fs.insert(t,e):this.Fs.remove(t),i=this.Gs(this.Fs),o=this.Gs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.hi(s,a).then(function(){n.Fs=r})},Zh.prototype.Ws=function(t){this.Fs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},Zh.prototype.Gs=function(t){var n=Hs;return t.forEach(function(t,e){n=n.unionWith(e.activeTargetIds)}),n},Zh),Bh=(Jh.prototype.addPendingMutation=function(t){},Jh.prototype.updateMutationState=function(t,e,n){},Jh.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},Jh.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},Jh.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},Jh.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},Jh.prototype.clearQueryState=function(t){delete this.fi[t]},Jh.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},Jh.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},Jh.prototype.start=function(){return this.li=new Uh,Promise.resolve()},Jh.prototype.handleUserChange=function(t,e,n){},Jh.prototype.setOnlineState=function(t){},Jh.prototype.shutdown=function(){},Jh.prototype.writeSequenceNumber=function(t){},Jh.prototype.notifyBundleLoaded=function(){},Jh),jh=($h.prototype.di=function(t){},$h.prototype.shutdown=function(){},$h),Kh=(Xh.prototype.di=function(t){this.gi.push(t)},Xh.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},Xh.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},Xh.prototype._i=function(){xr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},Xh.prototype.yi=function(){xr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},Xh.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},Xh),Gh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Qh=(Yh.prototype.Ii=function(t){this.Ai=t},Yh.prototype.Ri=function(t){this.bi=t},Yh.prototype.onMessage=function(t){this.vi=t},Yh.prototype.close=function(){this.Ti()},Yh.prototype.send=function(t){this.Ei(t)},Yh.prototype.Pi=function(){this.Ai()},Yh.prototype.Vi=function(t){this.bi(t)},Yh.prototype.Si=function(t){this.vi(t)},Yh),Hh=(Wh.prototype.Ni=function(e,t,n,r){var i=this.xi(e,t);return xr("RestConnection","Sending: ",i,n),this.ki(t={},r),this.Fi(e,i,t,n).then(function(t){return xr("RestConnection","Received: ",t),t},function(t){throw Lr("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},Wh.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},Wh.prototype.ki=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.10.1",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},Wh.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+Gh[t]},n(zh,Lh=Wh),zh.prototype.Fi=function(u,e,n,r){return new Promise(function(o,s){var a=new Ir;a.listenOnce(wr.COMPLETE,function(){try{switch(a.getLastErrorCode()){case vr.NO_ERROR:var t=a.getResponseJson();xr("Connection","XHR received:",JSON.stringify(t)),o(t);break;case vr.TIMEOUT:xr("Connection",'RPC "'+u+'" timed out'),s(new Nr(Dr.DEADLINE_EXCEEDED,"Request time out"));break;case vr.HTTP_ERROR:var e,n,r=a.getStatus();xr("Connection",'RPC "'+u+'" failed with status:',r,"response text:",a.getResponseText()),0<r?(e=a.getResponseJson().error)&&e.status&&e.message?(i=e.status.toLowerCase().replace(/_/g,"-"),n=0<=Object.values(Dr).indexOf(i)?i:Dr.UNKNOWN,s(new Nr(n,e.message))):s(new Nr(Dr.UNKNOWN,"Server responded with status "+a.getStatus())):s(new Nr(Dr.UNAVAILABLE,"Connection failed."));break;default:Mr()}}finally{xr("Connection",'RPC "'+u+'" completed.')}var i});var t=JSON.stringify(r);a.send(e,"POST",t,n,15)})},zh.prototype.Oi=function(t,e){var n,r=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=new fr,o=mr(),t={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(t.xmlHttpFactory=new Tr({})),this.ki(t.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(h())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=h().indexOf("Electron/")||0<=(n=h()).indexOf("MSIE ")||0<=n.indexOf("Trident/")||0<=h().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(t.httpHeadersOverwriteParam="$httpHeaders"),xr("Connection","Creating WebChannel: "+(r=r.join("")),t);var s=i.createWebChannel(r,t),a=!1,u=!1,c=new Qh({Ei:function(t){u?xr("Connection","Not sending because WebChannel is closed:",t):(a||(xr("Connection","Opening WebChannel transport."),s.open(),a=!0),xr("Connection","WebChannel sending:",t),s.send(t))},Ti:function(){return s.close()}});return(t=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})})(s,Er.EventType.OPEN,function(){u||xr("Connection","WebChannel transport opened.")}),t(s,Er.EventType.CLOSE,function(){u||(u=!0,xr("Connection","WebChannel transport closed"),c.Vi())}),t(s,Er.EventType.ERROR,function(t){u||(u=!0,Lr("Connection","WebChannel transport errored:",t),c.Vi(new Nr(Dr.UNAVAILABLE,"The operation could not be completed")))}),t(s,Er.EventType.MESSAGE,function(t){var e,n,r,i;u||(Fr(!!(e=t.data[0])),(n=e.error||(null===(i=e[0])||void 0===i?void 0:i.error))?(xr("Connection","WebChannel received error:",n),r=n.status,t=function(){var t=vs[r];if(void 0!==t)return As(t)}(),i=n.message,void 0===t&&(t=Dr.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),u=!0,c.Vi(new Nr(t,i)),s.close()):(xr("Connection","WebChannel received:",e),c.Si(e)))}),t(o,br.STAT_EVENT,function(t){10===t.stat?xr("Connection","Detected buffering proxy"):11===t.stat&&xr("Connection","Detected no buffering proxy")}),setTimeout(function(){c.Pi()},0),c},zh);function zh(t){var e=this;return(e=Lh.call(this,t)||this).forceLongPolling=t.forceLongPolling,e.autoDetectLongPolling=t.autoDetectLongPolling,e.useFetchStreams=t.useFetchStreams,e}function Wh(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}function Yh(t){this.Ei=t.Ei,this.Ti=t.Ti}function Xh(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}function $h(){}function Jh(){this.li=new Uh,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}function Zh(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.Fs=new Ds(qr),this.started=!1,this.$s=[],n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),this.storage=this.window.localStorage,this.currentUser=i,this.Os=Rh(this.persistenceKey,this.Ns),this.Ms="firestore_sequence_number_"+this.persistenceKey,this.Fs=this.Fs.insert(this.Ns,new Uh),this.Ls=new RegExp("^firestore_clients_"+n+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+n+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+n+"_(\\d+)$"),this.Us="firestore_online_state_"+this.persistenceKey,this.Ks="firestore_bundle_loaded_"+this.persistenceKey,this.window.addEventListener("storage",this.xs)}function tl(){this.activeTargetIds=Hs}function el(t,e){this.clientId=t,this.onlineState=e}function nl(t,e){this.clientId=t,this.activeTargetIds=e}function rl(t,e,n){this.targetId=t,this.state=e,this.error=n}function il(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function ol(){return"undefined"!=typeof window?window:null}function sl(){return"undefined"!=typeof document?document:null}function al(t){return new ra(t,!0)}function ul(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Fr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return y(o,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return Rl(this)?(xr("RemoteStore","Restarting streams for network reachability change."),[4,function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return(e=n).Or.add(4),[4,_l(e)];case 1:return t.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,Il(e)];case 2:return t.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new gl(n,r)}var cl,hl,ll,fl=(El.prototype.reset=function(){this.qi=0},El.prototype.Qi=function(){this.qi=this.Bi},El.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);0<i&&xr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},El.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},El.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},El.prototype.Wi=function(){return(Math.random()-.5)*this.qi},El),_=(Tl.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},Tl.prototype.er=function(){return 2===this.state},Tl.prototype.start=function(){3!==this.state?this.auth():this.nr()},Tl.prototype.stop=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Tl.prototype.sr=function(){this.state=0,this.Zi.reset()},Tl.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},Tl.prototype.cr=function(t){this.ur(),this.stream.send(t)},Tl.prototype.rr=function(){return y(this,void 0,void 0,function(){return g(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},Tl.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},Tl.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==e?this.Zi.reset():n&&n.code===Dr.RESOURCE_EXHAUSTED?(Or(n.toString()),Or("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):n&&n.code===Dr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Ri(n)];case 1:return t.sent(),[2]}})})},Tl.prototype.ar=function(){},Tl.prototype.auth=function(){var n=this;this.state=1;var t=this.hr(this.Yi),e=this.Yi;this.Ji.getToken().then(function(t){n.Yi===e&&n.lr(t)},function(e){t(function(){var t=new Nr(Dr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.dr(t)})})},Tl.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Tl.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return y(t,void 0,void 0,function(){return g(this,function(t){return this.state=0,this.start(),[2]})})})},Tl.prototype.dr=function(t){return xr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Tl.prototype.hr=function(e){var n=this;return function(t){n.Se.enqueueAndForget(function(){return n.Yi===e?t():(xr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Tl),dl=(n(bl,ll=_),bl.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},bl.prototype.onMessage=function(t){this.Zi.reset();var e,n=function(t,e){if("targetChange"in e){e.targetChange;var n="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:Mr(),r=e.targetChange.targetIds||[],i=(s=e.targetChange.resumeToken,t.I?(Fr(void 0===s||"string"==typeof s),ni.fromBase64String(s||"")):(Fr(void 0===s||s instanceof Uint8Array),ni.fromUint8Array(s||new Uint8Array))),o=(a=e.targetChange.cause)&&(u=void 0===(c=a).code?Dr.UNKNOWN:As(c.code),new Nr(u,c.message||"")),s=new Qs(n,r,i,o||null)}else if("documentChange"in e){e.documentChange,(n=e.documentChange).document,n.document.name,n.document.updateTime;var r=fa(t,n.document.name),i=ua(n.document.updateTime),a=new xi({mapValue:{fields:n.document.fields}}),u=(o=Pi.newFoundDocument(r,i,a),n.targetIds||[]),c=n.removedTargetIds||[],s=new Ks(u,c,o.key,o)}else if("documentDelete"in e)e.documentDelete,(n=e.documentDelete).document,r=fa(t,n.document),i=n.readTime?ua(n.readTime):Gr.min(),a=Pi.newNoDocument(r,i),o=n.removedTargetIds||[],s=new Ks([],o,a.key,a);else if("documentRemove"in e)e.documentRemove,(n=e.documentRemove).document,r=fa(t,n.document),i=n.removedTargetIds||[],s=new Ks([],i,r,null);else{if(!("filter"in e))return Mr();e.filter,(e=e.filter).targetId,r=new ms(n=e.count||0),i=e.targetId,s=new Gs(i,r)}return s}(this.R,t),t=!("targetChange"in(e=t))||(e=e.targetChange).targetIds&&e.targetIds.length||!e.readTime?Gr.min():ua(e.readTime);return this.listener._r(n,t)},bl.prototype.mr=function(t){var e,n,r,i,o={};o.database=ya(this.R),o.addTarget=(e=this.R,(r=qi(r=(n=t).target)?{documents:Ta(e,r)}:{query:Ea(e,r)}).targetId=n.targetId,0<n.resumeToken.approximateByteSize()?r.resumeToken=aa(e,n.resumeToken):0<n.snapshotVersion.compareTo(Gr.min())&&(r.readTime=sa(e,n.snapshotVersion.toTimestamp())),r),(t=(this.R,i=t,null==(t=function(){switch(i.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Mr()}}())?null:{"goog-listen-tags":t}))&&(o.labels=t),this.cr(o)},bl.prototype.yr=function(t){var e={};e.database=ya(this.R),e.removeTarget=t,this.cr(e)},bl),pl=(n(wl,hl=_),Object.defineProperty(wl.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),wl.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,hl.prototype.start.call(this)},wl.prototype.ar=function(){this.gr&&this.Er([])},wl.prototype.wr=function(t){return this.Hi.Oi("Write",t)},wl.prototype.onMessage=function(t){if(Fr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=(n=t.writeResults,r=t.commitTime,n&&0<n.length?(Fr(void 0!==r),n.map(function(t){return n=r,new ts(t=(t=(e=t).updateTime?ua(e.updateTime):ua(n)).isEqual(Gr.min())?ua(n):t,e.transformResults||[]);var e,n})):[]),n=ua(t.commitTime);return this.listener.Tr(n,e)}var r;return Fr(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},wl.prototype.Ar=function(){var t={};t.database=ya(this.R),this.cr(t)},wl.prototype.Er=function(t){var e=this,t={streamToken:this.lastStreamToken,writes:t.map(function(t){return wa(e.R,t)})};this.cr(t)},wl),yl=(n(vl,cl=function(){}),vl.prototype.br=function(){if(this.Rr)throw new Nr(Dr.FAILED_PRECONDITION,"The client has already been terminated.")},vl.prototype.Ni=function(e,n,r){var i=this;return this.br(),this.credentials.getToken().then(function(t){return i.Hi.Ni(e,n,r,t)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===Dr.UNAUTHENTICATED&&i.credentials.invalidateToken(),t):new Nr(Dr.UNKNOWN,t.toString())})},vl.prototype.$i=function(e,n,r){var i=this;return this.br(),this.credentials.getToken().then(function(t){return i.Hi.$i(e,n,r,t)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===Dr.UNAUTHENTICATED&&i.credentials.invalidateToken(),t):new Nr(Dr.UNKNOWN,t.toString())})},vl.prototype.terminate=function(){this.Rr=!0},vl),gl=(ml.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},ml.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,1<=this.vr&&(this.kr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},ml.prototype.set=function(t){this.kr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},ml.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},ml.prototype.Cr=function(t){t="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.",this.Vr?(Or(t),this.Vr=!1):xr("OnlineStateTracker",t)},ml.prototype.kr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},ml);function ml(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}function vl(t,e,n){var r=this;return(r=cl.call(this)||this).credentials=t,r.Hi=e,r.R=n,r.Rr=!1,r}function wl(t,e,n,r,i){var o=this;return(o=hl.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).R=r,o.gr=!1,o}function bl(t,e,n,r,i){var o=this;return(o=ll.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).R=r,o}function Tl(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new fl(t,e)}function El(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}function Il(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:if(!Rl(r))return[3,4];e=0,n=r.Mr,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function _l(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:e=0,n=r.Mr,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Sl(t,e){t.$r.has(e.targetId)||(t.$r.set(e.targetId,e),kl(t)?Cl(t):Ul(t).er()&&Dl(t,e))}function Al(t,e){var n=t,t=Ul(n);n.$r.delete(e),t.er()&&Nl(n,e),0===n.$r.size&&(t.er()?t.ir():Rl(n)&&n.Br.set("Unknown"))}function Dl(t,e){t.qr.U(e.targetId),Ul(t).mr(e)}function Nl(t,e){t.qr.U(e),Ul(t).yr(e)}function Cl(e){e.qr=new Xs({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},lt:function(t){return e.$r.get(t)||null}}),Ul(e).start(),e.Br.Sr()}function kl(t){return Rl(t)&&!Ul(t).tr()&&0<t.$r.size}function Rl(t){return 0===t.Or.size}function xl(t){t.qr=void 0}function Ol(n,r,i){return y(this,void 0,void 0,function(){var e=this;return g(this,function(t){switch(t.label){case 0:if(!hu(r))throw r;return n.Or.add(1),[4,_l(n)];case 1:return t.sent(),n.Br.set("Offline"),i=i||function(){return th(n.localStore)},n.asyncQueue.enqueueRetryable(function(){return y(e,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return xr("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return t.sent(),n.Or.delete(1),[4,Il(n)];case 2:return t.sent(),[2]}})})}),[2]}})})}function Ll(e,n){return n().catch(function(t){return Ol(e,t,n)})}function Pl(c){return y(this,void 0,void 0,function(){var o,s,a,u;return g(this,function(t){switch(t.label){case 0:s=ql(o=c),a=0<o.Fr.length?o.Fr[o.Fr.length-1].batchId:-1,t.label=1;case 1:if(!(Rl(o)&&o.Fr.length<10))return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,(n=o.localStore,r=a,(i=n).persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===r&&(r=-1),i._n.getNextMutationBatchAfterBatchId(t,r)}))];case 3:return null===(u=t.sent())?(0===o.Fr.length&&s.ir(),[3,7]):(a=u.batchId,e=u,(n=o).Fr.push(e),(n=ql(n)).er()&&n.pr&&n.Er(e.mutations),[3,6]);case 4:return u=t.sent(),[4,Ol(o,u)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return Ml(o)&&Fl(o),[2]}var e,n,r,i})})}function Ml(t){return Rl(t)&&!ql(t).tr()&&0<t.Fr.length}function Fl(t){ql(t).start()}function Vl(n,r){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=n,r?(e.Or.delete(2),[4,Il(e)]):[3,2];case 1:return t.sent(),[3,5];case 2:return r?[3,4]:(e.Or.add(2),[4,_l(e)]);case 3:t.sent(),e.Br.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})}function Ul(n){var t,e,r,i=this;return n.Ur||(n.Ur=(t=n.datastore,e=n.asyncQueue,r={Ii:function(n){return y(this,void 0,void 0,function(){return g(this,function(t){return n.$r.forEach(function(t,e){Dl(n,t)}),[2]})})}.bind(null,n),Ri:function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){return xl(e),kl(e)?(e.Br.Nr(n),Cl(e)):e.Br.set("Unknown"),[2]})})}.bind(null,n),_r:function(s,a,u){return y(this,void 0,void 0,function(){var n,o;return g(this,function(t){switch(t.label){case 0:if(s.Br.set("Online"),!(a instanceof Qs&&2===a.state&&a.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,function(o,s){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:e=s.cause,n=0,r=s.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],o.$r.has(i)?[4,o.remoteSyncer.rejectListen(i,e)]:[3,3]):[3,5];case 2:t.sent(),o.$r.delete(i),o.qr.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})}(s,a)];case 2:return t.sent(),[3,5];case 3:return n=t.sent(),xr("RemoteStore","Failed to remove targets %s: %s ",a.targetIds.join(","),n),[4,Ol(s,n)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(a instanceof Ks?s.qr.X(a):a instanceof Gs?s.qr.rt(a):s.qr.et(a),u.isEqual(Gr.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,th(s.localStore)];case 8:return o=t.sent(),0<=u.compareTo(o)?[4,((e=(r=s).qr.ut(i=u)).targetChanges.forEach(function(t,e){var n;0<t.resumeToken.approximateByteSize()&&(n=r.$r.get(e))&&r.$r.set(e,n.withResumeToken(t.resumeToken,i))}),e.targetMismatches.forEach(function(t){var e=r.$r.get(t);e&&(r.$r.set(t,e.withResumeToken(ni.EMPTY_BYTE_STRING,e.snapshotVersion)),Nl(r,t),e=new Iu(e.target,t,1,e.sequenceNumber),Dl(r,e))}),r.remoteSyncer.applyRemoteEvent(e))]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return xr("RemoteStore","Failed to raise snapshot:",o=t.sent()),[4,Ol(s,o)];case 12:return t.sent(),[3,13];case 13:return[2]}var r,i,e})})}.bind(null,n)},t.br(),new dl(e,t.Hi,t.credentials,t.R,r)),n.Mr.push(function(e){return y(i,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e?(n.Ur.sr(),kl(n)?Cl(n):n.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.Ur.stop()];case 2:t.sent(),xl(n),t.label=3;case 3:return[2]}})})})),n.Ur}function ql(n){var t,e,r,i=this;return n.Kr||(n.Kr=(t=n.datastore,e=n.asyncQueue,r={Ii:function(e){return y(this,void 0,void 0,function(){return g(this,function(t){return ql(e).Ar(),[2]})})}.bind(null,n),Ri:function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return n&&ql(e).pr?[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return Ss(n=i.code)&&n!==Dr.ABORTED?(e=r.Fr.shift(),ql(r).sr(),[4,Ll(r,function(){return r.remoteSyncer.rejectFailedWrite(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,Pl(r)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e,n)]:[3,2];case 1:t.sent(),t.label=2;case 2:return Ml(e)&&Fl(e),[2]}})})}.bind(null,n),Ir:function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){for(e=ql(o),n=0,r=o.Fr;n<r.length;n++)i=r[n],e.Er(i.mutations);return[2]})})}.bind(null,n),Tr:function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return e=r.Fr.shift(),n=Eu.from(e,i,o),[4,Ll(r,function(){return r.remoteSyncer.applySuccessfulWrite(n)})];case 1:return t.sent(),[4,Pl(r)];case 2:return t.sent(),[2]}})})}.bind(null,n)},t.br(),new pl(e,t.Hi,t.credentials,t.R,r)),n.Mr.push(function(e){return y(i,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e?(n.Kr.sr(),[4,Pl(n)]):[3,2];case 1:return t.sent(),[3,4];case 2:return[4,n.Kr.stop()];case 3:t.sent(),0<n.Fr.length&&(xr("RemoteStore","Stopping write stream with "+n.Fr.length+" pending writes"),n.Fr=[]),t.label=4;case 4:return[2]}})})})),n.Kr}var Bl=(jl.createAndSchedule=function(t,e,n,r,i){return(i=new jl(t,e,Date.now()+n,r,i)).start(n),i},jl.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},jl.prototype.skipDelay=function(){return this.handleDelayElapsed()},jl.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Nr(Dr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},jl.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})},jl.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},jl);function jl(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ya,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}function Kl(t,e){if(Or("AsyncQueue",e+": "+t),hu(t))return new Nr(Dr.UNAVAILABLE,e+": "+t);throw t}function Gl(){this.queries=new _c(ko,Co),this.onlineState="Unknown",this.Gr=new Set}var Ql=($l.emptySet=function(t){return new $l(t.comparator)},$l.prototype.has=function(t){return null!=this.keyedMap.get(t)},$l.prototype.get=function(t){return this.keyedMap.get(t)},$l.prototype.first=function(){return this.sortedSet.minKey()},$l.prototype.last=function(){return this.sortedSet.maxKey()},$l.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},$l.prototype.indexOf=function(t){return(t=this.keyedMap.get(t))?this.sortedSet.indexOf(t):-1},Object.defineProperty($l.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),$l.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(t,e){return n(t),!1})},$l.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},$l.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},$l.prototype.isEqual=function(t){if(!(t instanceof $l))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},$l.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},$l.prototype.copy=function(t,e){var n=new $l;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},$l),Hl=(Xl.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);!n||0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):Mr()},Xl.prototype.jr=function(){var n=[];return this.Qr.inorderTraversal(function(t,e){n.push(e)}),n},Xl),zl=(Yl.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new Yl(t,e,Ql.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(Yl.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),Yl.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Co(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},Yl),Wl=function(){this.Wr=void 0,this.listeners=[]};function Yl(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}function Xl(){this.Qr=new Ds(mi.comparator)}function $l(n){this.comparator=n?function(t,e){return n(t,e)||mi.comparator(t.key,e.key)}:function(t,e){return mi.comparator(t.key,e.key)},this.keyedMap=Us,this.sortedSet=new Ds(this.comparator)}function Jl(s,a){return y(this,void 0,void 0,function(){var e,n,r,i,o;return g(this,function(t){switch(t.label){case 0:if(e=s,n=a.query,r=!1,(i=e.queries.get(n))||(r=!0,i=new Wl),!r)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),o=i,[4,e.onListen(n)];case 2:return o.Wr=t.sent(),[3,4];case 3:return o=Kl(o=t.sent(),"Initialization of query '"+Ro(a.query)+"' failed"),[2,void a.onError(o)];case 4:return e.queries.set(n,i),i.listeners.push(a),a.zr(e.onlineState),i.Wr&&a.Hr(i.Wr)&&tf(e),[2]}})})}function Zl(s,a){return y(this,void 0,void 0,function(){var e,n,r,i,o;return g(this,function(t){return e=s,n=a.query,r=!1,(i=e.queries.get(n))&&0<=(o=i.listeners.indexOf(a))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?[2,(e.queries.delete(n),e.onUnlisten(n))]:[2]})})}function tf(t){t.Gr.forEach(function(t){t.next()})}var ef=(cf.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new zl(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},cf.prototype.onError=function(t){this.Jr.error(t)},cf.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},cf.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},cf.prototype.Zr=function(t){if(0<t.docChanges.length)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},cf.prototype.no=function(t){t=zl.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},cf),nf=(uf.prototype.io=function(){return"metadata"in this.payload},uf),rf=(af.prototype.qn=function(t){return fa(this.R,t)},af.prototype.Un=function(t){return t.metadata.exists?va(this.R,t.document,!1):Pi.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},af.prototype.Kn=ua,af),of=(sf.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},sf.prototype.co=function(t){for(var e=new Map,n=new rf(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||js()).add(s);e.set(c,h)}}return e},sf.prototype.complete=function(){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:return[4,function(l,f,d,p){return y(this,void 0,void 0,function(){var n,r,i,o,e,s,a,u,c,h;return g(this,function(t){switch(t.label){case 0:for(n=l,r=js(),i=Ms,o=qs,e=0,s=d;e<s.length;e++)a=s[e],u=f.qn(a.metadata.name),a.document&&(r=r.add(u)),i=i.insert(u,f.Un(a)),o=o.insert(u,f.Kn(a.metadata.readTime));return c=n.On.newChangeBuffer({trackRemovals:!0}),[4,nh(n,Do(bo(Jr.fromString("__bundle__/docs/"+p))))];case 1:return h=t.sent(),[2,n.persistence.runTransaction("Apply bundle documents","readwrite",function(e){return eh(e,c,i,Gr.min(),o).next(function(t){return c.apply(e),t}).next(function(t){return n.qe.removeMatchingKeysForTargetId(e,h.targetId).next(function(){return n.qe.addMatchingKeys(e,r,h.targetId)}).next(function(){return n.Mn.En(e,t)}).next(function(){return t})})})]}})})}(this.localStore,new rf(this.R),this.documents,this.ro.id)];case 1:e=t.sent(),n=this.co(this.documents),r=0,i=this.queries,t.label=2;case 2:return r<i.length?(i=i[r],[4,function(e,i,o){return void 0===o&&(o=js()),y(this,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return[4,nh(e,Do(Mu(i.bundledQuery)))];case 1:return n=t.sent(),[2,(r=e).persistence.runTransaction("Save named query","readwrite",function(t){var e=ua(i.readTime);return 0<=n.snapshotVersion.compareTo(e)?r.Ke.saveNamedQuery(t,i):(e=n.withResumeToken(ni.EMPTY_BYTE_STRING,e),r.kn=r.kn.insert(e.targetId,e),r.qe.updateTargetData(t,e).next(function(){return r.qe.removeMatchingKeysForTargetId(t,n.targetId)}).next(function(){return r.qe.addMatchingKeys(t,o,n.targetId)}).next(function(){return r.Ke.saveNamedQuery(t,i)}))})]}})})}(this.localStore,i,n.get(i.name))]):[3,5];case 3:t.sent(),t.label=4;case 4:return r++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Kc(Object.assign({},this.progress),e))]}})})},sf);function sf(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=hf(t)}function af(t){this.R=t}function uf(t,e){this.payload=t,this.byteLength=e}function cf(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}function hf(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}function lf(t,e,n){this.query=t,this.targetId=e,this.view=n}var ff=function(t){this.key=t},df=function(t){this.key=t},pf=(Object.defineProperty(vf.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),vf.prototype._o=function(t,e){var s=this,a=e?e.mo:new Hl,u=(e||this).fo,c=(e||this).mutatedKeys,h=u,l=!1,f=To(this.query)&&u.size===this.query.limit?u.last():null,d=Eo(this.query)&&u.size===this.query.limit?u.first():null;if(t.inorderTraversal(function(t,e){var n=u.get(t),r=xo(s.query,e)?e:null,i=!!n&&s.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||s.mutatedKeys.has(r.key)&&r.hasCommittedMutations),e=!1;n&&r?n.data.isEqual(r.data)?i!==o&&(a.track({type:3,doc:r}),e=!0):s.yo(n,r)||(a.track({type:2,doc:r}),e=!0,(f&&0<s.lo(r,f)||d&&s.lo(r,d)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),e=!0):n&&!r&&(a.track({type:1,doc:n}),e=!0,(f||d)&&(l=!0)),e&&(c=r?(h=h.add(r),o?c.add(t):c.delete(t)):(h=h.delete(t),c.delete(t)))}),To(this.query)||Eo(this.query))for(;h.size>this.query.limit;){var n=To(this.query)?h.last():h.first(),h=h.delete(n.key),c=c.delete(n.key);a.track({type:1,doc:n})}return{fo:h,mo:a,Nn:l,mutatedKeys:c}},vf.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},vf.prototype.applyChanges=function(t,e,n){var o=this,r=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var i=t.mo.jr();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.lo(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Mr()}}var r,i}),this.po(n);var s=e?this.Eo():[],e=(n=0===this.ho.size&&this.current?1:0)!==this.ao;return this.ao=n,0!==i.length||e?{snapshot:new zl(this.query,t.fo,r,i,t.mutatedKeys,0==n,e,!1),To:s}:{To:s}},vf.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Hl,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},vf.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},vf.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},vf.prototype.Eo=function(){var e=this;if(!this.current)return[];var n=this.ho;this.ho=js(),this.fo.forEach(function(t){e.Io(t.key)&&(e.ho=e.ho.add(t.key))});var r=[];return n.forEach(function(t){e.ho.has(t)||r.push(new df(t))}),this.ho.forEach(function(t){n.has(t)||r.push(new ff(t))}),r},vf.prototype.Ao=function(t){return this.uo=t.Bn,this.ho=js(),t=this._o(t.documents),this.applyChanges(t,!0)},vf.prototype.Ro=function(){return zl.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},vf),yf=function(t){this.key=t,this.bo=!1},gf=(Object.defineProperty(mf.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),mf);function mf(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new _c(ko,Co),this.Vo=new Map,this.So=new Set,this.Do=new Ds(mi.comparator),this.Co=new Map,this.No=new hh,this.xo={},this.ko=new Map,this.Fo=oc.Yt(),this.onlineState="Unknown",this.$o=void 0}function vf(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=js(),this.mutatedKeys=js(),this.lo=Oo(t),this.fo=new Ql(this.lo)}function wf(i,o,s,a){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return i.Oo=function(t,e,n){return function(r,i,o,s){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return(e=i.view._o(o)).Nn?[4,ih(r.localStore,i.query,!1).then(function(t){return t=t.documents,i.view._o(t,e)})]:[3,2];case 1:e=t.sent(),t.label=2;case 2:return n=s&&s.targetChanges.get(i.targetId),n=i.view.applyChanges(e,r.isPrimaryClient,n),[2,(Nf(r,i.targetId,n.To),n.snapshot)]}})})}(i,t,e,n)},[4,ih(i.localStore,o,!0)];case 1:return n=t.sent(),r=new pf(o,n.Bn),e=r._o(n.documents),n=Ws.createSynthesizedTargetChangeForCurrentChange(s,a&&"Offline"!==i.onlineState),n=r.applyChanges(e,i.isPrimaryClient,n),Nf(i,s,n.To),r=new lf(o,s,r),[2,(i.Po.set(o,r),i.Vo.has(s)?i.Vo.get(s).push(o):i.Vo.set(s,[o]),n.snapshot)]}})})}function bf(f,d,p){return y(this,void 0,void 0,function(){var s,l;return g(this,function(t){switch(t.label){case 0:l=Lf(f),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,(i=l.localStore,a=d,c=i,h=Kr.now(),o=a.reduce(function(t,e){return t.add(e.key)},js()),c.persistence.runTransaction("Locally write mutations","readwrite",function(s){return c.Mn.pn(s,o).next(function(t){u=t;for(var e=[],n=0,r=a;n<r.length;n++){var i=r[n],o=function(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field);null!=(s=Fo(o.transform,s||null))&&(n=null==n?xi.empty():n).set(o.field,s)}return n||null}(i,u.get(i.key));null!=o&&e.push(new ls(i.key,o,function s(t){var a=[];return Wr(t.fields,function(t,e){var n=new ti([t]);if(ki(e))if(0===(e=s(e.mapValue).fields).length)a.push(n);else for(var r=0,i=e;r<i.length;r++){var o=i[r];a.push(n.child(o))}else a.push(n)}),new ei(a)}(o.value.mapValue),ns.exists(!0)))}return c._n.addMutationBatch(s,h,e,a)})}).then(function(t){return t.applyToLocalDocumentSet(u),{batchId:t.batchId,changes:u}}))];case 2:return s=t.sent(),l.sharedClientState.addPendingMutation(s.batchId),e=l,n=s.batchId,r=p,i=(i=(i=e.xo[e.currentUser.toKey()])||new Ds(qr)).insert(n,r),e.xo[e.currentUser.toKey()]=i,[4,kf(l,s.changes)];case 3:return t.sent(),[4,Pl(l.remoteStore)];case 4:return t.sent(),[3,6];case 5:return l=Kl(l=t.sent(),"Failed to persist write"),p.reject(l),[3,6];case 6:return[2]}var e,n,r,i,a,u,c,h,o})})}function Tf(o,s){return y(this,void 0,void 0,function(){var n,i;return g(this,function(t){switch(t.label){case 0:n=o,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.localStore,u=e,c=(r=s).snapshotVersion,h=u.kn,u.persistence.runTransaction("Apply remote event","readwrite-primary",function(s){var t=u.On.newChangeBuffer({trackRemovals:!0});h=u.kn;var a=[];r.targetChanges.forEach(function(t,e){var n,r,i,o=h.get(e);o&&(a.push(u.qe.removeMatchingKeys(s,t.removedDocuments,e).next(function(){return u.qe.addMatchingKeys(s,t.addedDocuments,e)})),0<(i=t.resumeToken).approximateByteSize()&&(n=o.withResumeToken(i,c).withSequenceNumber(s.currentSequenceNumber),h=h.insert(e,n),r=o,i=t,Fr(0<(o=n).resumeToken.approximateByteSize()),(0===r.resumeToken.approximateByteSize()||3e8<=o.snapshotVersion.toMicroseconds()-r.snapshotVersion.toMicroseconds()||0<i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size)&&a.push(u.qe.updateTargetData(s,n))))});var e,n=Ms;return r.documentUpdates.forEach(function(t,e){r.resolvedLimboDocuments.has(t)&&a.push(u.persistence.referenceDelegate.updateLimboDocument(s,t))}),a.push(eh(s,t,r.documentUpdates,c,void 0).next(function(t){n=t})),c.isEqual(Gr.min())||(e=u.qe.getLastRemoteSnapshotVersion(s).next(function(t){return u.qe.setTargetsMetadata(s,s.currentSequenceNumber,c)}),a.push(e)),Za.waitFor(a).next(function(){return t.apply(s)}).next(function(){return u.Mn.En(s,n)}).next(function(){return n})}).then(function(t){return u.kn=h,t}))];case 2:return i=t.sent(),s.targetChanges.forEach(function(t,e){(e=n.Co.get(e))&&(Fr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),0<t.addedDocuments.size?e.bo=!0:0<t.modifiedDocuments.size?Fr(e.bo):0<t.removedDocuments.size&&(Fr(e.bo),e.bo=!1))}),[4,kf(n,i,s)];case 3:return t.sent(),[3,6];case 4:return[4,fc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,u,c,h})})}function Ef(t,n,e){var r;((t=t).isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e)&&(r=[],t.Po.forEach(function(t,e){(e=e.view.zr(n)).snapshot&&r.push(e.snapshot)}),function(t,i){t.onlineState=i;var o=!1;t.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].zr(i)&&(o=!0)}),o&&tf(t)}(t.eventManager,n),r.length&&t.vo._r(r),t.onlineState=n,t.isPrimaryClient&&t.sharedClientState.setOnlineState(n))}function If(o,s){return y(this,void 0,void 0,function(){var n,r,i;return g(this,function(t){switch(t.label){case 0:Rl((n=o).remoteStore)||xr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=n.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})];case 2:return-1===(r=t.sent())?[2,void s.resolve()]:((i=n.ko.get(r)||[]).push(s),n.ko.set(r,i),[3,4]);case 3:return i=Kl(i=t.sent(),"Initialization of waitForPendingWrites() operation failed"),s.reject(i),[3,4];case 4:return[2]}var e})})}function _f(t,e){(t.ko.get(e)||[]).forEach(function(t){t.resolve()}),t.ko.delete(e)}function Sf(t,e,n){var r=t,i=r.xo[r.currentUser.toKey()];i&&((t=i.get(e))&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i)}function Af(e,t,n){void 0===n&&(n=null),e.sharedClientState.removeLocalQueryTarget(t);for(var r=0,i=e.Vo.get(t);r<i.length;r++){var o=i[r];e.Po.delete(o),n&&e.vo.Mo(o,n)}e.Vo.delete(t),e.isPrimaryClient&&e.No.Zn(t).forEach(function(t){e.No.containsKey(t)||Df(e,t)})}function Df(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Al(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Cf(t))}function Nf(t,e,n){for(var r,i,o,s=0,a=n;s<a.length;s++){var u=a[s];u instanceof ff?(t.No.addReference(u.key,e),r=t,o=void 0,i=(o=u.key).path.canonicalString(),r.Do.get(o)||r.So.has(i)||(xr("SyncEngine","New document in limbo: "+o),r.So.add(i),Cf(r))):u instanceof df?(xr("SyncEngine","Document no longer in limbo: "+u.key),t.No.removeReference(u.key,e),t.No.containsKey(u.key)||Df(t,u.key)):Mr()}}function Cf(t){for(;0<t.So.size&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new mi(Jr.fromString(e)),e=t.Fo.next();t.Co.set(e,new yf(n)),t.Do=t.Do.insert(n,e),Sl(t.remoteStore,new Iu(Do(bo(n.path)),e,2,_r.o))}}function kf(e,s,a){return y(this,void 0,void 0,function(){var n,r,i,o;return g(this,function(t){switch(t.label){case 0:return r=[],i=[],o=[],(n=e).Po.isEmpty()?[3,3]:(n.Po.forEach(function(t,e){o.push(n.Oo(e,s,a).then(function(t){t&&(n.isPrimaryClient&&n.sharedClientState.updateQueryState(e.targetId,t.fromCache?"not-current":"current"),r.push(t),t=Qc.Pn(e.targetId,t),i.push(t))}))}),[4,Promise.all(o)]);case 1:return t.sent(),n.vo._r(r),[4,function(u,c){return y(this,void 0,void 0,function(){var r,e,n,i,o,s,a;return g(this,function(t){switch(t.label){case 0:r=u,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return Za.forEach(c,function(e){return Za.forEach(e.bn,function(t){return r.persistence.referenceDelegate.addReference(n,e.targetId,t)}).next(function(){return Za.forEach(e.vn,function(t){return r.persistence.referenceDelegate.removeReference(n,e.targetId,t)})})})})];case 2:return t.sent(),[3,4];case 3:if(!hu(e=t.sent()))throw e;return xr("LocalStore","Failed to update sequence numbers: "+e),[3,4];case 4:for(n=0,i=c;n<i.length;n++)a=i[n],o=a.targetId,a.fromCache||(s=r.kn.get(o),a=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(a),r.kn=r.kn.insert(o,a));return[2]}})})}(n.localStore,i)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}function Rf(d,p){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,c,h,l,f;return g(this,function(t){switch(t.label){case 0:e=d,n=[],r=[],i=0,o=p,t.label=1;case 1:return i<o.length?(s=o[i],a=void 0,(u=e.Vo.get(s))&&0!==u.length?[4,nh(e.localStore,Do(u[0]))]:[3,7]):[3,13];case 2:a=t.sent(),c=0,h=u,t.label=3;case 3:return c<h.length?(l=h[c],l=e.Po.get(l),[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,ih((e=r).localStore,i.query,!0)];case 1:return n=t.sent(),n=i.view.Ao(n),[2,(e.isPrimaryClient&&Nf(e,i.targetId,n.To),n)]}})})}(e,l)]):[3,6];case 4:(l=t.sent()).snapshot&&r.push(l.snapshot),t.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return[4,oh(e.localStore,s)];case 8:return f=t.sent(),[4,nh(e.localStore,f)];case 9:return a=t.sent(),[4,wf(e,xf(f),s,!1)];case 10:t.sent(),t.label=11;case 11:n.push(a),t.label=12;case 12:return i++,[3,1];case 13:return[2,(e.vo._r(r),n)]}})})}function xf(t){return wo(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Of(t){return t.remoteStore.remoteSyncer.applyRemoteEvent=Tf.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(t,e){var n=t;if((t=n.Co.get(e))&&t.bo)return js().add(t.key);var r=js();if(!(e=n.Vo.get(e)))return r;for(var i=0,o=e;i<o.length;i++)var s=o[i],s=n.Po.get(s),r=r.unionWith(s.view.wo);return r}.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=function(o,s,a){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:return(e=o).sharedClientState.updateQueryState(s,"rejected",a),i=e.Co.get(s),(n=i&&i.key)?(r=(r=new Ds(mi.comparator)).insert(n,Pi.newNoDocument(n,Gr.min())),i=js().add(n),i=new zs(Gr.min(),new Map,new Ls(qr),r,i),[4,Tf(e,i)]):[3,2];case 1:return t.sent(),e.Do=e.Do.remove(n),e.Co.delete(s),Cf(e),[3,4];case 2:return[4,rh(e.localStore,s,!1).then(function(){return Af(e,s,a)}).catch(fc)];case 3:t.sent(),t.label=4;case 4:return[2]}})})}.bind(null,t),t.vo._r=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query;if(a=n.queries.get(a)){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&tf(n)}.bind(null,t.eventManager),t.vo.Mo=function(t,e,n){var r=t;if(t=r.queries.get(e))for(var i=0,o=t.listeners;i<o.length;i++)o[i].onError(n);r.queries.delete(e)}.bind(null,t.eventManager),t}function Lf(t){return t.remoteStore.remoteSyncer.applySuccessfulWrite=function(o,s){return y(this,void 0,void 0,function(){var n,r,i;return g(this,function(t){switch(t.label){case 0:n=o,r=s.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.localStore,h=s,(l=e).persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r,e=h.batch.keys(),n=l.On.newChangeBuffer({trackRemovals:!0}),i=l,o=t,s=n,a=(r=h).batch,u=a.keys(),c=Za.resolve();return u.forEach(function(n){c=c.next(function(){return s.getEntry(o,n)}).next(function(t){var e=r.docVersions.get(n);Fr(null!==e),t.version.compareTo(e)<0&&(a.applyToRemoteDocument(t,r),t.isValidDocument()&&s.addEntry(t,r.commitVersion))})}),c.next(function(){return i._n.removeMutationBatch(o,a)}).next(function(){return n.apply(t)}).next(function(){return l._n.performConsistencyCheck(t)}).next(function(){return l.Mn.pn(t,e)})}))];case 2:return i=t.sent(),Sf(n,r,null),_f(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,kf(n,i)];case 3:return t.sent(),[3,6];case 4:return[4,fc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,h,l})})}.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=function(s,a,u){return y(this,void 0,void 0,function(){var n,o;return g(this,function(t){switch(t.label){case 0:n=s,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.localStore,r=a,(i=e).persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i._n.lookupMutationBatch(e,r).next(function(t){return Fr(null!==t),n=t.keys(),i._n.removeMutationBatch(e,t)}).next(function(){return i._n.performConsistencyCheck(e)}).next(function(){return i.Mn.pn(e,n)})}))];case 2:return o=t.sent(),Sf(n,a,u),_f(n,a),n.sharedClientState.updateMutationState(a,"rejected",u),[4,kf(n,o)];case 3:return t.sent(),[3,6];case 4:return[4,fc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,i})})}.bind(null,t),t}function Pf(t,e,n){var r=t;!function(f,d,p){return y(this,void 0,void 0,function(){var a,u,c,h,l;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,14,,15]),[4,d.getMetadata()];case 1:return a=t.sent(),[4,(r=f.localStore,o=r,s=ua((i=a).createTime),o.persistence.runTransaction("hasNewerBundle","readonly",function(t){return o.Ke.getBundleMetadata(t,i.id)}).then(function(t){return!!t&&0<=t.createTime.compareTo(s)}))];case 2:return t.sent()?[4,d.close()]:[3,4];case 3:return[2,(t.sent(),void p._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}))];case 4:return p._updateProgress(hf(a)),u=new of(a,f.localStore,d.R),[4,d.Lo()];case 5:c=t.sent(),t.label=6;case 6:return c?[4,u.oo(c)]:[3,10];case 7:return(h=t.sent())&&p._updateProgress(h),[4,d.Lo()];case 8:c=t.sent(),t.label=9;case 9:return[3,6];case 10:return[4,u.complete()];case 11:return l=t.sent(),[4,kf(f,l.wn,void 0)];case 12:return t.sent(),[4,(r=f.localStore,e=a,(n=r).persistence.runTransaction("Save bundle","readwrite",function(t){return n.Ke.saveBundleMetadata(t,e)}))];case 13:return t.sent(),p._completeWith(l.progress),[3,15];case 14:return Lr("SyncEngine","Loading bundle failed with "+(l=t.sent())),p._failWith(l),[3,15];case 15:return[2]}var e,n,r,i,o,s})})}(r,e,n).then(function(){r.sharedClientState.notifyBundleLoaded()})}var Mf,Ff,Vf=(Qf.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.R=al(e.databaseInfo.databaseId),this.sharedClientState=this.Bo(e),this.persistence=this.qo(e),[4,this.persistence.start()];case 1:return t.sent(),this.gcScheduler=this.Uo(e),this.localStore=this.Ko(e),[2]}})})},Qf.prototype.Uo=function(t){return null},Qf.prototype.Ko=function(t){return Jc(this.persistence,new Hc,t.initialUser,this.R)},Qf.prototype.qo=function(t){return new gh(vh.bs,this.R)},Qf.prototype.Bo=function(t){return new Bh},Qf.prototype.terminate=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},Qf),Uf=(n(Gf,Ff=Vf),Gf.prototype.initialize=function(n){return y(this,void 0,void 0,function(){var e=this;return g(this,function(t){switch(t.label){case 0:return[4,Ff.prototype.initialize.call(this,n)];case 1:return t.sent(),[4,function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){return[2,(e=n).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return t=xc(t),r=Gr.min(),t.$t({index:qa.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r=ku(e.readTime)),n.done()}).next(function(){return r});var r}).then(function(t){e.$n=t})]})})}(this.localStore)];case 2:return t.sent(),[4,this.Qo.initialize(this,n)];case 3:return t.sent(),[4,Lf(this.Qo.syncEngine)];case 4:return t.sent(),[4,Pl(this.Qo.remoteStore)];case 5:return t.sent(),[4,this.persistence.He(function(){return e.gcScheduler&&!e.gcScheduler.started&&e.gcScheduler.start(e.localStore),Promise.resolve()})];case 6:return t.sent(),[2]}})})},Gf.prototype.Ko=function(t){return Jc(this.persistence,new Hc,t.initialUser,this.R)},Gf.prototype.Uo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new yc(e,t.asyncQueue)},Gf.prototype.qo=function(t){var e=jc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Yu.withCacheSize(this.cacheSizeBytes):Yu.DEFAULT;return new Vc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,ol(),sl(),this.R,this.sharedClientState,!!this.forceOwnership)},Gf.prototype.Bo=function(t){return new Bh},Gf),qf=(n(Kf,Mf=Uf),Kf.prototype.initialize=function(r){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:return[4,Mf.prototype.initialize.call(this,r)];case 1:return t.sent(),e=this.Qo.syncEngine,this.sharedClientState instanceof qh?(this.sharedClientState.syncEngine={ui:function(a,u,c,h){return y(this,void 0,void 0,function(){var o,s;return g(this,function(t){switch(t.label){case 0:return[4,(e=(o=a).localStore,n=u,i=(r=e)._n,r.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return i.jt(e,n).next(function(t){return t?r.Mn.pn(e,t):Za.resolve(null)})}))];case 1:return null===(s=t.sent())?[3,6]:"pending"!==c?[3,3]:[4,Pl(o.remoteStore)];case 2:return t.sent(),[3,4];case 3:"acknowledged"===c||"rejected"===c?(Sf(o,u,h||null),_f(o,u),o.localStore._n.Gt(u)):Mr(),t.label=4;case 4:return[4,kf(o,s)];case 5:return t.sent(),[3,7];case 6:xr("SyncEngine","Cannot apply mutation batch with id: "+u),t.label=7;case 7:return[2]}var e,n,r,i})})}.bind(null,e),ai:function(i,o,s,a){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return(e=i).$o?(xr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!e.Vo.has(o))return[3,8];switch(s){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,sh(e.localStore)];case 3:return n=t.sent(),r=zs.createSynthesizedRemoteEventForCurrentChange(o,"current"===s),[4,kf(e,n,r)];case 4:return t.sent(),[3,8];case 5:return[4,rh(e.localStore,o,!0)];case 6:return t.sent(),Af(e,o,a),[3,8];case 7:Mr(),t.label=8;case 8:return[2]}})})}.bind(null,e),hi:function(c,h,l){return y(this,void 0,void 0,function(){var n,e,r,i,o,s,a,u;return g(this,function(t){switch(t.label){case 0:if(!(n=Of(c)).$o)return[3,10];e=0,r=h,t.label=1;case 1:return e<r.length?(r=r[e],n.Vo.has(r)?(xr("SyncEngine","Adding an already active target "+r),[3,5]):[4,oh(n.localStore,r)]):[3,6];case 2:return i=t.sent(),[4,nh(n.localStore,i)];case 3:return o=t.sent(),[4,wf(n,xf(i),o.targetId,!1)];case 4:t.sent(),Sl(n.remoteStore,o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return g(this,function(t){switch(t.label){case 0:return n.Vo.has(e)?[4,rh(n.localStore,e,!1).then(function(){Al(n.remoteStore,e),Af(n,e)}).catch(fc)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},a=0,u=l,t.label=7;case 7:return a<u.length?(u=u[a],[5,s(u)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})}.bind(null,e),fn:function(t){return t.localStore.persistence.fn()}.bind(null,e),ci:function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){return[2,sh((e=n).localStore).then(function(t){return kf(e,t)})]})})}.bind(null,e)},[4,this.sharedClientState.start()]):[3,3];case 2:t.sent(),t.label=3;case 3:return[4,this.persistence.He(function(e){return y(n,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,function(h,l){return y(this,void 0,void 0,function(){var r,e,i,o,s,a,u,c;return g(this,function(t){switch(t.label){case 0:return Of(r=h),Lf(r),!0!==l||!0===r.$o?[3,3]:(e=r.sharedClientState.getAllActiveQueryTargets(),[4,Rf(r,e.toArray())]);case 1:return i=t.sent(),r.$o=!0,[4,Vl(r.remoteStore,!0)];case 2:for(t.sent(),o=0,s=i;o<s.length;o++)a=s[o],Sl(r.remoteStore,a);return[3,7];case 3:return!1!==l||!1===r.$o?[3,7]:(u=[],c=Promise.resolve(),r.Vo.forEach(function(t,e){r.sharedClientState.isLocalQueryTarget(e)?u.push(e):c=c.then(function(){return Af(r,e),rh(r.localStore,e,!0)}),Al(r.remoteStore,e)}),[4,c]);case 4:return t.sent(),[4,Rf(r,u)];case 5:return t.sent(),(n=r).Co.forEach(function(t,e){Al(n.remoteStore,e)}),n.No.ts(),n.Co=new Map,n.Do=new Ds(mi.comparator),r.$o=!1,[4,Vl(r.remoteStore,!1)];case 6:t.sent(),t.label=7;case 7:return[2]}var n})})}(this.Qo.syncEngine,e)];case 1:return t.sent(),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):e||this.gcScheduler.stop()),[2]}})})})];case 4:return t.sent(),[2]}})})},Kf.prototype.Bo=function(t){var e=ol();if(!qh.yt(e))throw new Nr(Dr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=jc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new qh(e,t.asyncQueue,n,t.clientId,t.initialUser)},Kf),Bf=(jf.prototype.initialize=function(n,r){return y(this,void 0,void 0,function(){var e=this;return g(this,function(t){switch(t.label){case 0:return this.localStore?[3,2]:(this.localStore=n.localStore,this.sharedClientState=n.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!n.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Ef(e.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=function(i,o){return y(this,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return(n=i).currentUser.isEqual(o)?[3,3]:(xr("SyncEngine","User change. New user:",o.toKey()),[4,Zc(n.localStore,o)]);case 1:return r=t.sent(),n.currentUser=o,(e=n).ko.forEach(function(t){t.forEach(function(t){t.reject(new Nr(Dr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.ko.clear(),n.sharedClientState.handleUserChange(o,r.removedBatchIds,r.addedBatchIds),[4,kf(n,r.Ln)];case 2:t.sent(),t.label=3;case 3:return[2]}var e})})}.bind(null,this.syncEngine),[4,Vl(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},jf.prototype.createEventManager=function(t){return new Gl},jf.prototype.createDatastore=function(t){var e=al(t.databaseInfo.databaseId),n=(n=t.databaseInfo,new Hh(n));return t=t.credentials,new yl(t,n,e)},jf.prototype.createRemoteStore=function(t){var e=this;return new ul(this.localStore,this.datastore,t.asyncQueue,function(t){return Ef(e.syncEngine,t,0)},t=new(Kh.yt()?Kh:jh))},jf.prototype.createSyncEngine=function(t,e){return n=this.localStore,r=this.remoteStore,i=this.eventManager,o=this.sharedClientState,s=t.initialUser,t=t.maxConcurrentLimboResolutions,e=e,t=new gf(n,r,i,o,s,t),e&&(t.$o=!0),t;var n,r,i,o,s},jf.prototype.terminate=function(){return function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=n,xr("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,_l(e)];case 1:return t.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},jf);function jf(){}function Kf(t,e){var n=this;return(n=Mf.call(this,t,e,!1)||this).Qo=t,n.cacheSizeBytes=e,n.synchronizeTabs=!0,n}function Gf(t,e,n){var r=this;return(r=Ff.call(this)||this).Qo=t,r.cacheSizeBytes=e,r.forceOwnership=n,r.synchronizeTabs=!1,r}function Qf(){this.synchronizeTabs=!1}function Hf(n,r){void 0===r&&(r=10240);var i=0;return{read:function(){return y(this,void 0,void 0,function(){var e;return g(this,function(t){return i<n.byteLength?(e={value:n.slice(i,i+r),done:!1},[2,(i+=r,e)]):[2,{done:!0}]})})},cancel:function(){return y(this,void 0,void 0,function(){return g(this,function(t){return[2]})})},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var zf=(nd.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},nd.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},nd.prototype.Wo=function(){this.muted=!0},nd.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},nd),Wf=(ed.prototype.close=function(){return this.Go.cancel()},ed.prototype.getMetadata=function(){return y(this,void 0,void 0,function(){return g(this,function(t){return[2,this.metadata.promise]})})},ed.prototype.Lo=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},ed.prototype.Ho=function(){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return[4,this.Jo()];case 1:return null===(e=t.sent())?[2,null]:(r=this.zo.decode(e),n=Number(r),isNaN(n)&&this.Yo("length string ("+r+") is not valid number"),[4,this.Xo(n)]);case 2:return r=t.sent(),[2,new nf(JSON.parse(r),e.length+n)]}})})},ed.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},ed.prototype.Jo=function(){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(t.sent())return[3,3];t.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((e=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,e),[2,(this.buffer=this.buffer.slice(e),n)])}})})},ed.prototype.Xo=function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return this.buffer.length<n?[4,this.tc()]:[3,3];case 1:t.sent()&&this.Yo("Reached the end of bundle when more is expected."),t.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,n)),[2,(this.buffer=this.buffer.slice(n),e)]}})})},ed.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},ed.prototype.tc=function(){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,this.Go.read()];case 1:return(e=t.sent()).done||((n=new Uint8Array(this.buffer.length+e.value.length)).set(this.buffer),n.set(e.value,this.buffer.length),this.buffer=n),[2,e.done]}})})},ed),Yf=(td.prototype.lookup=function(r){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Nr(Dr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,a){return y(this,void 0,void 0,function(){var r,e,n,i,o;return g(this,function(t){switch(t.label){case 0:return e=ya((r=s).R)+"/documents",n={documents:a.map(function(t){return la(r.R,t)})},[4,r.$i("BatchGetDocuments",e,n)];case 1:return n=t.sent(),i=new Map,n.forEach(function(t){var e,n,t=(n=r.R,"found"in t?function(t,e){Fr(!!e.found),e.found.name,e.found.updateTime;var n=fa(t,e.found.name),t=ua(e.found.updateTime),e=new xi({mapValue:{fields:e.found.fields}});return Pi.newFoundDocument(n,t,e)}(n,t):"missing"in t?(e=n,Fr(!!(n=t).missing),Fr(!!n.readTime),e=fa(e,n.missing),n=ua(n.readTime),Pi.newNoDocument(e,n)):Mr());i.set(t.key.toString(),t)}),o=[],[2,(a.forEach(function(t){Fr(!!(t=i.get(t.toString()))),o.push(t)}),o)]}})})}(this.datastore,r)];case 1:return[2,((e=t.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},td.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},td.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},td.prototype.delete=function(t){this.write(new Ts(t,this.precondition(t))),this.writtenDocs.add(t.toString())},td.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return e=this.readVersions,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){e=mi.fromPath(e),n.mutations.push(new Es(e,n.precondition(e)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return n=ya((e=i).R)+"/documents",r={writes:o.map(function(t){return wa(e.R,t)})},[4,e.Ni("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return t.sent(),this.committed=!0,[2]}})})},td.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Mr();e=Gr.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Nr(Dr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},td.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?ns.updateTime(e):ns.none()},td.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(this.writtenDocs.has(t.toString())||!e)return ns.exists(!0);if(e.isEqual(Gr.min()))throw new Nr(Dr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ns.updateTime(e)},td.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},td.prototype.ensureCommitNotCalled=function(){},td),Xf=(Zf.prototype.run=function(){--this.ec,this.nc()},Zf.prototype.nc=function(){var t=this;this.Zi.ji(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return g(this,function(t){return e=new Yf(this.datastore),(n=this.sc(e))&&n.then(function(t){r.asyncQueue.enqueueAndForget(function(){return e.commit().then(function(){r.deferred.resolve(t)}).catch(function(t){r.ic(t)})})}).catch(function(t){r.ic(t)}),[2]})})})},Zf.prototype.sc=function(t){try{var e=this.updateFunction(t);return!pi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},Zf.prototype.ic=function(t){var e=this;0<this.ec&&this.rc(t)?(--this.ec,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},Zf.prototype.rc=function(t){return"FirebaseError"===t.name&&("aborted"===(t=t.code)||"failed-precondition"===t||!Ss(t))},Zf),$f=(Jf.prototype.getConfiguration=function(){return y(this,void 0,void 0,function(){return g(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},Jf.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},Jf.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Nr(Dr.FAILED_PRECONDITION,"The client has already been terminated.")},Jf.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var n=new Ya;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:t.sent(),t.label=4;case 4:return this.credentials.removeChangeListener(),n.resolve(),[3,6];case 5:return e=Kl(t.sent(),"Failed to shutdown persistence"),n.reject(e),[3,6];case 6:return[2]}})})}),n.promise},Jf);function Jf(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=wh.UNAUTHENTICATED,this.clientId=Vr.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,function(e){return y(r,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return xr("FirestoreClient","Received user=",e.uid),[4,this.credentialListener(e)];case 1:return t.sent(),this.user=e,[2]}})})})}function Zf(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new fl(this.asyncQueue,"transaction_retry")}function td(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}function ed(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new Ya,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}function nd(t){this.observer=t,this.muted=!1}function rd(i,o){return y(this,void 0,void 0,function(){var e,n,r=this;return g(this,function(t){switch(t.label){case 0:return i.asyncQueue.verifyOperationInProgress(),xr("FirestoreClient","Initializing OfflineComponentProvider"),[4,i.getConfiguration()];case 1:return e=t.sent(),[4,o.initialize(e)];case 2:return t.sent(),n=e.initialUser,i.setCredentialChangeListener(function(e){return y(r,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return n.isEqual(e)?[3,2]:[4,Zc(o.localStore,e)];case 1:t.sent(),n=e,t.label=2;case 2:return[2]}})})}),o.persistence.setDatabaseDeletedListener(function(){return i.terminate()}),i.offlineComponents=o,[2]}})})}function id(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return r.asyncQueue.verifyOperationInProgress(),[4,od(r)];case 1:return e=t.sent(),xr("FirestoreClient","Initializing OnlineComponentProvider"),[4,r.getConfiguration()];case 2:return n=t.sent(),[4,i.initialize(e,n)];case 3:return t.sent(),r.setCredentialChangeListener(function(t){return function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return(e=r).asyncQueue.verifyOperationInProgress(),xr("RemoteStore","RemoteStore received new credentials"),n=Rl(e),e.Or.add(3),[4,_l(e)];case 1:return t.sent(),n&&e.Br.set("Unknown"),[4,e.remoteSyncer.handleCredentialChange(i)];case 2:return t.sent(),e.Or.delete(3),[4,Il(e)];case 3:return t.sent(),[2]}})})}(i.remoteStore,t)}),r.onlineComponents=i,[2]}})})}function od(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e.offlineComponents?[3,2]:(xr("FirestoreClient","Using default OfflineComponentProvider"),[4,rd(e,new Vf)]);case 1:t.sent(),t.label=2;case 2:return[2,e.offlineComponents]}})})}function sd(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e.onlineComponents?[3,2]:(xr("FirestoreClient","Using default OnlineComponentProvider"),[4,id(e,new Bf)]);case 1:t.sent(),t.label=2;case 2:return[2,e.onlineComponents]}})})}function ad(t){return od(t).then(function(t){return t.persistence})}function ud(t){return od(t).then(function(t){return t.localStore})}function cd(t){return sd(t).then(function(t){return t.remoteStore})}function hd(t){return sd(t).then(function(t){return t.syncEngine})}function ld(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,sd(r)];case 1:return e=t.sent(),[2,((n=e.eventManager).onListen=function(s,a){return y(this,void 0,void 0,function(){var e,n,r,i,o;return g(this,function(t){switch(t.label){case 0:return e=Of(s),(o=e.Po.get(a))?(n=o.targetId,e.sharedClientState.addLocalQueryTarget(n),r=o.view.Ro(),[3,4]):[3,1];case 1:return[4,nh(e.localStore,Do(a))];case 2:return i=t.sent(),o=e.sharedClientState.addLocalQueryTarget(i.targetId),n=i.targetId,[4,wf(e,a,n,"current"===o)];case 3:r=t.sent(),e.isPrimaryClient&&Sl(e.remoteStore,i),t.label=4;case 4:return[2,r]}})})}.bind(null,e.syncEngine),n.onUnlisten=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return n=(e=i).Po.get(o),1<(r=e.Vo.get(n.targetId)).length?[2,(e.Vo.set(n.targetId,r.filter(function(t){return!Co(t,o)})),void e.Po.delete(o))]:e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)?[3,2]:[4,rh(e.localStore,n.targetId,!1).then(function(){e.sharedClientState.clearQueryState(n.targetId),Al(e.remoteStore,n.targetId),Af(e,n.targetId)}).catch(fc)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return Af(e,n.targetId),[4,rh(e.localStore,n.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})}.bind(null,e.syncEngine),n)]}})})}function fd(n,r,i){var t=this;void 0===i&&(i={});var o=new Ya;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(n,r,i,o,s){var t=new zf({next:function(t){r.enqueueAndForget(function(){return Zl(n,a)});var e=t.docs.has(i);!e&&t.fromCache?s.reject(new Nr(Dr.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&o&&"server"===o.source?s.reject(new Nr(Dr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(t)},error:function(t){return s.reject(t)}}),a=new ef(bo(i.path),t,{includeMetadataChanges:!0,so:!0});return Jl(n,a)},[4,ld(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.asyncQueue,r,i,o])]}})})}),o.promise}function dd(n,r,i){var t=this;void 0===i&&(i={});var o=new Ya;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(e,n,t,r,i){var o=new zf({next:function(t){n.enqueueAndForget(function(){return Zl(e,s)}),t.fromCache&&"server"===r.source?i.reject(new Nr(Dr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),s=new ef(t,o,{includeMetadataChanges:!0,so:!0});return Jl(e,s)},[4,ld(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.asyncQueue,r,i,o])]}})})}),o.promise}function pd(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t}function yd(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a}var gd=(Object.defineProperty(Nd.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),Nd.prototype.isEqual=function(t){return t instanceof Nd&&t.projectId===this.projectId&&t.database===this.database},Nd),md=new Map,vd=(Dd.prototype.getToken=function(){return Promise.resolve(null)},Dd.prototype.invalidateToken=function(){},Dd.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e(wh.UNAUTHENTICATED)})},Dd.prototype.removeChangeListener=function(){this.changeListener=null},Dd),wd=(Ad.prototype.getToken=function(){return Promise.resolve(this.token)},Ad.prototype.invalidateToken=function(){},Ad.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},Ad.prototype.removeChangeListener=function(){this.changeListener=null},Ad),bd=(Sd.prototype.getToken=function(){var e=this,n=this.cc,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.cc!==n?(xr("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(Fr("string"==typeof t.accessToken),new pd(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},Sd.prototype.invalidateToken=function(){this.forceRefresh=!0},Sd.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return y(n,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}})})})},Sd.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},Sd.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return Fr(null===t||"string"==typeof t),new wh(t)},Sd),Td=(Object.defineProperty(_d.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),_d),Ed=(Id.prototype.getToken=function(){return Promise.resolve(new Td(this.hc,this.lc,this.fc))},Id.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e(wh.FIRST_PARTY)})},Id.prototype.removeChangeListener=function(){},Id.prototype.invalidateToken=function(){},Id);function Id(t,e,n){this.hc=t,this.lc=e,this.fc=n}function _d(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=wh.FIRST_PARTY}function Sd(e){var n=this;function r(t){xr("FirebaseCredentialsProvider","Auth detected"),n.auth=t,n.auth.addAuthTokenListener(n.uc)}this.currentUser=wh.UNAUTHENTICATED,this.oc=new Ya,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){n.cc++,n.currentUser=n.ac(),n.oc.resolve(),n.changeListener&&n.asyncQueue.enqueueRetryable(function(){return n.changeListener(n.currentUser)})},e.onInit(r),setTimeout(function(){var t;n.auth||((t=e.getImmediate({optional:!0}))?r(t):(xr("FirebaseCredentialsProvider","Auth not yet detected"),n.oc.resolve()))},0)}function Ad(t){this.token=t,this.changeListener=null}function Dd(){this.changeListener=null}function Nd(t,e){this.projectId=t,this.database=e||"(default)"}function Cd(t,e,n){if(!n)throw new Nr(Dr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function kd(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Nr(Dr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Rd(t,e,n,r){if(!0===e&&!0===r)throw new Nr(Dr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function xd(t){if(!mi.isDocumentKey(t))throw new Nr(Dr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Od(t){if(mi.isDocumentKey(t))throw new Nr(Dr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Ld(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Mr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function Pd(t,e){if((t="_delegate"in t?t._delegate:t)instanceof e)return t;if(e.name===t.constructor.name)throw new Nr(Dr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");throw t=Ld(t),new Nr(Dr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+t)}function Md(t,e){if(e<=0)throw new Nr(Dr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Fd,Vd=(zd.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},zd),Ud=(Object.defineProperty(Hd.prototype,"app",{get:function(){if(!this._app)throw new Nr(Dr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(Hd.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(Hd.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),Hd.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Nr(Dr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Vd(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new vd;switch(t.type){case"gapi":var e=t.client;return Fr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Ed(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Nr(Dr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},Hd.prototype._getSettings=function(){return this._settings},Hd.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},Hd.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},Hd.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},Hd.prototype._terminate=function(){return(t=md.get(this))&&(xr("ComponentProvider","Removing Datastore"),md.delete(this),t.terminate()),Promise.resolve();var t},Hd),qd=(Object.defineProperty(Qd.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(Qd.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(Qd.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(Qd.prototype,"parent",{get:function(){return new jd(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),Qd.prototype.withConverter=function(t){return new Qd(this.firestore,t,this._key)},Qd),Bd=(Gd.prototype.withConverter=function(t){return new Gd(this.firestore,t,this._query)},Gd),jd=(n(Kd,Fd=Bd),Object.defineProperty(Kd.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(Kd.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(Kd.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new qd(this.firestore,null,new mi(t))},enumerable:!1,configurable:!0}),Kd.prototype.withConverter=function(t){return new Kd(this.firestore,t,this._path)},Kd);function Kd(t,e,n){var r=this;return(r=Fd.call(this,t,e,bo(n))||this)._path=n,r.type="collection",r}function Gd(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}function Qd(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}function Hd(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Vd({}),this._settingsFrozen=!1,t instanceof gd?(this._databaseId=t,this._credentials=new vd):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Nr(Dr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new gd(t.options.projectId)}(t),this._credentials=new bd(e))}function zd(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Nr(Dr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Nr(Dr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Rd("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}function Wd(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=w(t),Cd("collection","path",e),t instanceof Ud)return Od(n=Jr.fromString.apply(Jr,s([e],r))),new jd(t,null,n);if(!(t instanceof qd||t instanceof jd))throw new Nr(Dr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Od(n=Jr.fromString.apply(Jr,s([t.path],r)).child(Jr.fromString(e))),new jd(t.firestore,null,n)}function Yd(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=w(t),Cd("doc","path",e=1===arguments.length?Vr.u():e),t instanceof Ud)return xd(n=Jr.fromString.apply(Jr,s([e],r))),new qd(t,null,new mi(n));if(!(t instanceof qd||t instanceof jd))throw new Nr(Dr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return xd(n=t._path.child(Jr.fromString.apply(Jr,s([e],r)))),new qd(t.firestore,t instanceof jd?t.converter:null,new mi(n))}function Xd(t,e){return t=w(t),e=w(e),(t instanceof qd||t instanceof jd)&&(e instanceof qd||e instanceof jd)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function $d(t,e){return t=w(t),e=w(e),t instanceof Bd&&e instanceof Bd&&t.firestore===e.firestore&&Co(t._query,e._query)&&t.converter===e.converter}var Jd=(Object.defineProperty(Zd.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),Zd.prototype.enqueueAndForget=function(t){this.enqueue(t)},Zd.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},Zd.prototype.enterRestrictedMode=function(t){this._c||(this._c=!0,this.Ec=t||!1,(t=sl())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ic))},Zd.prototype.enqueue=function(t){var e=this;if(this.Ac(),this._c)return new Promise(function(){});var n=new Ya;return this.Rc(function(){return e._c&&e.Ec?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)}).then(function(){return n.promise})},Zd.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.wc.push(t),e.bc()})},Zd.prototype.bc=function(){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(0===this.wc.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return t.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!hu(e=t.sent()))throw e;return xr("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.wc.length&&this.Zi.ji(function(){return n.bc()}),t.label=5;case 5:return[2]}})})},Zd.prototype.Rc=function(t){var r=this,e=this.dc.then(function(){return r.gc=!0,t().catch(function(t){throw r.yc=t,r.gc=!1,Or("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",n=e.stack?e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack:n)),t;var e,n}).then(function(t){return r.gc=!1,t})});return this.dc=e},Zd.prototype.enqueueAfterDelay=function(t,e,n){var r=this;return this.Ac(),-1<this.Tc.indexOf(t)&&(e=0),n=Bl.createAndSchedule(this,t,e,n,function(t){return r.vc(t)}),this.mc.push(n),n},Zd.prototype.Ac=function(){this.yc&&Mr()},Zd.prototype.verifyOperationInProgress=function(){},Zd.prototype.Pc=function(){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return[4,e=this.dc];case 1:t.sent(),t.label=2;case 2:if(e!==this.dc)return[3,0];t.label=3;case 3:return[2]}})})},Zd.prototype.Vc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},Zd.prototype.Sc=function(r){var i=this;return this.Pc().then(function(){i.mc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var t=0,e=i.mc;t<e.length;t++){var n=e[t];if(n.skipDelay(),"all"!==r&&n.timerId===r)break}return i.Pc()})},Zd.prototype.Dc=function(t){this.Tc.push(t)},Zd.prototype.vc=function(t){t=this.mc.indexOf(t),this.mc.splice(t,1)},Zd);function Zd(){var e=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new fl(this,"async_queue_retry"),this.Ic=function(){var t=sl();t&&xr("AsyncQueue","Visibility state changed to "+t.visibilityState),e.Zi.Gi()};var t=sl();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Ic)}function tp(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var ep,np=(op.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},op.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},op.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},op.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},op.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},op.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)},op),rp=(n(ip,ep=Ud),ip.prototype._terminate=function(){return this._firestoreClient||ap(this),this._firestoreClient.terminate()},ip);function ip(t,e){var n=this;return(n=ep.call(this,t,e)||this).type="firestore",n._queue=new Jd,n._persistenceKey="name"in t?t.name:"[DEFAULT]",n}function op(){this._progressObserver={},this._taskCompletionResolver=new Ya,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}function sp(t){return t._firestoreClient||ap(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function ap(t){var e,n,r,i=t._freezeSettings(),i=(e=t._databaseId,n=(null===(r=t._app)||void 0===r?void 0:r.options.appId)||"",r=t._persistenceKey,new yd(e,n,r,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams));t._firestoreClient=new $f(t._credentials,t._queue,i)}function up(n,r,i){var t=this,o=new Ya;return n.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,rd(n,i)];case 1:return t.sent(),[4,id(n,r)];case 2:return t.sent(),o.resolve(),[3,4];case 3:if(!("FirebaseError"===(e=t.sent()).name?e.code===Dr.FAILED_PRECONDITION||e.code===Dr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code))throw e;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),o.reject(e),[3,4];case 4:return[2]}})})}).then(function(){return o.promise})}function cp(t){if(t._initialized||t._terminated)throw new Nr(Dr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var hp=(Tp.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},Tp),lp=(bp.fromBase64String=function(t){try{return new bp(ni.fromBase64String(t))}catch(t){throw new Nr(Dr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}},bp.fromUint8Array=function(t){return new bp(ni.fromUint8Array(t))},bp.prototype.toBase64=function(){return this._byteString.toBase64()},bp.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},bp.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},bp.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},bp),fp=function(t){this._methodName=t},dp=(Object.defineProperty(wp.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(wp.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),wp.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},wp.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},wp.prototype._compareTo=function(t){return qr(this._lat,t._lat)||qr(this._long,t._long)},wp),pp=/^__.*__$/,yp=(vp.prototype.toMutation=function(t,e){return null!==this.fieldMask?new ls(t,this.data,this.fieldMask,e,this.fieldTransforms):new hs(t,this.data,e,this.fieldTransforms)},vp),gp=(mp.prototype.toMutation=function(t,e){return new ls(t,this.data,this.fieldMask,e,this.fieldTransforms)},mp);function mp(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function vp(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function wp(t,e){if(!isFinite(t)||t<-90||90<t)throw new Nr(Dr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Nr(Dr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}function bp(t){this._byteString=t}function Tp(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Nr(Dr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ti(t)}function Ep(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Mr()}}var Ip=(Object.defineProperty(Ap.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(Ap.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),Ap.prototype.xc=function(t){return new Ap(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},Ap.prototype.kc=function(t){var e=null===(e=this.path)||void 0===e?void 0:e.child(t);return(e=this.xc({path:e,Fc:!1})).$c(t),e},Ap.prototype.Oc=function(t){var e,t=null===(e=this.path)||void 0===e?void 0:e.child(t);return(t=this.xc({path:t,Fc:!1})).Cc(),t},Ap.prototype.Mc=function(t){return this.xc({path:void 0,Fc:!0})},Ap.prototype.Lc=function(t){return ey(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},Ap.prototype.contains=function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})},Ap.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},Ap.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(Ep(this.Nc)&&pp.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},Ap),_p=(Sp.prototype.Uc=function(t,e,n,r){return void 0===r&&(r=!1),new Ip({Nc:t,methodName:e,qc:n,path:ti.emptyPath(),Fc:!1,Bc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},Sp);function Sp(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||al(t)}function Ap(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Cc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}function Dp(t){var e=t._freezeSettings(),n=al(t._databaseId);return new _p(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Np(t,e,n,r,i,o){var s=t.Uc((o=void 0===o?{}:o).merge||o.mergeFields?2:0,e,n,i);$p("Data must be an object, but it was:",s,r);var a,u,r=Yp(r,s);if(o.merge)a=new ei(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var c=[],h=0,l=o.mergeFields;h<l.length;h++){var f=Jp(e,l[h],n);if(!s.contains(f))throw new Nr(Dr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");ny(c,f)||c.push(f)}a=new ei(c),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new yp(new xi(r),a,u)}var Cp,kp=(n(Rp,Cp=fp),Rp.prototype._toFieldTransform=function(t){if(2!==t.Nc)throw 1===t.Nc?t.Lc(this._methodName+"() can only appear at the top level of your update data"):t.Lc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},Rp.prototype.isEqual=function(t){return t instanceof Rp},Rp);function Rp(){return null!==Cp&&Cp.apply(this,arguments)||this}function xp(t,e,n){return new Ip({Nc:3,qc:e.settings.qc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var Op,Lp,Pp,Mp,Fp=(n(Gp,Mp=fp),Gp.prototype._toFieldTransform=function(t){return new es(t.path,new qo)},Gp.prototype.isEqual=function(t){return t instanceof Gp},Gp),Vp=(n(Kp,Pp=fp),Kp.prototype._toFieldTransform=function(t){var e=xp(this,t,!0),n=this.Kc.map(function(t){return Wp(t,e)}),n=new Bo(n);return new es(t.path,n)},Kp.prototype.isEqual=function(t){return this===t},Kp),Up=(n(jp,Lp=fp),jp.prototype._toFieldTransform=function(t){var e=xp(this,t,!0),n=this.Kc.map(function(t){return Wp(t,e)}),n=new Ho(n);return new es(t.path,n)},jp.prototype.isEqual=function(t){return this===t},jp),qp=(n(Bp,Op=fp),Bp.prototype._toFieldTransform=function(t){var e=new Xo(t.R,Mo(t.R,this.Qc));return new es(t.path,e)},Bp.prototype.isEqual=function(t){return this===t},Bp);function Bp(t,e){var n=this;return(n=Op.call(this,t)||this).Qc=e,n}function jp(t,e){var n=this;return(n=Lp.call(this,t)||this).Kc=e,n}function Kp(t,e){var n=this;return(n=Pp.call(this,t)||this).Kc=e,n}function Gp(){return null!==Mp&&Mp.apply(this,arguments)||this}function Qp(t,r,i,e){var o=t.Uc(1,r,i);$p("Data must be an object, but it was:",o,e);var s=[],a=xi.empty();return Wr(e,function(t,e){var n=ty(r,t,i);e=w(e),t=o.Oc(n),e instanceof kp?s.push(n):null!=(t=Wp(e,t))&&(s.push(n),a.set(n,t))}),e=new ei(s),new gp(a,e,o.fieldTransforms)}function Hp(t,e,n,r,i,o){var s=t.Uc(1,e,n),a=[Jp(e,r,n)],u=[i];if(o.length%2!=0)throw new Nr(Dr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(Jp(e,o[c])),u.push(o[c+1]);for(var h,l,f,d=[],p=xi.empty(),y=a.length-1;0<=y;--y)ny(d,a[y])||(h=a[y],l=w(u[y]),f=s.Oc(h),l instanceof kp?d.push(h):null!=(f=Wp(l,f))&&(d.push(h),p.set(h,f)));return i=new ei(d),new gp(p,i,s.fieldTransforms)}function zp(t,e,n,r){return Wp(n,t.Uc((r=void 0!==r&&r)?4:3,e))}function Wp(s,t){if(Xp(s=w(s)))return $p("Unsupported field value:",t,s),Yp(s,t);if(s instanceof fp)return function(t,e){if(!Ep(e.Nc))throw e.Lc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Lc(t._methodName+"() is not currently supported inside arrays");(t=t._toFieldTransform(e))&&e.fieldTransforms.push(t)}(s,t),null;if(void 0===s&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),s instanceof Array){if(t.settings.Fc&&4!==t.Nc)throw t.Lc("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=Wp(i[r],t.Mc(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===(t=w(s)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Mo(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Kr.fromDate(t);return{timestampValue:sa(e.R,n)}}if(t instanceof Kr)return n=new Kr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:sa(e.R,n)};if(t instanceof dp)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof lp)return{bytesValue:aa(e.R,t._byteString)};if(t instanceof qd){var n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Lc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:ca(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Lc("Unsupported field value: "+Ld(t))}(0,t)}function Yp(t,n){var r={};return Yr(t)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):Wr(t,function(t,e){null!=(e=Wp(e,n.kc(t)))&&(r[t]=e)}),{mapValue:{fields:r}}}function Xp(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Kr||t instanceof dp||t instanceof lp||t instanceof qd||t instanceof fp)}function $p(t,e,n){if(!Xp(n)||"object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))throw"an object"===(n=Ld(n))?e.Lc(t+" a custom object"):e.Lc(t+" "+n);var r}function Jp(t,e,n){if((e=w(e))instanceof hp)return e._internalPath;if("string"==typeof e)return ty(t,e);throw ey("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Zp=new RegExp("[~\\*/\\[\\]]");function ty(e,n,r){if(0<=n.search(Zp))throw ey("Invalid field path ("+n+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,r);try{return(new(hp.bind.apply(hp,s([void 0],n.split(".")))))._internalPath}catch(t){throw ey("Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,r)}}function ey(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,e="Function "+e+"() called with invalid data";return n&&(e+=" (via `toFirestore()`)"),n="",(o||s)&&(n+=" (found",o&&(n+=" in field "+r),s&&(n+=" in document "+i),n+=")"),new Nr(Dr.INVALID_ARGUMENT,(e+=". ")+t+n)}function ny(t,e){return t.some(function(t){return t.isEqual(e)})}var ry,iy=(Object.defineProperty(ay.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(ay.prototype,"ref",{get:function(){return new qd(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),ay.prototype.exists=function(){return null!==this._document},ay.prototype.data=function(){if(this._document){if(this._converter){var t=new oy(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},ay.prototype.get=function(t){if(this._document&&null!==(t=this._document.data.field(uy("DocumentSnapshot.get",t))))return this._userDataWriter.convertValue(t)},ay),oy=(n(sy,ry=iy),sy.prototype.data=function(){return ry.prototype.data.call(this)},sy);function sy(){return null!==ry&&ry.apply(this,arguments)||this}function ay(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}function uy(t,e){return"string"==typeof e?ty(t,e):(e instanceof hp?e:e._delegate)._internalPath}var cy,hy,ly=(vy.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},vy),fy=(n(my,hy=iy),my.prototype.exists=function(){return hy.prototype.exists.call(this)},my.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new dy(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},my.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document&&null!==(t=this._document.data.field(uy("DocumentSnapshot.get",t))))return this._userDataWriter.convertValue(t,e.serverTimestamps)},my),dy=(n(gy,cy=fy),gy.prototype.data=function(t){return cy.prototype.data.call(this,t=void 0===t?{}:t)},gy),py=(Object.defineProperty(yy.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(yy.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(yy.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),yy.prototype.forEach=function(e,n){var r=this;this._snapshot.docs.forEach(function(t){e.call(n,new dy(r._firestore,r._userDataWriter,t.key,t,new ly(r._snapshot.mutatedKeys.has(t.key),r._snapshot.fromCache),r.query.converter))})},yy.prototype.docChanges=function(t){if((t=!!(t=void 0===t?{}:t).includeMetadataChanges)&&this._snapshot.excludesMetadataChanges)throw new Nr(Dr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,e){if(i._snapshot.oldDocs.isEmpty()){var n=0;return i._snapshot.docChanges.map(function(t){return{type:"added",doc:new dy(i._firestore,i._userDataWriter,t.doc.key,t.doc,new ly(i._snapshot.mutatedKeys.has(t.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:n++}})}var o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new dy(i._firestore,i._userDataWriter,t.doc.key,t.doc,new ly(i._snapshot.mutatedKeys.has(t.doc.key),i._snapshot.fromCache),i.query.converter),n=-1,r=-1;return 0!==t.type&&(n=o.indexOf(t.doc.key),o=o.delete(t.doc.key)),1!==t.type&&(r=(o=o.add(t.doc)).indexOf(t.doc.key)),{type:function(){switch(t.type){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Mr()}}(),doc:e,oldIndex:n,newIndex:r}})}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges},yy);function yy(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new ly(r.hasPendingWrites,r.fromCache),this.query=n}function gy(){return null!==cy&&cy.apply(this,arguments)||this}function my(t,e,n,r,i,o){var s=this;return(s=hy.call(this,t,e,n,r,o)||this)._firestore=t,s._firestoreImpl=t,s.metadata=i,s}function vy(t,e){this.hasPendingWrites=t,this.fromCache=e}function wy(t,e){return t instanceof fy&&e instanceof fy?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof py&&e instanceof py&&t._firestore===e._firestore&&$d(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function by(t){if(Eo(t)&&0===t.explicitOrderBy.length)throw new Nr(Dr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function Ty(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++)t=i[r]._apply(t);return t}var Ey,Iy,_y,Sy,Ay,Dy=(n(My,Ay=C=function(){}),My.prototype._apply=function(t){var e=Dp(t.firestore),e=function(t,e,n,r,i,o){if(r.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Nr(Dr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i||"not-in"===i){Uy(o,i);for(var s=[],a=0,u=o;a<u.length;a++){var c=u[a];s.push(Vy(n,t,c))}h={arrayValue:{values:s}}}else h=Vy(n,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Uy(o,i),h=zp(e,"where",o,"in"===i||"not-in"===i);var h=ji.create(r,i,h);return function(t,e){if(e.g()){var n=_o(t);if(null!==n&&!n.isEqual(e.field))throw new Nr(Dr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");null!==(n=Io(t))&&qy(0,e.field,n)}if(null!==(t=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}())))throw t===e.op?new Nr(Dr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Nr(Dr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+t.toString()+"' filters.")}(t,h),h}(t._query,e,t.firestore._databaseId,this.jc,this.Wc,this.Gc);return new Bd(t.firestore,t.converter,(e=(t=t._query).filters.concat([e]),new vo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),e,t.limit,t.limitType,t.startAt,t.endAt)))},My),Ny=(n(Py,Sy=C),Py.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Nr(Dr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Nr(Dr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new yo(e,n);return e=r,null!==Io(n=t)||null!==(t=_o(n))&&qy(0,t,e.field),r}(t._query,this.jc,this.zc);return new Bd(t.firestore,t.converter,(e=(t=t._query).explicitOrderBy.concat([e]),new vo(t.path,t.collectionGroup,e,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))},Py),Cy=(n(Ly,_y=C),Ly.prototype._apply=function(t){return new Bd(t.firestore,t.converter,No(t._query,this.Hc,this.Jc))},Ly),ky=(n(Oy,Iy=C),Oy.prototype._apply=function(t){var e=Fy(t,this.type,this.Yc,this.Xc);return new Bd(t.firestore,t.converter,(t=t._query,new vo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))},Oy),Ry=(n(xy,Ey=C),xy.prototype._apply=function(t){var e=Fy(t,this.type,this.Yc,this.Xc);return new Bd(t.firestore,t.converter,(t=t._query,new vo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))},xy);function xy(t,e,n){var r=this;return(r=Ey.call(this)||this).type=t,r.Yc=e,r.Xc=n,r}function Oy(t,e,n){var r=this;return(r=Iy.call(this)||this).type=t,r.Yc=e,r.Xc=n,r}function Ly(t,e,n){var r=this;return(r=_y.call(this)||this).type=t,r.Hc=e,r.Jc=n,r}function Py(t,e){var n=this;return(n=Sy.call(this)||this).jc=t,n.zc=e,n.type="orderBy",n}function My(t,e,n){var r=this;return(r=Ay.call(this)||this).jc=t,r.Wc=e,r.Gc=n,r.type="where",r}function Fy(t,c,e,n){if(e[0]=w(e[0]),e[0]instanceof iy)return function(t,e,n,r){if(!n)throw new Nr(Dr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var i=[],o=0,s=Ao(t);o<s.length;o++){var a=s[o];if(a.field.isKeyField())i.push(Si(e,n.key));else{var u=n.data.field(a.field);if(fi(u))throw new Nr(Dr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===u)throw a=a.field.canonicalString(),new Nr(Dr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+a+"' (used as the orderBy) does not exist.");i.push(u)}}return new uo(i,r)}(t._query,t.firestore._databaseId,e[0]._document,n);var r=Dp(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Nr(Dr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Nr(Dr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!So(t)&&-1!==c.indexOf("/"))throw new Nr(Dr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Jr.fromString(c));if(!mi.isDocumentKey(h))throw new Nr(Dr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");h=new mi(h),a.push(Si(e,h))}else c=zp(n,r,c),a.push(c)}return new uo(a,o)}(t._query,t.firestore._databaseId,r,c,e,n)}function Vy(t,e,n){if("string"==typeof(n=w(n))){if(""===n)throw new Nr(Dr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!So(e)&&-1!==n.indexOf("/"))throw new Nr(Dr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");if(e=e.path.child(Jr.fromString(n)),!mi.isDocumentKey(e))throw new Nr(Dr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return Si(t,new mi(e))}if(n instanceof qd)return Si(t,n._key);throw new Nr(Dr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ld(n)+".")}function Uy(t,e){if(!Array.isArray(t)||0===t.length)throw new Nr(Dr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Nr(Dr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function qy(t,e,n){if(!n.isEqual(e))throw new Nr(Dr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function By(){}function jy(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}By.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),wi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return hi(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(li(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Mr()}},By.prototype.convertObject=function(t,n){var r=this,i={};return Wr(t.fields,function(t,e){i[t]=r.convertValue(e,n)}),i},By.prototype.convertGeoPoint=function(t){return new dp(hi(t.latitude),hi(t.longitude))},By.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},By.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=function t(e){return fi(e=e.mapValue.fields.__previous_value__)?t(e):e}(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(di(t));default:return null}},By.prototype.convertTimestamp=function(t){return t=ci(t),new Kr(t.seconds,t.nanos)},By.prototype.convertDocumentKey=function(t,e){var n=Jr.fromString(t);return Fr(Na(n)),t=new gd(n.get(1),n.get(3)),n=new mi(n.popFirst(5)),t.isEqual(e)||Or("Document "+n+" contains a document reference within a different database ("+t.projectId+"/"+t.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),n};var Ky,Gy=(n(zy,Ky=_=By),zy.prototype.convertBytes=function(t){return new lp(t)},zy.prototype.convertReference=function(t){return t=this.convertDocumentKey(t,this.firestore._databaseId),new qd(this.firestore,null,t)},zy),Qy=(Hy.prototype.set=function(t,e,n){return this._verifyNotCommitted(),e=jy((t=Wy(t,this._firestore)).converter,e,n),n=Np(this._dataReader,"WriteBatch.set",t._key,e,null!==t.converter,n),this._mutations.push(n.toMutation(t._key,ns.none())),this},Hy.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return this._verifyNotCommitted(),t=Wy(t,this._firestore),e="string"==typeof(e=w(e))||e instanceof hp?Hp(this._dataReader,"WriteBatch.update",t._key,e,n,r):Qp(this._dataReader,"WriteBatch.update",t._key,e),this._mutations.push(e.toMutation(t._key,ns.exists(!0))),this},Hy.prototype.delete=function(t){return this._verifyNotCommitted(),t=Wy(t,this._firestore),this._mutations=this._mutations.concat(new Ts(t._key,ns.none())),this},Hy.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()},Hy.prototype._verifyNotCommitted=function(){if(this._committed)throw new Nr(Dr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},Hy);function Hy(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Dp(t)}function zy(t){var e=this;return(e=Ky.call(this)||this).firestore=t,e}function Wy(t,e){if((t=w(t)).firestore!==e)throw new Nr(Dr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Yy,Xy=(n($y,Yy=_),$y.prototype.convertBytes=function(t){return new lp(t)},$y.prototype.convertReference=function(t){return t=this.convertDocumentKey(t,this.firestore._databaseId),new qd(this.firestore,null,t)},$y);function $y(t){var e=this;return(e=Yy.call(this)||this).firestore=t,e}function Jy(t,e,n){t=Pd(t,qd);var r=Pd(t.firestore,rp),e=jy(t.converter,e,n);return eg(r,[Np(Dp(r),"setDoc",t._key,e,null!==t.converter,n).toMutation(t._key,ns.none())])}function Zy(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Pd(t,qd);var o=Pd(t.firestore,rp),s=Dp(o);return eg(o,[("string"==typeof(e=w(e))||e instanceof hp?Hp(s,"updateDoc",t._key,e,n,r):Qp(s,"updateDoc",t._key,e)).toMutation(t._key,ns.exists(!0))])}function tg(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];e=w(e);var r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||tp(n[i])||(r=n[i],i++);var o,s,a,u,c,h,l={includeMetadataChanges:r.includeMetadataChanges};return tp(n[i])&&(o=n[i],n[i]=null===(r=o.next)||void 0===r?void 0:r.bind(o),n[i+1]=null===(r=o.error)||void 0===r?void 0:r.bind(o),n[i+2]=null===(r=o.complete)||void 0===r?void 0:r.bind(o)),e instanceof qd?(a=Pd(e.firestore,rp),u=bo(e._key.path),h={next:function(t){n[i]&&n[i](ng(a,e,t))},error:n[i+1],complete:n[i+2]}):(s=Pd(e,Bd),a=Pd(s.firestore,rp),u=s._query,c=new Xy(a),h={next:function(t){n[i]&&n[i](new py(a,c,s,t))},error:n[i+1],complete:n[i+2]},by(e._query)),function(n,t,e){var r=this,i=new zf(h),o=new ef(t,i,e);return n.asyncQueue.enqueueAndForget(function(){return y(r,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=Jl,[4,ld(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})}),function(){i.Wo(),n.asyncQueue.enqueueAndForget(function(){return y(r,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=Zl,[4,ld(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})})}}(sp(a),u,l)}function eg(t,e){return function(n,r){var t=this,i=new Ya;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=bf,[4,hd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(sp(t),e)}function ng(t,e,n){var r=n.docs.get(e._key),i=new Xy(t);return new fy(t,i,e._key,r,new ly(n.hasPendingWrites,n.fromCache),e.converter)}var rg,ig=(sg.prototype.get=function(t){var e=this,n=Wy(t,this._firestore),r=new Gy(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return Mr();if((t=t[0]).isFoundDocument())return new iy(e._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new iy(e._firestore,r,n._key,null,n.converter);throw Mr()})},sg.prototype.set=function(t,e,n){return e=jy((t=Wy(t,this._firestore)).converter,e,n),n=Np(this._dataReader,"Transaction.set",t._key,e,null!==t.converter,n),this._transaction.set(t._key,n),this},sg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return t=Wy(t,this._firestore),e="string"==typeof(e=w(e))||e instanceof hp?Hp(this._dataReader,"Transaction.update",t._key,e,n,r):Qp(this._dataReader,"Transaction.update",t._key,e),this._transaction.update(t._key,e),this},sg.prototype.delete=function(t){return t=Wy(t,this._firestore),this._transaction.delete(t._key),this},n(og,rg=sg),og.prototype.get=function(t){var e=this,n=Wy(t,this._firestore),r=new Xy(this._firestore);return rg.prototype.get.call(this,t).then(function(t){return new fy(e._firestore,r,n._key,t._document,new ly(!1,!1),n.converter)})},og);function og(t,e){var n=this;return(n=rg.call(this,t,e)||this)._firestore=t,n}function sg(t,e){this._firestore=t,this._transaction=e,this._dataReader=Dp(t)}function ag(){if("undefined"==typeof Uint8Array)throw new Nr(Dr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function ug(){if("undefined"==typeof atob)throw new Nr(Dr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var cg,hg=(mg.fromBase64String=function(t){return ug(),new mg(lp.fromBase64String(t))},mg.fromUint8Array=function(t){return ag(),new mg(lp.fromUint8Array(t))},mg.prototype.toBase64=function(){return ug(),this._delegate.toBase64()},mg.prototype.toUint8Array=function(){return ag(),this._delegate.toUint8Array()},mg.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},mg.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},mg),lg=(gg.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){cp(t=Pd(t,rp));var n=sp(t),r=t._freezeSettings();return up(n,t=new Bf,new Uf(t,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},gg.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){cp(t=Pd(t,rp));var e=sp(t),n=t._freezeSettings();return up(e,t=new Bf,new qf(t,n.cacheSizeBytes))}(t._delegate)},gg.prototype.clearIndexedDbPersistence=function(t){return function(n){var t=this;if(n._initialized&&!n._terminated)throw new Nr(Dr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var r=new Ya;return n._queue.enqueueAndForgetEvenWhileRestricted(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return eu.yt()?(e=n+"main",[4,eu.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})}(jc(n._databaseId,n._persistenceKey))];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise}(t._delegate)},gg),fg=(Object.defineProperty(yg.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),yg.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||Lr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},yg.prototype.useEmulator=function(t,e,n){!function(t,e,n,r){void 0===r&&(r={});var i,o=(t=Pd(t,Ud))._getSettings();if("firestore.googleapis.com"!==o.host&&o.host!==e&&Lr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},o),{host:e+":"+n,ssl:!1})),r.mockUserToken){if("string"==typeof r.mockUserToken)s=r.mockUserToken,i=wh.MOCK_USER;else{var s=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=e||"demo-project",r=t.iat||0;if(!(e=t.sub||t.user_id))throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");return t=a({iss:"https://securetoken.google.com/"+n,aud:n,iat:r,exp:r+3600,auth_time:r,sub:e,user_id:e,firebase:{sign_in_provider:"custom",identities:{}}},t),[u(JSON.stringify({alg:"none",type:"JWT"})),u(JSON.stringify(t)),""].join(".")}(r.mockUserToken,null===(n=t._app)||void 0===n?void 0:n.options.projectId);if(!(r=r.mockUserToken.sub||r.mockUserToken.user_id))throw new Nr(Dr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");i=new wh(r)}t._credentials=new wd(new pd(s,i))}}(this._delegate,t,e,n=void 0===n?{}:n)},yg.prototype.enableNetwork=function(){return function(i){var t=this;return i.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return[4,ad(i)];case 1:return n=t.sent(),[4,cd(i)];case 2:return r=t.sent(),[2,(n.setNetworkEnabled(!0),(e=r).Or.delete(0),Il(e))]}var e})})})}(sp(Pd(this._delegate,rp)))},yg.prototype.disableNetwork=function(){return function(r){var t=this;return r.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,ad(r)];case 1:return e=t.sent(),[4,cd(r)];case 2:return n=t.sent(),[2,(e.setNetworkEnabled(!1),function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return(e=n).Or.add(0),[4,_l(e)];case 1:return t.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(sp(Pd(this._delegate,rp)))},yg.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Rd("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,n)},yg.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},yg.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},yg.prototype.waitForPendingWrites=function(){return function(n){var t=this,r=new Ya;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=If,[4,hd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),r.promise}(sp(Pd(this._delegate,rp)))},yg.prototype.onSnapshotsInSync=function(t){return function(n,t){var e=this,r=new zf(t);return n.asyncQueue.enqueueAndForget(function(){return y(e,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){t.Gr.add(e),e.next()},[4,ld(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),function(){r.Wo(),n.asyncQueue.enqueueAndForget(function(){return y(e,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){t.Gr.delete(e)},[4,ld(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}}(sp(Pd(this._delegate,rp)),tp(t)?t:{next:t})},Object.defineProperty(yg.prototype,"app",{get:function(){if(!this.tu)throw new Nr(Dr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),yg.prototype.collection=function(t){try{return new Mg(this,Wd(this._delegate,t))}catch(t){throw Ag(t,"collection()","Firestore.collection()")}},yg.prototype.doc=function(t){try{return new _g(this,Yd(this._delegate,t))}catch(t){throw Ag(t,"doc()","Firestore.doc()")}},yg.prototype.collectionGroup=function(t){try{return new Og(this,function(t,e){if(t=Pd(t,Ud),Cd("collectionGroup","collection id",e),0<=e.indexOf("/"))throw new Nr(Dr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Bd(t,null,new vo(Jr.emptyPath(),e))}(this._delegate,t))}catch(t){throw Ag(t,"collectionGroup()","Firestore.collectionGroup()")}},yg.prototype.runTransaction=function(e){var n,r=this;return function(n,r){var t=this,i=new Ya;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return[4,sd(n).then(function(t){return t.datastore})];case 1:return e=t.sent(),new Xf(n.asyncQueue,e,r,i).run(),[2]}})})}),i.promise}(sp(n=this._delegate),function(t){return t=new ig(n,t),e(new vg(r,t))})},yg.prototype.batch=function(){var e=this;return sp(this._delegate),new wg(new Qy(this._delegate,function(t){return eg(e._delegate,t)}))},yg.prototype.loadBundle=function(t){throw new Nr(Dr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},yg.prototype.namedQuery=function(t){throw new Nr(Dr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},yg),dg=(n(pg,cg=_),pg.prototype.convertBytes=function(t){return new hg(new lp(t))},pg.prototype.convertReference=function(t){return t=this.convertDocumentKey(t,this.firestore._databaseId),_g.eu(t,this.firestore,null)},pg);function pg(t){var e=this;return(e=cg.call(this)||this).firestore=t,e}function yg(t,e,n){var r=this;this._delegate=e,this.Zc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof gd||(this.tu=t)}function gg(){}function mg(t){this._delegate=t}var vg=(Ig.prototype.get=function(t){var e=this,n=Kg(t);return this._delegate.get(n).then(function(t){return new Rg(e._firestore,new fy(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},Ig.prototype.set=function(t,e,n){return t=Kg(t),n?(kd("Transaction.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this},Ig.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=Kg(t);return 2===arguments.length?this._delegate.update(o,e):(t=this._delegate).update.apply(t,s([o,e,n],r)),this},Ig.prototype.delete=function(t){return t=Kg(t),this._delegate.delete(t),this},Ig),wg=(Eg.prototype.set=function(t,e,n){return t=Kg(t),n?(kd("WriteBatch.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this},Eg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=Kg(t);return 2===arguments.length?this._delegate.update(o,e):(t=this._delegate).update.apply(t,s([o,e,n],r)),this},Eg.prototype.delete=function(t){return t=Kg(t),this._delegate.delete(t),this},Eg.prototype.commit=function(){return this._delegate.commit()},Eg),bg=(Tg.prototype.fromFirestore=function(t,e){return t=new dy(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null),this._delegate.fromFirestore(new xg(this._firestore,t),null!=e?e:{})},Tg.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},Tg.nu=function(t,e){var n=Tg.su,r=n.get(t);return r||(r=new WeakMap,n.set(t,r)),(n=r.get(e))||(n=new Tg(t,new dg(t),e),r.set(e,n)),n},Tg);function Tg(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}function Eg(t){this._delegate=t}function Ig(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new dg(t)}bg.su=new WeakMap;var _g=(Sg.iu=function(t,e,n){if(t.length%2!=0)throw new Nr(Dr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new Sg(e,new qd(e._delegate,n,new mi(t)))},Sg.eu=function(t,e,n){return new Sg(e,new qd(e._delegate,n,t))},Object.defineProperty(Sg.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(Sg.prototype,"parent",{get:function(){return new Mg(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(Sg.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Sg.prototype.collection=function(t){try{return new Mg(this.firestore,Wd(this._delegate,t))}catch(t){throw Ag(t,"collection()","DocumentReference.collection()")}},Sg.prototype.isEqual=function(t){return(t=w(t))instanceof qd&&Xd(this._delegate,t)},Sg.prototype.set=function(t,e){e=kd("DocumentReference.set",e);try{return e?Jy(this._delegate,t,e):Jy(this._delegate,t)}catch(t){throw Ag(t,"setDoc()","DocumentReference.set()")}},Sg.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Zy(this._delegate,t):Zy.apply(void 0,s([this._delegate,t,e],n))}catch(t){throw Ag(t,"updateDoc()","DocumentReference.update()")}},Sg.prototype.delete=function(){return eg(Pd((t=this._delegate).firestore,rp),[new Ts(t._key,ns.none())]);var t},Sg.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=Dg(t),i=Ng(t,function(t){return new Rg(e.firestore,new fy(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))});return tg(this._delegate,r,i)},Sg.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=Pd(e,qd);var n=Pd(e.firestore,rp),t=sp(n),r=new Xy(n);return function(n,r){var t=this,i=new Ya;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(o,s,a){return y(this,void 0,void 0,function(){var r,i;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(e=s,(n=o).persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)}))];case 1:return(i=t.sent()).isFoundDocument()?a.resolve(i):i.isNoDocument()?a.resolve(null):a.reject(new Nr(Dr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=t.sent(),i=Kl(r,"Failed to get document '"+s+" from cache"),a.reject(i),[3,3];case 3:return[2]}var e,n})})},[4,ud(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e._key).then(function(t){return new fy(n,r,e._key,t,new ly(null!==t&&t.hasLocalMutations,!0),e.converter)})}:"server"===(null==t?void 0:t.source)?function(e){e=Pd(e,qd);var n=Pd(e.firestore,rp);return fd(sp(n),e._key,{source:"server"}).then(function(t){return ng(n,e,t)})}:function(e){e=Pd(e,qd);var n=Pd(e.firestore,rp);return fd(sp(n),e._key).then(function(t){return ng(n,e,t)})})(this._delegate).then(function(t){return new Rg(e.firestore,new fy(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))})},Sg.prototype.withConverter=function(t){return new Sg(this.firestore,t?this._delegate.withConverter(bg.nu(this.firestore,t)):this._delegate.withConverter(null))},Sg);function Sg(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new dg(t)}function Ag(t,e,n){return t.message=t.message.replace(e,n),t}function Dg(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!tp(r))return r}return{}}function Ng(t,e){var n;return{next:function(t){n.next&&n.next(e(t))},error:null===(t=(n=tp(t[0])?t[0]:tp(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===t?void 0:t.bind(n),complete:null===(t=n.complete)||void 0===t?void 0:t.bind(n)}}var Cg,kg,Rg=(Object.defineProperty(jg.prototype,"ref",{get:function(){return new _g(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(jg.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(jg.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(jg.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),jg.prototype.data=function(t){return this._delegate.data(t)},jg.prototype.get=function(t,e){return this._delegate.get(t,e)},jg.prototype.isEqual=function(t){return wy(this._delegate,t._delegate)},jg),xg=(n(Bg,kg=Rg),Bg.prototype.data=function(t){return this._delegate.data(t)},Bg),Og=(qg.prototype.where=function(t,e,n){try{return new qg(this.firestore,Ty(this._delegate,(r=n,i=e,o=uy("where",t),new Dy(o,i,r))))}catch(t){throw Ag(t,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,o},qg.prototype.orderBy=function(t,e){try{return new qg(this.firestore,Ty(this._delegate,(n=void 0===e?"asc":e,r=uy("orderBy",t),new Ny(r,n))))}catch(t){throw Ag(t,/(orderBy|where)\(\)/,"Query.$1()")}var n,r},qg.prototype.limit=function(t){try{return new qg(this.firestore,Ty(this._delegate,(Md("limit",e=t),new Cy("limit",e,"F"))))}catch(t){throw Ag(t,"limit()","Query.limit()")}var e},qg.prototype.limitToLast=function(t){try{return new qg(this.firestore,Ty(this._delegate,(Md("limitToLast",e=t),new Cy("limitToLast",e,"L"))))}catch(t){throw Ag(t,"limitToLast()","Query.limitToLast()")}var e},qg.prototype.startAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new qg(this.firestore,Ty(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ky("startAt",t,!0)}.apply(void 0,t)))}catch(t){throw Ag(t,"startAt()","Query.startAt()")}},qg.prototype.startAfter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new qg(this.firestore,Ty(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ky("startAfter",t,!1)}.apply(void 0,t)))}catch(t){throw Ag(t,"startAfter()","Query.startAfter()")}},qg.prototype.endBefore=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new qg(this.firestore,Ty(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ry("endBefore",t,!0)}.apply(void 0,t)))}catch(t){throw Ag(t,"endBefore()","Query.endBefore()")}},qg.prototype.endAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new qg(this.firestore,Ty(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ry("endAt",t,!1)}.apply(void 0,t)))}catch(t){throw Ag(t,"endAt()","Query.endAt()")}},qg.prototype.isEqual=function(t){return $d(this._delegate,t._delegate)},qg.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=Pd(e,Bd);var n=Pd(e.firestore,rp),t=sp(n),r=new Xy(n);return function(n,r){var t=this,i=new Ya;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,ih(i,o,!0)];case 1:return r=t.sent(),e=new pf(o,r.Bn),n=e._o(r.documents),n=e.applyChanges(n,!1),s.resolve(n.snapshot),[3,3];case 2:return n=t.sent(),r=Kl(n,"Failed to execute query '"+o+" against cache"),s.reject(r),[3,3];case 3:return[2]}})})},[4,ud(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e._query).then(function(t){return new py(n,r,e,t)})}:"server"===(null==t?void 0:t.source)?function(e){e=Pd(e,Bd);var n=Pd(e.firestore,rp),t=sp(n),r=new Xy(n);return dd(t,e._query,{source:"server"}).then(function(t){return new py(n,r,e,t)})}:function(e){e=Pd(e,Bd);var n=Pd(e.firestore,rp),t=sp(n),r=new Xy(n);return by(e._query),dd(t,e._query).then(function(t){return new py(n,r,e,t)})})(this._delegate).then(function(t){return new Pg(e.firestore,new py(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},qg.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=Dg(t),i=Ng(t,function(t){return new Pg(e.firestore,new py(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))});return tg(this._delegate,r,i)},qg.prototype.withConverter=function(t){return new qg(this.firestore,t?this._delegate.withConverter(bg.nu(this.firestore,t)):this._delegate.withConverter(null))},qg),Lg=(Object.defineProperty(Ug.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(Ug.prototype,"doc",{get:function(){return new xg(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(Ug.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(Ug.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),Ug),Pg=(Object.defineProperty(Vg.prototype,"query",{get:function(){return new Og(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(Vg.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(Vg.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(Vg.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(Vg.prototype,"docs",{get:function(){var e=this;return this._delegate.docs.map(function(t){return new xg(e._firestore,t)})},enumerable:!1,configurable:!0}),Vg.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new Lg(e._firestore,t)})},Vg.prototype.forEach=function(e,n){var r=this;this._delegate.forEach(function(t){e.call(n,new xg(r._firestore,t))})},Vg.prototype.isEqual=function(t){return wy(this._delegate,t._delegate)},Vg),Mg=(n(Fg,Cg=Og),Object.defineProperty(Fg.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(Fg.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(Fg.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new _g(this.firestore,t):null},enumerable:!1,configurable:!0}),Fg.prototype.doc=function(t){try{return new _g(this.firestore,void 0===t?Yd(this._delegate):Yd(this._delegate,t))}catch(t){throw Ag(t,"doc()","CollectionReference.doc()")}},Fg.prototype.add=function(t){var e,n=this,r=this._delegate,i=t;return t=Pd(r.firestore,rp),e=Yd(r),i=jy(r.converter,i),eg(t,[Np(Dp(r.firestore),"addDoc",e._key,i,null!==r.converter,{}).toMutation(e._key,ns.exists(!1))]).then(function(){return e}).then(function(t){return new _g(n.firestore,t)})},Fg.prototype.isEqual=function(t){return Xd(this._delegate,t._delegate)},Fg.prototype.withConverter=function(t){return new Fg(this.firestore,t?this._delegate.withConverter(bg.nu(this.firestore,t)):this._delegate.withConverter(null))},Fg);function Fg(t,e){var n=this;return(n=Cg.call(this,t,e)||this).firestore=t,n._delegate=e,n}function Vg(t,e){this._firestore=t,this._delegate=e}function Ug(t,e){this._firestore=t,this._delegate=e}function qg(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new dg(t)}function Bg(){return null!==kg&&kg.apply(this,arguments)||this}function jg(t,e){this._firestore=t,this._delegate=e}function Kg(t){return Pd(t,qd)}function Gg(t){this._delegate=t}function Qg(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(hp.bind.apply(hp,s([void 0],t)))}Qg.documentId=function(){return new Qg(ti.keyField().canonicalString())},Qg.prototype.isEqual=function(t){return(t=w(t))instanceof hp&&this._delegate._internalPath.isEqual(t._internalPath)},C=Qg,Gg.serverTimestamp=function(){var t=new Fp("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new Gg(t)},Gg.delete=function(){var t=new kp("deleteField");return t._methodName="FieldValue.delete",new Gg(t)},Gg.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Vp("arrayUnion",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayUnion",new Gg(n)},Gg.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Up("arrayRemove",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayRemove",new Gg(n)},Gg.increment=function(t){return(t=new qp("increment",t))._methodName="FieldValue.increment",new Gg(t)},Gg.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},_=Gg;Hg.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},Hg.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},Hg.prototype.setServiceProps=function(t){return this.serviceProps=t,this},Hg.prototype.setInstanceCreatedCallback=function(t){return this.onInstanceCreated=t,this},ye=Hg;function Hg(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}_={Firestore:fg,GeoPoint:dp,Timestamp:Kr,Blob:hg,Transaction:vg,WriteBatch:wg,DocumentReference:_g,DocumentSnapshot:Rg,Query:Og,QueryDocumentSnapshot:xg,QuerySnapshot:Pg,CollectionReference:Mg,FieldPath:C,FieldValue:_,setLogLevel:function(t){Cr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(e=e.default).INTERNAL.registerComponent(new ye("firestore",function(t){var e=t.getProvider("app").getImmediate();return t=t.getProvider("auth-internal"),new fg(e,new rp(e,t),new lg)},"PUBLIC").setServiceProps(Object.assign({},_))),e.registerVersion("@firebase/firestore","2.4.1"),fg.prototype.loadBundle=function(t){return e=this._delegate,s=t,n=sp(e=Pd(e,rp)),t=new np,function(n,t,r){var e,i=this,o=(e=s,t=al(t),e=function(t){if(t instanceof Uint8Array)return Hf(t,void 0);if(t instanceof ArrayBuffer)return Hf(new Uint8Array(t),void 0);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?(new TextEncoder).encode(e):e),new Wf(e,t));n.asyncQueue.enqueueAndForget(function(){return y(i,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=Pf,[4,hd(n)];case 1:return e.apply(void 0,[t.sent(),o,r]),[2]}})})})}(n,e._databaseId,t),t;var e,s,n},fg.prototype.namedQuery=function(t){var e,n=this,t=t;return function(n,r){var t=this;return n.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=t;return n.persistence.runTransaction("Get named query","readonly",function(t){return n.Ke.getNamedQuery(t,e)})},[4,ud(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}(sp(e=Pd(e=this._delegate,rp)),t).then(function(t){return t?new Bd(e,null,t.query):null}).then(function(t){return t?new Og(n,t):null})}}.apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});
